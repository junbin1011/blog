<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="Hexo, NexT">








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0">






<meta name="description" content="ä¸€èŠ±ä¸€ä¸–ç•Œï¼Œä¸€ç ä¸€æµ®ç”Ÿ">
<meta property="og:type" content="website">
<meta property="og:title" content="JunBin">
<meta property="og:url" content="https://junbin1011.github.io/index.html">
<meta property="og:site_name" content="JunBin">
<meta property="og:description" content="ä¸€èŠ±ä¸€ä¸–ç•Œï¼Œä¸€ç ä¸€æµ®ç”Ÿ">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JunBin">
<meta name="twitter:description" content="ä¸€èŠ±ä¸€ä¸–ç•Œï¼Œä¸€ç ä¸€æµ®ç”Ÿ">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://junbin1011.github.io/">





  <title> JunBin </title>
</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?b3ffb4912eee79c795100275f268095c";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">JunBin</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">ä¸€èŠ±ä¸€ä¸–ç•Œï¼Œä¸€ç ä¸€æµ®ç”Ÿ</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            å…³äº
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2021/07/05/æ¯å¤©å†™ä»£ç ï¼Œå¦‚ä½•ç˜¦èº«34æ–¤ï¼Ÿ/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é»„ä¿Šå½¬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JunBin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/07/05/æ¯å¤©å†™ä»£ç ï¼Œå¦‚ä½•ç˜¦èº«34æ–¤ï¼Ÿ/" itemprop="url">
                  æ¯å¤©å†™ä»£ç ï¼Œå¦‚ä½•ç˜¦èº«34æ–¤ï¼Ÿ
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-07-05T19:35:12+08:00">
                2021-07-05
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/07/05/æ¯å¤©å†™ä»£ç ï¼Œå¦‚ä½•ç˜¦èº«34æ–¤ï¼Ÿ/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2021/07/05/æ¯å¤©å†™ä»£ç ï¼Œå¦‚ä½•ç˜¦èº«34æ–¤ï¼Ÿ/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="æˆæœ"><a href="#æˆæœ" class="headerlink" title="æˆæœ"></a>æˆæœ</h1><p><strong>å…ˆä¸Šæˆæœå›¾ï¼š</strong></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB7c778d46da7b0bac456cfa03a2d3d02e?method=download&shareKey=1ac17cec2c26bd35d7cf398b75d3206b" height="600"></p>
<p><strong>å‡è‚¥å‰åBMIï¼š</strong><br><img src="https://note.youdao.com/yws/api/personal/file/WEB167d0ea5a3d1767c2e766db4d5d91014?method=download&amp;shareKey=852922d31864c415dfb3b3eb6fe4c70b" alt=""></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB4ec7e624e1463878e46ea955fcfc76e5?method=download&amp;shareKey=8d9e44dcb9dbca122733e15bb7a08c44" alt=""></p>
<h1 id="ç¼˜èµ·"><a href="#ç¼˜èµ·" class="headerlink" title="ç¼˜èµ·"></a>ç¼˜èµ·</h1><p>æ—¶é—´æ¥åˆ°2021å¹´2æœˆï¼Œåˆšå¥½å›è€å®¶è¿‡äº†ä¸ªå¹´ã€‚æ‰€è°“â€œæ¯é€¢ä½³èŠ‚èƒ–ä¸‰æ–¤â€ï¼Œä¹‹å‰é•¿æœŸçš„ä½“é‡ç»´æŒåœ¨166å·¦å³ï¼Œè¿‡å¹´é‚£ä¼šè¶³è¶³èƒ–äº†10æ–¤,æ¶¨åˆ°äº†176ã€‚</p>
<p>å…¶å®è‚¥èƒ–çš„ä½“è´¨ï¼Œä¼šç»™èº«ä½“å¸¦æ¥å¾ˆå¤§çš„è´Ÿæ‹…ï¼Œå¹¶ä¸”å¾ˆå®¹æ˜“è¡€å‹ã€è¡€è„‚ã€èƒ†å›ºé†‡ã€å°¿é…¸ç­‰è¶…æ ‡ã€‚30å²çš„èº«ä½“èƒ½æ´»å‡º50å²çš„æŒ‡æ ‡ğŸ˜‚ã€‚å…¶å®ä¹‹å‰ä¹Ÿé™†é™†ç»­ç»­å°è¯•è¿‡å‡è‚¥ï¼Œä½†æ€»æ˜¯åƒè¿‡ä¸Šè½¦ä¸€æ ·ååå¤å¤ã€‚äºæ˜¯æˆ‘å°±åœ¨æƒ³ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªäº‹çœŸè¿™ä¹ˆéš¾å—ï¼Ÿæ˜¯æ²¡æ—¶é—´ï¼Œè¿˜æ˜¯åšæŒä¸ä½ï¼Ÿæ˜¯æ–¹æ³•ä¸å¯¹ï¼Œè¿˜æ˜¯æŠµæŒ¡ä¸ä½è¯±æƒ‘ï¼Ÿ</p>
<p>å…¶å®ç°åœ¨å›è¿‡å¤´æ¥æƒ³ï¼Œè¿™ä¸ªåŸå› ä¹Ÿå¾ˆç®€å•ã€‚ä¸€å¥è¯æ¥æ€»ç»“å°±æ˜¯ï¼Œâ€œ<strong>é“ç†æˆ‘éƒ½æ‡‚ï¼Œä½†è‡£å¦¾åšä¸åˆ°å•Šâ€¦ â€¦</strong>â€</p>
<p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fgss0.baidu.com%2F94o3dSag_xI4khGko9WTAnF6hhy%2Fzhidao%2Fwh%253D450%252C600%2Fsign%3De804ef49790e0cf3a0a246ff3f76de29%2Ff636afc379310a55cb4f9cafbc4543a982261005.jpg&amp;refer=http%3A%2F%2Fgss0.baidu.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1627998017&amp;t=8d1e6a0d03ee639d57ed7f95e653373f" alt=""></p>
<p>å…¶å®å¥½å¤šäº‹æƒ…éƒ½æ˜¯ä¸€æ ·ï¼Œä¾‹å¦‚å­¦ä¹ ã€è¯»ä¹¦ã€å†™ä½œç­‰ç­‰ã€‚â€œæƒ°æ€§â€æ˜¯æˆ‘ä»¬éœ€è¦é¦–å…ˆå»å…‹æœçš„ç¬¬ä¸€é“éš¾å…³ã€‚æ‰€ä»¥æˆ‘ä¹Ÿå¸Œæœ›å€Ÿå‡è‚¥è¿™ä¸ªäº‹æ¥ä¸æ–­è­¦ç¤ºè‡ªå·±ï¼Œâ€œ<strong>èƒ½åšæŒä¸‹å»çš„è‡ªå¾‹ï¼Œéƒ½ä¼šæˆä¸ºèœ•å˜çš„å¥‘æœº</strong>â€ã€‚</p>
<h1 id="æˆ˜ç•¥ä¸æˆ˜æœ¯"><a href="#æˆ˜ç•¥ä¸æˆ˜æœ¯" class="headerlink" title="æˆ˜ç•¥ä¸æˆ˜æœ¯"></a>æˆ˜ç•¥ä¸æˆ˜æœ¯</h1><h2 id="1-å…ˆç»™è‡ªå·±å®šä¸ªå°ç›®æ ‡ï¼Œæ¯”å¦‚â€¦"><a href="#1-å…ˆç»™è‡ªå·±å®šä¸ªå°ç›®æ ‡ï¼Œæ¯”å¦‚â€¦" class="headerlink" title="1. å…ˆç»™è‡ªå·±å®šä¸ªå°ç›®æ ‡ï¼Œæ¯”å¦‚â€¦"></a>1. å…ˆç»™è‡ªå·±å®šä¸ªå°ç›®æ ‡ï¼Œæ¯”å¦‚â€¦</h2><p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fpic1.zhimg.com%2F50%2Fv2-ab30bf12cee69b9f28ff0cc8489c91b2_hd.jpg&amp;refer=http%3A%2F%2Fpic1.zhimg.com&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=jpeg?sec=1627999386&amp;t=4430d929efbd43f113a020709f8c4077" alt=""></p>
<p>å…¶å®å½“æˆ‘å†³å®šåšæŒå‡è‚¥çš„æ—¶å€™ï¼Œå°±å¼€å§‹ç»™è‡ªå·±è®¾å®šäº†ä¸€ä¸ªç›®æ ‡ï¼Œ40æ–¤ã€‚ä½†æ˜¯ä¸ä¸€æ ·çš„æ˜¯ï¼Œæˆ‘å¹¶æ²¡æœ‰ç»™è¿™ä¸ªç›®æ ‡è®¾å®šä¸€ä¸ªæœŸé™ã€‚æ²¡æœ‰è®¾ç½®æ—¶é—´çš„åŸå› æ˜¯è§‰å¾—è¿™ä¸ªäº‹ä¸æ˜¯ä¸€ä¸ªé˜¶æ®µï¼Œåº”è¯¥æ˜¯ä¸€ä¸ªæŒç»­çš„è¿‡ç¨‹ã€‚å¦‚æœåªä¸ºäº†çŸ­æœŸçš„å‡ï¼Œé‚£å°±åˆèµ°å›ä¹‹å‰çš„è€è·¯äº†ã€‚ä½†æ˜¯é˜¶æ®µæ€§çš„å°ç›®æ ‡å¯ä»¥æœ‰ï¼Œæ¯”å¦‚æ¯5æ–¤éƒ½æ˜¯ä¸€ä¸ªæ—¶é—´èŠ‚ç‚¹ï¼Œèƒ½å¤ŸæŒç»­ä¸æ–­çš„ç»™è‡ªå·±æ¿€åŠ±ã€‚</p>
<p><strong>ç›®æ ‡å¾ˆé‡è¦ï¼Œæœ‰äº†ç›®æ ‡æ‰æœ‰æ–¹å‘ï¼</strong></p>
<h2 id="2-ç®¡ä½å˜´ï¼Œè¿ˆå¼€è…¿"><a href="#2-ç®¡ä½å˜´ï¼Œè¿ˆå¼€è…¿" class="headerlink" title="2. ç®¡ä½å˜´ï¼Œè¿ˆå¼€è…¿"></a>2. ç®¡ä½å˜´ï¼Œè¿ˆå¼€è…¿</h2><p><img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fr.sinaimg.cn%2Flarge%2Farticle%2F2e157029fa88a12ae16710ff3e8601b4&refer=http%3A%2F%2Fr.sinaimg.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1627999756&t=a2c5bd3fda535fd24e91c8b6c0c01a76" width="400"></p>
<p>æœ‰äº†ç›®æ ‡ä»¥åï¼Œæ¥ä¸‹æ¥å°±æ˜¯æ‰§è¡Œçš„é˜¶æ®µã€‚é“ç†è¿˜æ˜¯é‚£ä¹ˆç®€å•ï¼Œâ€œèƒ½é‡å®ˆæ’å®šå¾‹â€ã€‚è°ƒæ•´é¥®é£Ÿç»“æ„ï¼Œä½è„‚ä½ç¢³æ°´ï¼Œé«˜è›‹ç™½ï¼ŒåŠ å¼ºçƒ­é‡çš„æ¶ˆè€—ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚</p>
<p>å¯¹æˆ‘æ¥è¯´ï¼Œæ™šä¸ŠåŸºæœ¬éƒ½æ˜¯â€œä»£é¤â€ï¼Œå³çœäº†åƒä¸€é¤é¥­çš„æ—¶é—´ç”¨äºé”»ç‚¼ï¼Œåˆèƒ½æ»¡è¶³èº«ä½“çš„èƒ½é‡è¯‰æ±‚ã€‚åŒæ—¶åšæŒæ¯å¤©30åˆ†é’Ÿä»¥ä¸Šçš„æœ‰æ°§æ¶ˆè€—ã€‚å¯¹äºæœ€å¼€å§‹çš„10æ–¤ï¼Œåœ¨1-2ä¸ªæ˜ŸæœŸå°±èƒ½é™ä¸‹æ¥äº†ã€‚æ…¢æ…¢çš„ä¹Ÿä¼šå˜æˆæ–°çš„ç”Ÿæ´»ä¹ æƒ¯å’Œæ–¹å¼ï¼Œä¸å†æ˜¯ä¸€ä»¶è§‰å¾—â€œç—›è‹¦â€çš„äº‹æƒ…ã€‚</p>
<h2 id="3-åº¦é‡åé¦ˆï¼ŒæŒç»­æ”¹è¿›"><a href="#3-åº¦é‡åé¦ˆï¼ŒæŒç»­æ”¹è¿›" class="headerlink" title="3. åº¦é‡åé¦ˆï¼ŒæŒç»­æ”¹è¿›"></a>3. åº¦é‡åé¦ˆï¼ŒæŒç»­æ”¹è¿›</h2><p><img src="https://upload-images.jianshu.io/upload_images/5125122-a6e9118030ef0228?imageMogr2/auto-orient/strip|imageView2/2/w/1080/format/webp" height="600"></p>
<p>æ¯å¤©è¿›è¡Œä½“é‡åŠä½“è„‚çš„è·Ÿè¸ª,é€‚å½“è°ƒæ•´é¥®é£Ÿçš„ç»“æ„åŠè®­ç»ƒçš„æ–¹æ¡ˆã€‚åº¦é‡æ˜¯æ¯å¤©æé†’è‡ªå·±çš„è­¦é’Ÿï¼Œå½“ä½ æŠµæŒ¡ä¸ä½è¯±æƒ‘çš„æ—¶å€™ï¼Œçœ‹ä¸€çœ‹ï¼Œä¹Ÿè®¸ä½ å°±ä¼šæœ‰ä¸ä¸€æ ·çš„é€‰æ‹©ã€‚</p>
<h1 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h1><p>è¿™å¹¶ä¸æ„å‘³ç€ç»“æŸï¼Œè€Œåªæ˜¯ä¸€ä¸ªå¼€å§‹ã€‚æƒ³æƒ³æœ€å¤§çš„æŒ‘æˆ˜ä¸æ˜¯è¿™4ä¸ªæœˆå‡34æ–¤çš„ä½“é‡ï¼Œè€Œæ˜¯1ä¸ªæœˆåã€1å¹´åï¼Œèƒ½å¦è¿˜èƒ½ä¾æ—§ä¿æŒã€‚æœ€åå¼•ç”¨ã€Šä½ çš„è‡ªå¾‹ï¼Œç»™ä½ è‡ªç”±ã€‹çš„ä¸€æ®µè¯æ¥å‹‰åŠ±è‡ªå·±ã€‚</p>
<blockquote>
<p>äººç”Ÿçš„è‡ªå¾‹æ˜¯å¯¹è‡ªå·±çš„æ€æƒ³ã€æ—¶é—´ã€ç²¾åŠ›ã€æƒ…ç»ªã€èµ„æºç­‰å¤šæ–¹é¢è¿›è¡Œæœ‰æ•ˆç®¡ç†ï¼Œè‡ªå¾‹ä¸€æ—¦æˆä¸ºæ·±å…¥éª¨é«“çš„ä¹ æƒ¯ï¼Œå°†ä¼šç»ˆç”Ÿå—ç›Šï¼›åœ¨è‡ªå¾‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿä¼šæ›´æ·±åˆ»åœ°è®¤è¯†è‡ªå·±ï¼Œå…‹æœæµ®èºã€è¿œç¦»ç„¦è™‘ã€èµ°å‡ºè¿·èŒ«ï¼Œé‡Šæ”¾å‡ºè‡ªå·±æ›´å¤§çš„æ½œåŠ›ï¼›è‡ªå¾‹èƒ½å¤Ÿå¸¦ç»™ä½ å‘è‡ªå†…å¿ƒçš„å¹³é™å’Œäº«å—ã€‚å› ä¸ºä½ çŸ¥é“ï¼Œè‡ªå·±åœ¨ä¸€å¤©å¤©åœ°æ”¹å˜ï¼Œèƒ½åšæŒä¸‹å»çš„è‡ªå¾‹ï¼Œéƒ½ä¼šæˆä¸ºèœ•å˜çš„å¥‘æœºã€‚é«˜çº§é«˜æ•ˆçš„è‡ªå¾‹ä¼šè®©ä½ æ‹¥æœ‰æ—¶é—´ã€é‡‘é’±ç”šè‡³æ€æƒ³çš„è‡ªç”±ï¼Œä¼šç»™ä½ çš„äººç”Ÿå¸¦æ¥æ›´å¤šçš„é€‰æ‹©ç©ºé—´</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2021/07/04/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ16ï¼‰-Gradleä¾èµ–ç®¡ç†ç¯‡/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é»„ä¿Šå½¬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JunBin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/07/04/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ16ï¼‰-Gradleä¾èµ–ç®¡ç†ç¯‡/" itemprop="url">
                  ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ16ï¼‰- Gradleä¾èµ–ç®¡ç†ç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-07-04T20:19:55+08:00">
                2021-07-04
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/07/04/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ16ï¼‰-Gradleä¾èµ–ç®¡ç†ç¯‡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2021/07/04/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ16ï¼‰-Gradleä¾èµ–ç®¡ç†ç¯‡/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡<a href="https://juejin.cn/post/6979198588630859806" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ15ï¼‰- æ•°æ®åº“é‡æ„ç¤ºä¾‹ç¯‡</a>æˆ‘ä»¬æåˆ°CloudDiskå›¢é˜Ÿå·²ç»æ‹†åˆ†æˆäº†å¤šä»“åº“å¼€å‘ï¼Œä½†å„ä¸ªæ¨¡å—å„è‡ªç»´æŠ¤äº†ç¬¬ä¸‰æ–¹åº“ã€‚é™¤äº†ç‰ˆæœ¬ä¸ç»Ÿä¸€ã€ä¹Ÿå¯¼è‡´æ‰“åŒ…æ„å»ºæ—¶ä¼šå¸¦å…¥å¤šä¸ªç‰ˆæœ¬çš„ä¸‰æ–¹åº“ã€‚</p>
<p>ç”±äºç›®å‰å„ä¸šåŠ¡æ¨¡å—å·²ç»åˆ†ä»“å¼€å‘ï¼Œæˆ‘ä»¬æ— æ³•ext.çš„å£°æ˜ï¼Œç»Ÿä¸€ç‰ˆæœ¬å·åŠå®šä¹‰åº“åˆ«åã€‚æˆ‘ä»¬åªèƒ½ä»¥Gradleæ’ä»¶çš„å½¢å¼å‘å¸ƒåˆ°Mavenåº“ä¸­ï¼Œè¿™æ ·æ‰€æœ‰å…¶ä»–æ¨¡å—å°±å¯ä»¥ç›´æ¥applyä½¿ç”¨ã€‚</p>
<h1 id="CloudDisk-Gradle-æ’ä»¶æ”¹é€ "><a href="#CloudDisk-Gradle-æ’ä»¶æ”¹é€ " class="headerlink" title="CloudDisk Gradle æ’ä»¶æ”¹é€ "></a>CloudDisk Gradle æ’ä»¶æ”¹é€ </h1><h2 id="Gradle-æ’ä»¶"><a href="#Gradle-æ’ä»¶" class="headerlink" title="Gradle æ’ä»¶"></a>Gradle æ’ä»¶</h2><ol>
<li>åˆ›å»ºbuildSrcæ¨¡å—</li>
<li>åˆ›å»ºBasePluginç±»åŠLibPluginExtension</li>
<li>åˆ›å»ºresource/META-INF/gradle-plugin/com.cloud.disk.plugin.properties,å£°æ˜class<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation-class=com.cloud.disk.plugin.BasePlugin</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>4.å‘å¸ƒæ’ä»¶ï¼Œåœ¨ä½¿ç”¨çš„å·¥ç¨‹apply<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &apos;com.cloud.disk.plugin&apos;</span><br></pre></td></tr></table></figure></p>
<p>BasePluginç±»å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class BasePlugin implements Plugin&lt;Project&gt; &#123;</span><br><span class="line"></span><br><span class="line">    public static Project mProject</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    void apply(Project project) &#123;</span><br><span class="line">        mProject=project</span><br><span class="line">        project.extensions.create(&quot;Lib&quot;, LibPluginExtension.class)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>LibPluginExtensionç±»å¦‚ä¸‹,éƒ¨åˆ†ä»£ç çœç•¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">public class LibPluginExtension &#123;</span><br><span class="line">    String roomVersion = &apos;2.2.6&apos;</span><br><span class="line">    String lifeCycleVersion = &apos;2.3.0&apos;</span><br><span class="line">    String hiltVersion = &apos;2.31.2-alpha&apos;</span><br><span class="line">    //... ...</span><br><span class="line"></span><br><span class="line">    void test() &#123;</span><br><span class="line">        BasePlugin.mProject.dependencies &#123;</span><br><span class="line">            testImplementation &quot;junit:junit:$junitVersion&quot;</span><br><span class="line">            testImplementation &quot;org.mockito:mockito-inline:$mockitoVersion&quot;</span><br><span class="line">            testImplementation &quot;android.arch.core:core-testing:1.1.1&quot;</span><br><span class="line">            testImplementation &quot;com.google.truth:truth:1.0.1&quot;</span><br><span class="line">            testImplementation &apos;com.tngtech.archunit:archunit-junit4:0.15.0&apos;</span><br><span class="line">            testImplementation &quot;org.robolectric:robolectric:$robolectricVersion&quot;</span><br><span class="line">            testImplementation &apos;androidx.test:core:1.3.0&apos;</span><br><span class="line">            testImplementation &apos;androidx.test.ext:junit:1.1.2&apos;</span><br><span class="line">            testImplementation &quot;androidx.test.espresso:espresso-core:$espressoVersion&quot;</span><br><span class="line">            testImplementation &quot;androidx.test.espresso:espresso-intents:$espressoVersion&quot;</span><br><span class="line">            debugImplementation &quot;androidx.fragment:fragment-testing:1.3.1&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void room() &#123;</span><br><span class="line">        BasePlugin.mProject.dependencies &#123;</span><br><span class="line">            implementation &quot;androidx.room:room-runtime:$roomVersion&quot;</span><br><span class="line">            implementation &quot;androidx.room:room-ktx:$roomVersion&quot;</span><br><span class="line">            kapt &quot;androidx.room:room-compiler:$roomVersion&quot;</span><br><span class="line">            testImplementation &quot;androidx.room:room-testing:$roomVersion&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void coroutines() &#123;</span><br><span class="line">        BasePlugin.mProject.dependencies &#123;</span><br><span class="line">            implementation &quot;org.jetbrains.kotlinx:kotlinx-coroutines-core:$coroutinesVersion&quot;</span><br><span class="line">            implementation &quot;org.jetbrains.kotlinx:kotlinx-coroutines-android:$coroutinesVersion&quot;</span><br><span class="line">            testImplementation &quot;org.jetbrains.kotlinx:kotlinx-coroutines-test:1.3.3&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     </span><br><span class="line">    // ... ...</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="CloudDisk-æ”¹é€ "><a href="#CloudDisk-æ”¹é€ " class="headerlink" title="CloudDisk æ”¹é€ "></a>CloudDisk æ”¹é€ </h2><ol>
<li><p>dynamicBundleæ¨¡å—ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation &apos;com.cloud.disk:api:1.0.0&apos;</span><br><span class="line">    implementation &apos;com.cloud.disk:library:1.0.0&apos;</span><br><span class="line">    implementation &apos;com.cloud.disk:platform:1.0.0&apos;</span><br><span class="line"></span><br><span class="line">    project.Lib.kotlin()</span><br><span class="line">    project.Lib.supportV4()</span><br><span class="line">    project.Lib.appCompact()</span><br><span class="line">    project.Lib.material()</span><br><span class="line">    project.Lib.router()</span><br><span class="line">    project.Lib.mvvm()</span><br><span class="line">    project.Lib.ktx()</span><br><span class="line">    project.Lib.coroutines()</span><br><span class="line">    project.Lib.room()</span><br><span class="line">    project.Lib.hilt()</span><br><span class="line">    project.Lib.test()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>dynamicDebugæ¨¡å—ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    implementation &apos;com.cloud.disk:api:1.0.0&apos;</span><br><span class="line">    implementation project(&apos;:dynamicBundle&apos;)</span><br><span class="line"></span><br><span class="line">    project.Lib.hilt()</span><br><span class="line">    project.Lib.test()</span><br><span class="line">    project.Lib.appCompact()</span><br><span class="line">    project.Lib.material()</span><br><span class="line">    project.Lib.constraintlayout()</span><br><span class="line">    project.Lib.kotlin()</span><br><span class="line">    project.Lib.ktx()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>å®Œæ•´ä¿®æ”¹è§<a href="https://github.com/junbin1011/CloudDisk/commit/8e1b7a8c228ecad2b6a1b14deba824cfe9cd80e4" target="_blank" rel="noopener">Github</a></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬ç¯‡ä¸»è¦åˆ†äº«äº† CloudDisk Gradle æ’ä»¶æ”¹é€ ï¼Œç»Ÿä¸€çš„ä¸‰æ–¹åº“çš„ç‰ˆæœ¬ç®¡ç†åŠç®€åŒ–ä¾èµ–è°ƒç”¨ï¼Œæœ‰æ•ˆçš„è§£å†³äº†ä¸‰æ–¹åº“ç‰ˆæœ¬ä¸ç»Ÿä¸€é—®é¢˜ã€‚</p>
<p>éšç€é‡æ„å·¥ä½œçš„æŒç»­ï¼Œå„ä¸ªæ¨¡å—å·²ç»è¡¥å……äº†è¶³é‡çš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œä½†CloudDiskå›¢é˜Ÿç›®å‰çš„CIåªæä¾›æ‰“åŒ…çš„åŠŸèƒ½ï¼Œä¾›æµ‹è¯•å›¢é˜Ÿè¿›è¡ŒéªŒè¯ã€‚åˆ†ä»“ä»¥åä¹Ÿæ²¡æœ‰å¯¹ç‹¬ç«‹æ¨¡å—ä»“åº“å»ºç«‹æµæ°´çº¿ï¼Œæµ‹è¯•å›¢é˜Ÿè¿˜æ˜¯åªèƒ½åœ¨æœ€ååšé›†æˆçš„éªŒæ”¶ã€‚</p>
<p>ä¸‹ä¸€ç¯‡ï¼Œç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ17ï¼‰- æµæ°´çº¿è®¾è®¡ç¯‡ã€‚æˆ‘ä»¬å°†é‡æ–°å¯¹CloudDiskè¿›è¡Œæµæ°´çº¿çš„è®¾è®¡ï¼Œå¿…é¡»æ»¡è¶³è´¨é‡é—¨ç¦æ£€æŸ¥åŠæ ¹æ®æ¨¡å—ã€é›†æˆï¼Œåˆ¶å®šå¯¹åº”çš„ç­–ç•¥ã€‚</p>
<h1 id="CloudDiskç¤ºä¾‹ä»£ç "><a href="#CloudDiskç¤ºä¾‹ä»£ç " class="headerlink" title="CloudDiskç¤ºä¾‹ä»£ç "></a>CloudDiskç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/junbin1011/CloudDisk" target="_blank" rel="noopener">CloudDisk</a></p>
<h1 id="ç³»åˆ—é“¾æ¥"><a href="#ç³»åˆ—é“¾æ¥" class="headerlink" title="ç³»åˆ—é“¾æ¥"></a>ç³»åˆ—é“¾æ¥</h1><p><a href="https://juejin.cn/post/6943470229905211422" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ1ï¼‰- å¼€ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6945313969556946980" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ2ï¼‰-æ¶æ„ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6947855094272491556" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ3ï¼‰-ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6950077521790500894" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ4ï¼‰-åˆ†æç¯‡</a></p>
<p><a href="https://juejin.cn/post/6952298178095874055" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ5ï¼‰- é‡æ„æ–¹æ³•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6954635678982340622" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ6ï¼‰- æµ‹è¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º</a></p>
<p><a href="https://juejin.cn/post/6963214120178941983" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6966166367821103117" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6970870458660945934" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰</a></p>
<p><a href="https://juejin.cn/post/6973836199655899149" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰- åˆ¶å“ç®¡ç†ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6974634615537401886" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6975877150314332168" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6975877150314332168" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6977702335879315493" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ14ï¼‰- Kotlin+MVVMé‡æ„ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6979198588630859806" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ15ï¼‰- æ•°æ®åº“é‡æ„ç¤ºä¾‹ç¯‡</a></p>
<h1 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h1><p><img src="https://note.youdao.com/yws/api/personal/file/WEBf483992c4f5299577eeb0c039992c8d6?method=download&amp;shareKey=fd4babce2b0d344869bb1b2f7042417d" alt=""></p>
<h1 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h1><ul>
<li>ä½œè€…ï¼šé»„ä¿Šå½¬ </li>
<li><a href="https://junbin.tech/" target="_blank" rel="noopener">åšå®¢ï¼šjunbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="noopener">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="noopener">çŸ¥ä¹: @JunBin</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2021/06/29/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ15ï¼‰-æ•°æ®åº“é‡æ„ç¤ºä¾‹ç¯‡/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é»„ä¿Šå½¬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JunBin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/06/29/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ15ï¼‰-æ•°æ®åº“é‡æ„ç¤ºä¾‹ç¯‡/" itemprop="url">
                  ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ15ï¼‰- æ•°æ®åº“é‡æ„ç¤ºä¾‹ç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-29T20:43:49+08:00">
                2021-06-29
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/06/29/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ15ï¼‰-æ•°æ®åº“é‡æ„ç¤ºä¾‹ç¯‡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2021/06/29/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ15ï¼‰-æ•°æ®åº“é‡æ„ç¤ºä¾‹ç¯‡/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡<a href="https://juejin.cn/post/6977702335879315493" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ14ï¼‰- Kotlin+MVVMé‡æ„ç¤ºä¾‹ç¯‡</a>æˆ‘ä»¬ä»‹ç»äº†åŠ¨æ€æ¨¡å—å›¢é˜Ÿå°†åŠ¨æ€ä»¶ä¸»é¡µåˆ‡æ¢è‡³Kotlinä»£ç ã€é‡æ„ä¸ºMVVMæ¶æ„ï¼Œå¹¶ä¸”è¡¥å……äº†è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ç»è¿‡é‡æ„åï¼Œå›¢é˜Ÿçš„å¼€å‘æ•ˆç‡å’Œç‰ˆæœ¬è´¨é‡æœ‰äº†æ˜æ˜¾çš„æå‡ã€‚ä½†æœ¬åœ°æ•°æ®åº“çš„ç®¡ç†ä¾æ—§è¿˜æ˜¯å¤§é‡çš„sql è¯­å¥æ‹¼å†™ï¼Œéå¸¸ä¸åˆ©äºæ‰©å±•åŠç»´æŠ¤ï¼Œç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•ä¹Ÿéå¸¸éº»çƒ¦ã€‚</p>
<p>Googleå®˜æ–¹çš„å»ºè®®æ˜¯<a href="https://developer.android.com/training/data-storage/room#db-migration-testing" target="_blank" rel="noopener">æˆ‘ä»¬å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨ Roomè€Œä¸æ˜¯ SQLite</a>ã€‚æ¡†æ¶å¸¦æ¥çš„å¥½å¤„æ˜¯èŠ‚çœç¼–å†™å¤§é‡çš„æ¨¡ç‰ˆä»£ç ï¼Œæ˜“äºç»´æŠ¤ï¼ŒåŒæ—¶é¢å‘æ¥å£ï¼Œä¾¿äºæ‰©å±•ã€‚å…³äºæ€§èƒ½æ–¹é¢ï¼Œæœ‰çš„åŒå­¦å¯èƒ½è®¤ä¸ºï¼Œä½¿ç”¨åŸç”Ÿçš„SQLè¯­å¥å¯ä»¥å°†æ€§èƒ½ä¼˜åŒ–åˆ°æè‡´ï¼Œä½†å¾€å¾€å¿½ç•¥äº†ç»´æŠ¤å¤§é‡çš„SQLæ‹¼å†™è¯­å¥ä¹Ÿå¸¦æ¥äº†éå¸¸å¤§çš„æˆæœ¬ï¼Œå†µä¸”æ¡†æ¶ä¹Ÿæ”¯æŒè‡ªå®šä¹‰SQLè¯­å¥ã€‚</p>
<p>æ¥ä¸‹æ¥ç»™å¤§å®¶åˆ†äº«ï¼ŒåŠ¨æ€æ¨¡å—çš„æœ¬åœ°ç¼“å­˜å¦‚ä½•ä»Sqliteå®‰å…¨ã€æ¸è¿›å¼é‡æ„è‡³Roomã€‚</p>
<h1 id="é‡æ„"><a href="#é‡æ„" class="headerlink" title="é‡æ„"></a>é‡æ„</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">A(1.æ¢³ç†ä¸šåŠ¡é€»è¾‘)--&gt;B(2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡)</span><br><span class="line">B--&gt;C(3.è¡¥å……å®ˆæŠ¤æµ‹è¯•)</span><br><span class="line">C--&gt;D(4.ç®€å•è®¾è®¡)</span><br><span class="line">D--&gt;E(5.å°æ­¥å®‰å…¨é‡æ„)</span><br><span class="line">E--&gt;F(6.é›†æˆéªŒæ”¶æµ‹è¯•)</span><br></pre></td></tr></table></figure>
<h2 id="1-æ¢³ç†ä¸šåŠ¡é€»è¾‘"><a href="#1-æ¢³ç†ä¸šåŠ¡é€»è¾‘" class="headerlink" title="1.æ¢³ç†ä¸šåŠ¡é€»è¾‘"></a>1.æ¢³ç†ä¸šåŠ¡é€»è¾‘</h2><p>åŸæœ‰çš„ç¼“å­˜é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æä¾›2ä¸ªåŠŸèƒ½ã€‚</p>
<ul>
<li>æŸ¥è¯¢ç¼“å­˜çš„åŠ¨æ€æ•°æ®</li>
<li>ä¿å­˜ç¼“å­˜çš„åŠ¨æ€æ•°æ®ï¼ˆä¿å­˜ä¸Šä¸€æ¬¡åŠ è½½çš„æ‰€æœ‰æ•°æ®ï¼‰</li>
</ul>
<h2 id="2-åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡"><a href="#2-åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡" class="headerlink" title="2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡"></a>2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">class LocalDataSource @Inject constructor(</span><br><span class="line">        @ApplicationContext private var mContext: Context) : DataSource &#123;</span><br><span class="line"></span><br><span class="line">    //åˆ¤æ–­æ¸¸æ ‡æ˜¯å¦ä¸ºç©º</span><br><span class="line">    override fun getDynamicListFromCache(): List&lt;Dynamic&gt; &#123;</span><br><span class="line">        val dynamicList: MutableList&lt;Dynamic&gt; = ArrayList()</span><br><span class="line">        val dataBaseHelper = DataBaseHelper(mContext)</span><br><span class="line">        val c = dataBaseHelper.writableDatabase.query(DataBaseHelper.dynamic_info, null, null, null, null, null, null)</span><br><span class="line">        if (c.moveToFirst()) &#123; //åˆ¤æ–­æ¸¸æ ‡æ˜¯å¦ä¸ºç©º</span><br><span class="line">            for (i in 0 until c.count) &#123;</span><br><span class="line">                c.move(i) //ç§»åŠ¨åˆ°æŒ‡å®šè®°å½•</span><br><span class="line">                val id = c.getInt(c.getColumnIndex(DataBaseHelper.id))</span><br><span class="line">                val content = c.getString(c.getColumnIndex(DataBaseHelper.content))</span><br><span class="line">                val date = c.getLong(c.getColumnIndex(DataBaseHelper.date))</span><br><span class="line">                dynamicList.add(Dynamic(id, content, date))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return dynamicList</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun saveDynamicToCache(dynamicList: List&lt;Dynamic&gt;?) &#123;</span><br><span class="line">        val dataBaseHelper = DataBaseHelper(mContext)</span><br><span class="line">        dynamicList?.let &#123;</span><br><span class="line">            dataBaseHelper.writableDatabase.delete(DataBaseHelper.dynamic_info, null, null)</span><br><span class="line">            for ((id, content, date) in dynamicList) &#123;</span><br><span class="line">                val cv = ContentValues()</span><br><span class="line">                cv.put(DataBaseHelper.id, id)</span><br><span class="line">                cv.put(DataBaseHelper.content, content)</span><br><span class="line">                cv.put(DataBaseHelper.date, date)</span><br><span class="line">                dataBaseHelper.writableDatabase.insert(DataBaseHelper.dynamic_info, null, cv)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸»è¦å­˜åœ¨é—®é¢˜ï¼š</p>
<ul>
<li>è¾ƒå¤šæ¨¡ç‰ˆä»£ç ï¼Œä¸åˆ©äºç»´æŠ¤æ‰©å±•</li>
<li>æ²¡æœ‰é‡‡ç”¨äº‹åŠ¡ç®¡ç†ï¼Œæç«¯å¤§æ•°æ®æƒ…å†µä¸‹ï¼Œå¯èƒ½æœ‰å¼‚å¸¸</li>
<li>æ²¡æœ‰ä»»ä½•çš„å®ˆæŠ¤æµ‹è¯•</li>
</ul>
<h2 id="3-è¡¥å……å®ˆæŠ¤æµ‹è¯•"><a href="#3-è¡¥å……å®ˆæŠ¤æµ‹è¯•" class="headerlink" title="3.è¡¥å……å®ˆæŠ¤æµ‹è¯•"></a>3.è¡¥å……å®ˆæŠ¤æµ‹è¯•</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(AndroidJUnit4::class)</span><br><span class="line">@MediumTest</span><br><span class="line">class LocalDataSourceTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `should get dynamic is empty when database has not data`() &#123;</span><br><span class="line">        //given</span><br><span class="line">        val localDataSource = LocalDataSource(ApplicationProvider.getApplicationContext())</span><br><span class="line">        //when</span><br><span class="line">        val dynamicListFromCache = localDataSource.getDynamicListFromCache()</span><br><span class="line">        //then</span><br><span class="line">        assertThat(dynamicListFromCache).isEmpty()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `should get dynamic success when database has data`() &#123;</span><br><span class="line">        //given</span><br><span class="line">        val localDataSource = LocalDataSource(ApplicationProvider.getApplicationContext())</span><br><span class="line">        localDataSource.saveDynamicToCache(getMockData())</span><br><span class="line">        //when</span><br><span class="line">        val dynamicListFromCache = localDataSource.getDynamicListFromCache()</span><br><span class="line">        //then</span><br><span class="line">        val dynamicOne = dynamicListFromCache[0]</span><br><span class="line">        assertThat(dynamicOne.id).isEqualTo(1)</span><br><span class="line">        assertThat(dynamicOne.content).isEqualTo(&quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼&quot;)</span><br><span class="line">        assertThat(dynamicOne.date).isEqualTo(1615963675000L)</span><br><span class="line">        val dynamicTwo = dynamicListFromCache[1]</span><br><span class="line">        assertThat(dynamicTwo.id).isEqualTo(2)</span><br><span class="line">        assertThat(dynamicTwo.content).isEqualTo(&quot;è¿™ä¸ªè¿ç»­å‰§å€¼å¾—è¿½ï¼&quot;)</span><br><span class="line">        assertThat(dynamicTwo.date).isEqualTo(1615963688000L)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private fun getMockData(): ArrayList&lt;Dynamic&gt; &#123;</span><br><span class="line">        val dynamicList = ArrayList&lt;Dynamic&gt;()</span><br><span class="line">        dynamicList.add(Dynamic(1, &quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼&quot;, 1615963675000L))</span><br><span class="line">        dynamicList.add(Dynamic(2, &quot;è¿™ä¸ªè¿ç»­å‰§å€¼å¾—è¿½ï¼&quot;, 1615963688000L))</span><br><span class="line">        return dynamicList</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-ç®€å•è®¾è®¡"><a href="#4-ç®€å•è®¾è®¡" class="headerlink" title="4.ç®€å•è®¾è®¡"></a>4.ç®€å•è®¾è®¡</h2><p>åˆ†æ­¥è¿›è¡Œé‡æ„ï¼Œå°æ­¥éªŒè¯ã€‚</p>
<ol>
<li>å°†SQLiteOpenHelperç®¡ç†æ•°æ®åº“æ›¿æ¢æˆRoomçš„ç®¡ç†ï¼Œä½†è¿˜æ˜¯ç»´æŒåŸæœ‰çš„SQLæ“ä½œæ–¹å¼</li>
<li>å°†åŸæœ‰çš„SQLæ“ä½œæ–¹å¼è°ƒæ•´ä¸ºROOMçš„Daoå½¢å¼</li>
<li>ä½¿ç”¨Coroutineç®¡ç†æ•°æ®åº“çš„å¼‚æ­¥æ“ä½œ</li>
<li>è°ƒæ•´å·²æœ‰çš„æµ‹è¯•ç”¨ä¾‹</li>
</ol>
<h2 id="5-å°æ­¥å®‰å…¨é‡æ„"><a href="#5-å°æ­¥å®‰å…¨é‡æ„" class="headerlink" title="5.å°æ­¥å®‰å…¨é‡æ„"></a>5.å°æ­¥å®‰å…¨é‡æ„</h2><h3 id="å°†SQLiteOpenHelperç®¡ç†æ•°æ®åº“æ›¿æ¢æˆRoomçš„ç®¡ç†ï¼Œä½†è¿˜æ˜¯ç»´æŒåŸæœ‰çš„SQLæ“ä½œæ–¹å¼"><a href="#å°†SQLiteOpenHelperç®¡ç†æ•°æ®åº“æ›¿æ¢æˆRoomçš„ç®¡ç†ï¼Œä½†è¿˜æ˜¯ç»´æŒåŸæœ‰çš„SQLæ“ä½œæ–¹å¼" class="headerlink" title="å°†SQLiteOpenHelperç®¡ç†æ•°æ®åº“æ›¿æ¢æˆRoomçš„ç®¡ç†ï¼Œä½†è¿˜æ˜¯ç»´æŒåŸæœ‰çš„SQLæ“ä½œæ–¹å¼"></a>å°†SQLiteOpenHelperç®¡ç†æ•°æ®åº“æ›¿æ¢æˆRoomçš„ç®¡ç†ï¼Œä½†è¿˜æ˜¯ç»´æŒåŸæœ‰çš„SQLæ“ä½œæ–¹å¼</h3><ol>
<li>beanæ”¹é€ ï¼Œæ³¨æ„å­—æ®µä¸è¡¨åéœ€è¦ä¸åŸæ¥ä¸€è‡´</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Entity(tableName=&quot;dynamic_info&quot;)</span><br><span class="line">data class Dynamic(@PrimaryKey @ColumnInfo(name = &quot;id&quot;) val id: Int,</span><br><span class="line">                   @ColumnInfo(name = &quot;content&quot;) val content: String,</span><br><span class="line">                   @ColumnInfo(name = &quot;date&quot;) val date: Long) &#123;</span><br><span class="line">    @Ignore</span><br><span class="line">    val formatDate = DateUtil.getDateToString(date)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>ä½¿ç”¨SupportSQLiteOpenHelperè¿›è¡Œç®¡ç†ï¼Œç»§ç»­ä»¥writableDatabaseè¿›è¡Œç®¡ç†</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">class LocalDataSource @Inject constructor(</span><br><span class="line">        @ApplicationContext private var mContext: Context) : DataSource &#123;</span><br><span class="line"></span><br><span class="line">    val db = Room.databaseBuilder(</span><br><span class="line">            mContext,</span><br><span class="line">            AppDatabase::class.java, &quot;dynamic.db&quot;</span><br><span class="line">    ).build()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //åˆ¤æ–­æ¸¸æ ‡æ˜¯å¦ä¸ºç©º</span><br><span class="line">    override fun getDynamicListFromCache(): List&lt;Dynamic&gt; &#123;</span><br><span class="line">        val dynamicList: MutableList&lt;Dynamic&gt; = ArrayList()</span><br><span class="line">        val dataBaseHelper = db.openHelper</span><br><span class="line">        val c = dataBaseHelper.writableDatabase.query(&quot;&quot;)</span><br><span class="line">        if (c.moveToFirst()) &#123; //åˆ¤æ–­æ¸¸æ ‡æ˜¯å¦ä¸ºç©º</span><br><span class="line">            for (i in 0 until c.count) &#123;</span><br><span class="line">                c.move(i) //ç§»åŠ¨åˆ°æŒ‡å®šè®°å½•</span><br><span class="line">                val id = c.getInt(c.getColumnIndex(DataBaseHelper.id))</span><br><span class="line">                val content = c.getString(c.getColumnIndex(DataBaseHelper.content))</span><br><span class="line">                val date = c.getLong(c.getColumnIndex(DataBaseHelper.date))</span><br><span class="line">                dynamicList.add(Dynamic(id, content, date))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return dynamicList</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun saveDynamicToCache(dynamicList: List&lt;Dynamic&gt;?) &#123;</span><br><span class="line">        val dataBaseHelper = db.openHelper</span><br><span class="line">        dynamicList?.let &#123;</span><br><span class="line">            dataBaseHelper.writableDatabase.delete(DataBaseHelper.dynamic_info, null, null)</span><br><span class="line">            for ((id, content, date) in dynamicList) &#123;</span><br><span class="line">                val cv = ContentValues()</span><br><span class="line">                cv.put(DataBaseHelper.id, id)</span><br><span class="line">                cv.put(DataBaseHelper.content, content)</span><br><span class="line">                cv.put(DataBaseHelper.date, date)</span><br><span class="line">                dataBaseHelper.writableDatabase.insert(DataBaseHelper.dynamic_info, SQLiteDatabase.CONFLICT_REPLACE, cv)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="å°†åŸæœ‰çš„SQLæ“ä½œæ–¹å¼è°ƒæ•´ä¸ºROOMçš„Daoå½¢å¼"><a href="#å°†åŸæœ‰çš„SQLæ“ä½œæ–¹å¼è°ƒæ•´ä¸ºROOMçš„Daoå½¢å¼" class="headerlink" title="å°†åŸæœ‰çš„SQLæ“ä½œæ–¹å¼è°ƒæ•´ä¸ºROOMçš„Daoå½¢å¼"></a>å°†åŸæœ‰çš„SQLæ“ä½œæ–¹å¼è°ƒæ•´ä¸ºROOMçš„Daoå½¢å¼</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class LocalDataSource @Inject constructor(</span><br><span class="line">        @ApplicationContext private var mContext: Context) : DataSource &#123;</span><br><span class="line"></span><br><span class="line">    private val db = Room.databaseBuilder(</span><br><span class="line">            mContext,</span><br><span class="line">            AppDatabase::class.java, &quot;dynamic.db&quot;</span><br><span class="line">    ).build()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //åˆ¤æ–­æ¸¸æ ‡æ˜¯å¦ä¸ºç©º</span><br><span class="line">    override  fun getDynamicListFromCache(): List&lt;Dynamic&gt; &#123;</span><br><span class="line">        return db.dynamicDao().getAll()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override  fun saveDynamicToCache(dynamicList: List&lt;Dynamic&gt;?) &#123;</span><br><span class="line"></span><br><span class="line">        dynamicList?.let &#123;</span><br><span class="line">            db.dynamicDao().deleteAll()</span><br><span class="line">            db.dynamicDao().insertAll(*it.toTypedArray())</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="ä½¿ç”¨Coroutineç®¡ç†æ•°æ®åº“çš„å¼‚æ­¥æ“ä½œ"><a href="#ä½¿ç”¨Coroutineç®¡ç†æ•°æ®åº“çš„å¼‚æ­¥æ“ä½œ" class="headerlink" title="ä½¿ç”¨Coroutineç®¡ç†æ•°æ®åº“çš„å¼‚æ­¥æ“ä½œ"></a>ä½¿ç”¨Coroutineç®¡ç†æ•°æ®åº“çš„å¼‚æ­¥æ“ä½œ</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Dao</span><br><span class="line">interface DynamicDao &#123;</span><br><span class="line">    @Query(&quot;SELECT * FROM dynamic_info&quot;)</span><br><span class="line">    suspend fun getAll(): List&lt;Dynamic&gt;</span><br><span class="line"></span><br><span class="line">    @Insert</span><br><span class="line">    suspend fun insertAll(vararg dynamic: Dynamic)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Query(&quot;DELETE FROM dynamic_info&quot;)</span><br><span class="line">    suspend fun deleteAll()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="è°ƒæ•´å·²æœ‰çš„æµ‹è¯•ç”¨ä¾‹"><a href="#è°ƒæ•´å·²æœ‰çš„æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="è°ƒæ•´å·²æœ‰çš„æµ‹è¯•ç”¨ä¾‹"></a>è°ƒæ•´å·²æœ‰çš„æµ‹è¯•ç”¨ä¾‹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">@ExperimentalCoroutinesApi</span><br><span class="line">@RunWith(AndroidJUnit4::class)</span><br><span class="line">@MediumTest</span><br><span class="line">class LocalDataSourceTest &#123;</span><br><span class="line">    private val testDispatcher = TestCoroutineDispatcher()</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    fun setUp() &#123;</span><br><span class="line">        Dispatchers.setMain(testDispatcher)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    fun tearDown() &#123;</span><br><span class="line">        Dispatchers.resetMain()</span><br><span class="line">        testDispatcher.cleanupTestCoroutines()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `should get dynamic is empty when database has not data`() = runBlocking &#123;</span><br><span class="line">        //given</span><br><span class="line">        val localDataSource = LocalDataSource(ApplicationProvider.getApplicationContext())</span><br><span class="line">        //when</span><br><span class="line">        val dynamicListFromCache = localDataSource.getDynamicListFromCache()</span><br><span class="line">        //then</span><br><span class="line">        assertThat(dynamicListFromCache).isEmpty()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `should get dynamic success when database has data`() = runBlocking &#123;</span><br><span class="line">        //given</span><br><span class="line">        val localDataSource = LocalDataSource(ApplicationProvider.getApplicationContext())</span><br><span class="line">        localDataSource.saveDynamicToCache(getMockData())</span><br><span class="line">        //when</span><br><span class="line">        val dynamicListFromCache = localDataSource.getDynamicListFromCache()</span><br><span class="line">        //then</span><br><span class="line">        val dynamicOne = dynamicListFromCache[0]</span><br><span class="line">        assertThat(dynamicOne.id).isEqualTo(1)</span><br><span class="line">        assertThat(dynamicOne.content).isEqualTo(&quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼&quot;)</span><br><span class="line">        assertThat(dynamicOne.date).isEqualTo(1615963675000L)</span><br><span class="line">        val dynamicTwo = dynamicListFromCache[1]</span><br><span class="line">        assertThat(dynamicTwo.id).isEqualTo(2)</span><br><span class="line">        assertThat(dynamicTwo.content).isEqualTo(&quot;è¿™ä¸ªè¿ç»­å‰§å€¼å¾—è¿½ï¼&quot;)</span><br><span class="line">        assertThat(dynamicTwo.date).isEqualTo(1615963688000L)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private fun getMockData(): ArrayList&lt;Dynamic&gt; &#123;</span><br><span class="line">        val dynamicList = ArrayList&lt;Dynamic&gt;()</span><br><span class="line">        dynamicList.add(Dynamic(1, &quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼&quot;, 1615963675000L))</span><br><span class="line">        dynamicList.add(Dynamic(2, &quot;è¿™ä¸ªè¿ç»­å‰§å€¼å¾—è¿½ï¼&quot;, 1615963688000L))</span><br><span class="line">        return dynamicList</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-é›†æˆéªŒæ”¶æµ‹è¯•"><a href="#6-é›†æˆéªŒæ”¶æµ‹è¯•" class="headerlink" title="6.é›†æˆéªŒæ”¶æµ‹è¯•"></a>6.é›†æˆéªŒæ”¶æµ‹è¯•</h2><ol>
<li><p>å…è¡ŒDynamicæ¨¡å—æ‰€æœ‰å®ˆæŠ¤æµ‹è¯•ï¼ŒæˆåŠŸ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./gradlew dynamicBundle:testDUT</span><br><span class="line">./gradlew dynamicDebug:testDUT</span><br></pre></td></tr></table></figure>
</li>
<li><p>ç¼–è¯‘è¿è¡ŒDynamicDebugå‡ºç°å¼‚å¸¸å¦‚ä¸‹ï¼š</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalStateException: Pre-packaged database has an invalid schema: dynamic_info(com.cloud.disk.bundle.dynamic.Dynamic).</span><br><span class="line">    Expected:</span><br><span class="line">   TableInfo&#123;name=&apos;dynamic_info&apos;, columns=&#123;date=Column&#123;name=&apos;date&apos;, type=&apos;INTEGER&apos;, affinity=&apos;3&apos;, notNull=true, primaryKeyPosition=0, defaultValue=&apos;null&apos;&#125;, content=Column&#123;name=&apos;content&apos;, type=&apos;TEXT&apos;, affinity=&apos;2&apos;, notNull=true, primaryKeyPosition=0, defaultValue=&apos;null&apos;&#125;, id=Column&#123;name=&apos;id&apos;, type=&apos;INTEGER&apos;, affinity=&apos;3&apos;, notNull=true, primaryKeyPosition=1, defaultValue=&apos;null&apos;&#125;&#125;, foreignKeys=[], indices=[]&#125;</span><br><span class="line">    Found:</span><br><span class="line">   TableInfo&#123;name=&apos;dynamic_info&apos;, columns=&#123;date=Column&#123;name=&apos;date&apos;, type=&apos;LONG&apos;, affinity=&apos;1&apos;, notNull=false, primaryKeyPosition=0, defaultValue=&apos;null&apos;&#125;, id=Column&#123;name=&apos;id&apos;, type=&apos;INTEGER&apos;, affinity=&apos;3&apos;, notNull=false, primaryKeyPosition=1, defaultValue=&apos;null&apos;&#125;, content=Column&#123;name=&apos;content&apos;, type=&apos;VARCHAR(1024)&apos;, affinity=&apos;2&apos;, notNull=false, primaryKeyPosition=0, defaultValue=&apos;null&apos;&#125;&#125;, foreignKeys=[], indices=[]&#125;</span><br><span class="line">       at androidx.room.RoomOpenHelper.checkIdentity(RoomOpenHelper.java:163)</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æµ‹è¯•é˜¶æ®µè¿è¡Œåœ¨JVMçš„ç¯å¢ƒä¸Šï¼Œæ²¡æœ‰æå‰å‘ç°æ•°æ®è¿ç§»çš„é—®é¢˜ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ROOMçš„Migrationæœºåˆ¶è¿›è¡Œæ•°æ®å¤‡ä»½è¿ç§»ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">private val MIGRATION_1_2 = object : Migration(1, 2) &#123;</span><br><span class="line">      override fun migrate(database: SupportSQLiteDatabase) &#123;</span><br><span class="line">          database.execSQL(&quot;ALTER TABLE dynamic_info RENAME TO dynamic_info_back_up&quot;)</span><br><span class="line">          database.execSQL(&quot;CREATE TABLE dynamic_info ( id  INTEGER PRIMARY KEY NOT NULL, content TEXT NOT NULL,date INTEGER NOT NULL)&quot;)</span><br><span class="line">          database.execSQL(&quot;INSERT INTO dynamic_info (id, content,date) SELECT id, content,date FROM dynamic_info_back_up&quot;)</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  private val db = Room.databaseBuilder(</span><br><span class="line">          mContext,</span><br><span class="line">          AppDatabase::class.java, &quot;dynamic.db&quot;</span><br><span class="line">  ).addMigrations(MIGRATION_1_2).build()</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šè¿ç§»åŠæµ‹è¯•è§<a href="https://developer.android.google.cn/training/data-storage/room/migrating-db-versions" target="_blank" rel="noopener">è¿ç§» Room æ•°æ®åº“</a>ã€<a href="https://developer.android.google.cn/training/data-storage/room/sqlite-room-migration" target="_blank" rel="noopener">ä»SQliteè¿ç§»åˆ°Room</a></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬ç¯‡æˆ‘ä»¬åˆ†äº«äº†åŠ¨æ€æ¨¡å—æ•°æ®åº“ä»Sqliteè¿ç§»è‡³Roomçš„è¿‡ç¨‹ï¼Œä½¿ç”¨æ¡†æ¶èŠ‚çœç¼–å†™å¤§é‡çš„æ¨¡ç‰ˆä»£ç ï¼Œæ˜“äºç»´æŠ¤åŠæ‰©å±•ã€‚</p>
<p>å‰é¢CloudDiskå›¢é˜Ÿå·²ç»æ‹†åˆ†æˆäº†å¤šä»“åº“å¼€å‘ï¼Œä½†å„ä¸ªæ¨¡å—å„è‡ªç»´æŠ¤äº†ç¬¬ä¸‰æ–¹åº“ã€‚é™¤äº†ç‰ˆæœ¬ä¸ç»Ÿä¸€ã€ä¹Ÿå¯¼è‡´æ‰“åŒ…æ„å»ºæ—¶ä¼šå¸¦å…¥å¤šä¸ªç‰ˆæœ¬çš„ä¸‰æ–¹åº“ã€‚</p>
<p>ä¸‹ä¸€ç¯‡ï¼Œç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ16ï¼‰- Gradleä¾èµ–ç®¡ç†ç¯‡ã€‚æˆ‘ä»¬å°†ç»§ç»­å¯¹CloudDiskçš„Gradleç‰ˆæœ¬è¿›è¡Œç»Ÿä¸€ç®¡ç†æ¼”ç¤ºã€‚</p>
<h1 id="CloudDiskç¤ºä¾‹ä»£ç "><a href="#CloudDiskç¤ºä¾‹ä»£ç " class="headerlink" title="CloudDiskç¤ºä¾‹ä»£ç "></a>CloudDiskç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/junbin1011/CloudDisk" target="_blank" rel="noopener">CloudDisk</a></p>
<h1 id="ç³»åˆ—é“¾æ¥"><a href="#ç³»åˆ—é“¾æ¥" class="headerlink" title="ç³»åˆ—é“¾æ¥"></a>ç³»åˆ—é“¾æ¥</h1><p><a href="https://juejin.cn/post/6943470229905211422" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ1ï¼‰- å¼€ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6945313969556946980" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ2ï¼‰-æ¶æ„ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6947855094272491556" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ3ï¼‰-ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6950077521790500894" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ4ï¼‰-åˆ†æç¯‡</a></p>
<p><a href="https://juejin.cn/post/6952298178095874055" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ5ï¼‰- é‡æ„æ–¹æ³•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6954635678982340622" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ6ï¼‰- æµ‹è¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º</a></p>
<p><a href="https://juejin.cn/post/6963214120178941983" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6966166367821103117" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6970870458660945934" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰</a></p>
<p><a href="https://juejin.cn/post/6973836199655899149" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰- åˆ¶å“ç®¡ç†ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6974634615537401886" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6975877150314332168" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6975877150314332168" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6977702335879315493" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ14ï¼‰- Kotlin+MVVMé‡æ„ç¤ºä¾‹ç¯‡</a></p>
<h1 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h1><p><img src="https://note.youdao.com/yws/api/personal/file/WEBf483992c4f5299577eeb0c039992c8d6?method=download&amp;shareKey=fd4babce2b0d344869bb1b2f7042417d" alt=""></p>
<h1 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h1><ul>
<li>ä½œè€…ï¼šé»„ä¿Šå½¬ </li>
<li><a href="https://junbin.tech/" target="_blank" rel="noopener">åšå®¢ï¼šjunbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="noopener">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="noopener">çŸ¥ä¹: @JunBin</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2021/06/24/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ14ï¼‰-Kotlin-MVVMé‡æ„ç¤ºä¾‹ç¯‡/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é»„ä¿Šå½¬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JunBin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/06/24/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ14ï¼‰-Kotlin-MVVMé‡æ„ç¤ºä¾‹ç¯‡/" itemprop="url">
                  ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ14ï¼‰- Kotlin+MVVMé‡æ„ç¤ºä¾‹ç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-24T20:42:55+08:00">
                2021-06-24
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/06/24/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ14ï¼‰-Kotlin-MVVMé‡æ„ç¤ºä¾‹ç¯‡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2021/06/24/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ14ï¼‰-Kotlin-MVVMé‡æ„ç¤ºä¾‹ç¯‡/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡<a href="https://juejin.cn/post/6975877150314332168" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰-MVPé‡æ„ç¤ºä¾‹ç¯‡</a>ä»‹ç»äº†æ–‡ä»¶æ¨¡å—å›¢é˜Ÿå°†æ–‡ä»¶ä¸»é¡µé‡æ„ä¸ºMVPæ¶æ„ï¼Œå¹¶ä¸”è¡¥å……äº†è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ç»è¿‡é‡æ„åï¼Œå›¢é˜Ÿçš„å¼€å‘æ•ˆç‡å’Œç‰ˆæœ¬è´¨é‡æœ‰äº†æ˜æ˜¾çš„æå‡ã€‚åŠ¨æ€æ¨¡å—çš„ä¸šåŠ¡æ¯”æ–‡ä»¶æ¨¡å—æ›´å¤æ‚ï¼Œå¹¶ä¸”è¿™æ¬¡å›¢é˜Ÿå†³å®šä½¿ç”¨æ–°çš„å¼€å‘è¯­è¨€KotlinåŠMVVMæ¶æ„ã€‚</p>
<p>æœ¬ç¯‡æˆ‘ä»¬å°†æ‹¿DynamicBundleä½œä¸ºä¾‹å­ï¼Œä¸ºå¤§å®¶ç»§ç»­æ¼”ç¤ºå¦‚ä½•ä»Javaä»£ç è¿‡æ¸¡ä¸ºKotlinä»£ç ï¼Œä»¥åŠå¦‚ä½•ä¸€æ­¥ä¸€æ­¥å°†ä¸Šå¸ç±»é‡æ„æ¼”åŒ–ä¸ºMVVMæ¶æ„ã€‚</p>
<p><strong>è§†é¢‘æ¼”ç¤ºåœ°å€:</strong> <a href="https://mp.weixin.qq.com/s/vex4Kn6Ts-dI3KX2Yiuq6w" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/vex4Kn6Ts-dI3KX2Yiuq6w</a></p>
<h1 id="é‡æ„æµç¨‹"><a href="#é‡æ„æµç¨‹" class="headerlink" title="é‡æ„æµç¨‹"></a>é‡æ„æµç¨‹</h1><p>ä»æ–°å›å¿†ä¸‹ä¸Šä¸€ç¯‡æˆ‘ä»¬åˆ†æçš„é‡æ„æµç¨‹ï¼Œå¯¹äºè½¬Kotlinè¯­è¨€ï¼Œæˆ‘ä»¬å»ºè®®ä¹Ÿåšå®Œè‡³ç¬¬3æ­¥ï¼Œæœ‰äº†å®ˆæŠ¤æµ‹è¯•å†è¿›è¡Œè½¬æ¢ï¼Œè¿™æ ·æ›´åŠ å®‰å…¨ã€‚æµç¨‹å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">A(1.æ¢³ç†ä¸šåŠ¡é€»è¾‘)--&gt;B(2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡)</span><br><span class="line">B--&gt;C(3.è¡¥å……å®ˆæŠ¤æµ‹è¯•)</span><br><span class="line">C--&gt;D(4.ç®€å•è®¾è®¡)</span><br><span class="line">D--&gt;E(5.å°æ­¥å®‰å…¨é‡æ„)</span><br><span class="line">E--&gt;F(6.é›†æˆéªŒæ”¶æµ‹è¯•)</span><br></pre></td></tr></table></figure>
<h2 id="1-æ¢³ç†ä¸šåŠ¡é€»è¾‘"><a href="#1-æ¢³ç†ä¸šåŠ¡é€»è¾‘" class="headerlink" title="1. æ¢³ç†ä¸šåŠ¡é€»è¾‘"></a>1. æ¢³ç†ä¸šåŠ¡é€»è¾‘</h2><p>ä¸Šç¯‡æåˆ°æˆ‘ä»¬å¯ä»¥å°è¯•ä»ä¸€ä¸‹å‡ æ–¹é¢æ¥è¡¥å…¨ä¿¡æ¯ã€‚</p>
<ol>
<li>æ‰¾äººï¼šäº§å“ç»ç†ã€è®¾è®¡äººå‘˜ã€æµ‹è¯•äººå‘˜è¿›è¡Œç¡®è®¤å’Œç­”ç–‘</li>
<li>æ‰¾æ–‡æ¡£ï¼šæŸ¥çœ‹åŸæœ‰çš„éœ€æ±‚æ–‡æ¡£ã€è®¾è®¡æ–‡æ¡£ã€æµ‹è¯•ç”¨ä¾‹ã€è®¾è®¡ç¨¿</li>
<li>çœ‹ä»£ç ï¼šä»åŸæœ‰çš„ä»£ç è®¾è®¡ä¸­å»æ¢³ç†ä¸šåŠ¡</li>
</ol>
<p>ç»è¿‡æ¢³ç†ç¡®è®¤ï¼ŒFileBundleçš„ç°æœ‰çš„ä¸šåŠ¡å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">A(è¿›å…¥åŠ¨æ€é¡µé¢)--&gt;B(ä»ç½‘ç»œåŠ è½½åŠ¨æ€åˆ—è¡¨æ•°æ®)</span><br><span class="line">B --&gt; C&#123;æ•°æ®æ˜¯å¦åŠ è½½æˆåŠŸ&#125;</span><br><span class="line">C --&gt;|åŠ è½½æˆåŠŸ| D(æ˜¾ç¤ºåŠ¨æ€åˆ—è¡¨-å†…å®¹å’Œæ—¥æœŸ)</span><br><span class="line">C --&gt;|ç½‘ç»œå¼‚å¸¸| E&#123;æ˜¯å¦å­˜åœ¨æœ¬åœ°ç¼“å­˜æ•°æ®&#125;</span><br><span class="line">C --&gt;|æ•°æ®ä¸ºç©º| F(æ˜¾ç¤ºempty data)</span><br><span class="line">E --&gt;|å­˜åœ¨ç¼“å­˜æ•°æ®|D</span><br><span class="line">E --&gt;|ä¸å­˜åœ¨ç¼“å­˜æ•°æ®|G(æ˜¾ç¤ºNetworkErrorException)</span><br><span class="line">F --&gt;|ç‚¹å‡»è§¦å‘åˆ·æ–°|B</span><br><span class="line">G --&gt;|ç‚¹å‡»è§¦å‘åˆ·æ–°|B</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ—¶é—´è½¬æ¢ä¸º yyyy-MM-dd HH:mm:ss æ˜¾ç¤º</p>
</blockquote>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB65cd0c69aad3249af7aba469f24b7747?method=download&amp;shareKey=d9c2c3005a459ecdec928d81648eedb9" alt=""></p>
<h2 id="2-åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡"><a href="#2-åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡" class="headerlink" title="2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡"></a>2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡</h2><p>æˆ‘ä»¬ä»¥ä¸»è¦ä¸Šå¸ç±»DynamicFragmentä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">@Route(path = &quot;/dynamicBundle/dynamic&quot;)</span><br><span class="line">@AndroidEntryPoint</span><br><span class="line">public class DynamicFragment extends Fragment &#123;</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    DynamicController dynamicController;</span><br><span class="line">    Button btnUpload;</span><br><span class="line">    @Inject</span><br><span class="line">    TransferFile transferFile;</span><br><span class="line"></span><br><span class="line">    private RecyclerView dynamicListRecycleView;</span><br><span class="line">    private TextView tvMessage;</span><br><span class="line"></span><br><span class="line">    public static DynamicFragment newInstance() &#123;</span><br><span class="line">        DynamicFragment fragment = new DynamicFragment();</span><br><span class="line">        Bundle args = new Bundle();</span><br><span class="line">        fragment.setArguments(args);</span><br><span class="line">        return fragment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">                             Bundle savedInstanceState) &#123;</span><br><span class="line">        View view = inflater.inflate(R.layout.fragment_dynamic, container, false);</span><br><span class="line">        btnUpload = view.findViewById(R.id.btn_upload);</span><br><span class="line">        btnUpload.setOnClickListener(v -&gt; uploadDynamic());</span><br><span class="line">        dynamicListRecycleView = view.findViewById(R.id.file_list);</span><br><span class="line">        tvMessage = view.findViewById(R.id.tv_message);</span><br><span class="line">        tvMessage.setOnClickListener(v -&gt; getDynamicList());</span><br><span class="line">        getDynamicList();</span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void uploadDynamic() &#123;</span><br><span class="line">        //ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">        FileInfo fileInfo = transferFile.upload(&quot;/data/data/user.png&quot;);</span><br><span class="line">        dynamicController.post(new Dynamic(0, &quot;ç¬¬ä¸€ä¸ªåŠ¨æ€&quot;, System.currentTimeMillis()), fileInfo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void getDynamicList() &#123;</span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            Message message = new Message();</span><br><span class="line">            try &#123;</span><br><span class="line">                List&lt;Dynamic&gt; dynamicList = dynamicController.getDynamicList();</span><br><span class="line">                message.what = 1;</span><br><span class="line">                message.obj = dynamicList;</span><br><span class="line">            &#125; catch (NetworkErrorException e) &#123;</span><br><span class="line">                message.what = 0;</span><br><span class="line">                message.obj = &quot;NetworkErrorException&quot;;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            mHandler.sendMessage(message);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Handler mHandler = new Handler(new Handler.Callback() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public boolean handleMessage(@NonNull Message msg) &#123;</span><br><span class="line">            if (msg.what == 1) &#123;</span><br><span class="line">                showTip(false);</span><br><span class="line">                //æ˜¾ç¤ºç½‘ç»œæ•°æ®</span><br><span class="line">                List&lt;Dynamic&gt; dynamicList = (List&lt;Dynamic&gt;) msg.obj;</span><br><span class="line">                if (dynamicList == null || dynamicList.size() == 0) &#123;</span><br><span class="line">                    showTip(true);</span><br><span class="line">                    //æ˜¾ç¤ºç©ºæ•°æ®</span><br><span class="line">                    tvMessage.setText(&quot;empty data&quot;);</span><br><span class="line"></span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    DynamicListAdapter fileListAdapter = new DynamicListAdapter(dynamicList, getActivity());</span><br><span class="line">                    dynamicListRecycleView.addItemDecoration(new DividerItemDecoration(</span><br><span class="line">                            getActivity(), DividerItemDecoration.VERTICAL));</span><br><span class="line">                    //è®¾ç½®å¸ƒå±€æ˜¾ç¤ºæ ¼å¼</span><br><span class="line">                    dynamicListRecycleView.setLayoutManager(new LinearLayoutManager(getActivity()));</span><br><span class="line">                    dynamicListRecycleView.setAdapter(fileListAdapter);</span><br><span class="line">                    //ä»ç½‘ç»œä¸­æ›´æ–°åˆ°æ•°æ®ä¿æŒåˆ°ç¼“å­˜ä¹‹ä¸­</span><br><span class="line">                    dynamicController.saveDynamicToCache(dynamicList);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else if (msg.what == 0) &#123;</span><br><span class="line">                //å°è¯•ä»ç¼“å­˜ä¸­è¯»å–æ•°æ®</span><br><span class="line">                List&lt;Dynamic&gt; dynamicList = dynamicController.getDynamicListFromCache();</span><br><span class="line">                if (dynamicList == null || dynamicList.size() == 0) &#123;</span><br><span class="line">                    showTip(true);</span><br><span class="line">                    //æ˜¾ç¤ºå¼‚å¸¸æé†’æ•°æ®</span><br><span class="line">                    tvMessage.setText(msg.obj.toString());</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    DynamicListAdapter fileListAdapter = new DynamicListAdapter(dynamicList, getActivity());</span><br><span class="line">                    dynamicListRecycleView.addItemDecoration(new DividerItemDecoration(</span><br><span class="line">                            getActivity(), DividerItemDecoration.VERTICAL));</span><br><span class="line">                    //è®¾ç½®å¸ƒå±€æ˜¾ç¤ºæ ¼å¼</span><br><span class="line">                    dynamicListRecycleView.setLayoutManager(new LinearLayoutManager(getActivity()));</span><br><span class="line">                    dynamicListRecycleView.setAdapter(fileListAdapter);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    public void showTip(boolean show) &#123;</span><br><span class="line">        if (show) &#123;</span><br><span class="line">            tvMessage.setVisibility(View.VISIBLE);</span><br><span class="line">            dynamicListRecycleView.setVisibility(View.GONE);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            tvMessage.setVisibility(View.GONE);</span><br><span class="line">            dynamicListRecycleView.setVisibility(View.VISIBLE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸»è¦çš„ä¸€äº›è®¾è®¡é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸»è¦çš„è·å–åŠ¨æ€åˆ—è¡¨ã€å¼‚å¸¸é€»è¾‘åˆ¤æ–­ã€æ•°æ®ç¼“å­˜åˆ¤æ–­ã€ç•Œé¢åˆ·æ–°æ§åˆ¶éƒ½æ˜¯åœ¨ä¸€ä¸ªç±»é‡Œé¢ï¼Œä¸åˆ©äºåç»­çš„æ‰©å¼ åŠä¿®æ”¹ç»´æŠ¤ã€‚æˆ‘ä»¬å¸Œæœ›ç±»çš„èŒè´£æ›´åŠ å•ä¸€ï¼Œé€»è¾‘å’Œè§†å›¾èƒ½å¤Ÿè¿›è¡Œåˆ†ç¦»ã€‚</li>
<li>å­˜åœ¨ç²—æš´çš„new Threadè¿›è¡Œç®¡ç†</li>
<li>Handler å­˜åœ¨å†…å­˜æ³„éœ²é£é™©</li>
<li>å­˜åœ¨é‡å¤ä»£ç ï¼Œä¾‹å¦‚åˆ—è¡¨æ•°æ®çš„å±•ç¤º</li>
<li>ä»£ç ä¸­æ²¡æœ‰ä»»ä½•å®ˆæŠ¤æµ‹è¯•</li>
</ol>
<p>å®Œæ•´çš„æ‰€æœ‰ä»£ç è§<a href="https://github.com/junbin1011/CloudDisk/commit/dd2abeb9000d81af340fbface4f25182ada922f0" target="_blank" rel="noopener">Github</a></p>
<h2 id="3-è¡¥å……å®ˆæŠ¤æµ‹è¯•"><a href="#3-è¡¥å……å®ˆæŠ¤æµ‹è¯•" class="headerlink" title="3. è¡¥å……å®ˆæŠ¤æµ‹è¯•"></a>3. è¡¥å……å®ˆæŠ¤æµ‹è¯•</h2><p>å‚è€ƒé‡æ„ç¯‡ä¸­ï¼Œæˆ‘ä»¬åˆ¶å®šçš„ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåšå¤§å‹çš„æµ‹è¯•ï¼Œåšä¸ºå®ˆæŠ¤æµ‹è¯•ã€‚åŒæ ·æˆ‘ä»¬ä¼šå°†æ•°æ®åº“å’Œç½‘ç»œç›¸å…³çš„æ“ä½œè¿›è¡Œmockã€‚æµ‹è¯•ç”¨ä¾‹ä¸»è¦åŒ…å«æ¢³ç†å‡ºæ¥çš„ä¸»è¦ä¸šåŠ¡é€»è¾‘ï¼ŒåŒ…æ‹¬æ­£å¸¸æ˜¾ç¤ºæ•°æ®ã€ç½‘ç»œå¼‚å¸¸å­˜åœ¨ç¼“å­˜æ•°æ®ã€ç½‘ç»œå¼‚å¸¸æ²¡æœ‰ç¼“å­˜æ•°æ®ã€ç©ºæ•°æ®ã€‚ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(AndroidJUnit4::class)</span><br><span class="line">@LargeTest</span><br><span class="line">@HiltAndroidTest</span><br><span class="line">@Config(application = HiltTestApplication::class, shadows = [ShadowDynamicFragment::class, ShadowDynamicController::class])</span><br><span class="line">class DynamicFragmentTest &#123;</span><br><span class="line">    @get:Rule</span><br><span class="line">    var hiltRule = HiltAndroidRule(this)</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `show show dynamic list when get success`() &#123;</span><br><span class="line">        //given</span><br><span class="line">        ShadowDynamicFragment.state = ShadowDynamicFragment.State.SUCCESS</span><br><span class="line">        //when</span><br><span class="line">        val scenario: ActivityScenario&lt;DebugActivity&gt; = ActivityScenario.launch(DebugActivity::class.java)</span><br><span class="line">        scenario.onActivity &#123;</span><br><span class="line">            //then</span><br><span class="line">            onView(withText(&quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼&quot;)).check(matches(isDisplayed()))</span><br><span class="line">            onView(withText(&quot;2021-03-17 14:47:55&quot;)).check(matches(isDisplayed()))</span><br><span class="line">            onView(withText(&quot;è¿™ä¸ªè¿ç»­å‰§å€¼å¾—è¿½ï¼&quot;)).check(matches(isDisplayed()))</span><br><span class="line">            onView(withText(&quot;2021-03-17 14:48:08&quot;)).check(matches(isDisplayed()))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `show show dynamic list when net work exception but have cache`() &#123;</span><br><span class="line">        //given</span><br><span class="line">        ShadowDynamicFragment.state = ShadowDynamicFragment.State.ERROR</span><br><span class="line">        ShadowDynamicController.state = ShadowDynamicController.State.DATA</span><br><span class="line">        //when</span><br><span class="line">        val scenario: ActivityScenario&lt;DebugActivity&gt; = ActivityScenario.launch(DebugActivity::class.java)</span><br><span class="line">        scenario.onActivity &#123;</span><br><span class="line">            //then</span><br><span class="line">            onView(withText(&quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼&quot;)).check(matches(isDisplayed()))</span><br><span class="line">            onView(withText(&quot;2021-03-17 14:47:55&quot;)).check(matches(isDisplayed()))</span><br><span class="line">            onView(withText(&quot;è¿™ä¸ªè¿ç»­å‰§å€¼å¾—è¿½ï¼&quot;)).check(matches(isDisplayed()))</span><br><span class="line">            onView(withText(&quot;2021-03-17 14:48:08&quot;)).check(matches(isDisplayed()))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `show show error tip when net work exception and not have cache`() &#123;</span><br><span class="line">        //given</span><br><span class="line">        ShadowDynamicFragment.state = ShadowDynamicFragment.State.ERROR</span><br><span class="line">        ShadowDynamicController.state = ShadowDynamicController.State.EMPTY</span><br><span class="line">        //when</span><br><span class="line">        val scenario: ActivityScenario&lt;DebugActivity&gt; = ActivityScenario.launch(DebugActivity::class.java)</span><br><span class="line">        scenario.onActivity &#123;</span><br><span class="line">            //then</span><br><span class="line">            onView(withText(&quot;NetworkErrorException&quot;)).check(matches(isDisplayed()))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `show show empty tip when not has data`() &#123;</span><br><span class="line">        //given</span><br><span class="line">        ShadowDynamicFragment.state = ShadowDynamicFragment.State.EMPTY</span><br><span class="line">        //when</span><br><span class="line">        val scenario: ActivityScenario&lt;DebugActivity&gt; = ActivityScenario.launch(DebugActivity::class.java)</span><br><span class="line">        scenario.onActivity &#123;</span><br><span class="line">            //then</span><br><span class="line">            onView(withText(&quot;empty data&quot;)).check(matches(isDisplayed()))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æœ€åæˆ‘ä»¬å®Œæˆäº†åŸºæœ¬çš„å®ˆæŠ¤æµ‹è¯•ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBa713c5f3dbbd69df2e9ae82a30852889?method=download&amp;shareKey=fa9379fdf7bc2823ecf320e842d77dfe" alt=""></p>
<p>å®Œæ•´çš„æ‰€æœ‰ä»£ç è§<a href="https://github.com/junbin1011/CloudDisk/commit/b9505f96999aa24b7b82b9deedc1763e332bf4de" target="_blank" rel="noopener">Github</a></p>
<h2 id="Kotlin"><a href="#Kotlin" class="headerlink" title="Kotlin"></a><a href="https://www.kotlincn.net/docs/reference/" target="_blank" rel="noopener">Kotlin</a></h2><ol>
<li><p>Kotlinä¸Javaæ”¯æŒæ··ç¼–ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ–°å¢çš„ä»£ç ç”¨Kotlinç¼–å†™ã€‚è¯¦ç»†çœ‹Kotlinå®˜ç½‘çš„<a href="https://www.kotlincn.net/docs/reference/java-interop.html" target="_blank" rel="noopener">Javaäº’æ“ä½œ</a></p>
</li>
<li><p>AndroidStudioæ”¯æŒå°†åŸæœ‰çš„Javaä»£ç è½¬æ¢ä¸ºKotlinä»£ç <br><img src="https://note.youdao.com/yws/api/personal/file/WEB5916b63a9bf0243cff8ddd17514ef82e?method=download&amp;shareKey=1e7d24937a02af225417180bcd279599" alt=""></p>
</li>
<li><p>AndroidStudioæ”¯æŒå°†æŸ¥çœ‹Kotlinçš„å­—èŠ‚ç ï¼ŒDecompileä¸ºJavaä»£ç ï¼Œæ–¹ä¾¿ç†è§£ä¸€äº›è¯­æ³•ç‰¹æ€§</p>
</li>
</ol>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBfb70f1af8157bdd7eb5862f6b1f1aef7?method=download&amp;shareKey=6e5e988c2313c3a70fa57ae33b9f03d8" alt=""></p>
<p>Dynamicæ¨¡å—å›¢é˜Ÿæˆå‘˜å†³å®šä½¿ç”¨2æ–¹æ¡ˆï¼Œå°†åŠ¨æ€ä¸»é¡µé¢è½¬æ¢ä¸ºKotlinä»£ç ã€‚</p>
<blockquote>
<p>è½¬åŒ–è¿‡ç¨‹ä¸­ï¼Œå°½é‡ä¸€æ¬¡è½¬æ¢ä¸€ä¸ªç›¸å¯¹å†…èšçš„åŒ…ï¼Œå°æ­¥è½¬æ¢åŠ æµ‹è¯•éªŒè¯ï¼Œè½¬æ¢åå†äººå·¥è¿›è¡ŒReviewå’Œè°ƒæ•´</p>
</blockquote>
<p>é€šè¿‡è½¬æ¢åï¼Œç›®å‰DynamicFragmentçš„ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">@Route(path = &quot;/dynamicBundle/dynamic&quot;)</span><br><span class="line">@AndroidEntryPoint</span><br><span class="line">class DynamicFragment : Fragment() &#123;</span><br><span class="line">    @Inject</span><br><span class="line">    lateinit var dynamicController: DynamicController</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    lateinit var transferFile: TransferFile</span><br><span class="line"></span><br><span class="line">    private lateinit var btnUpload: Button</span><br><span class="line">    private lateinit var dynamicListRecycleView: RecyclerView</span><br><span class="line">    private lateinit var tvMessage: TextView</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,</span><br><span class="line">                              savedInstanceState: Bundle?): View? &#123;</span><br><span class="line">        val view = inflater.inflate(R.layout.fragment_dynamic, container, false)</span><br><span class="line">        btnUpload = view.findViewById(R.id.btn_upload)</span><br><span class="line">        btnUpload.setOnClickListener &#123; uploadDynamic() &#125;</span><br><span class="line">        dynamicListRecycleView = view.findViewById(R.id.file_list)</span><br><span class="line">        tvMessage = view.findViewById(R.id.tv_message)</span><br><span class="line">        tvMessage.setOnClickListener &#123; getDynamicList() &#125;</span><br><span class="line">        getDynamicList()</span><br><span class="line">        return view</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private fun uploadDynamic() &#123;</span><br><span class="line">        //ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">        val fileInfo = transferFile.upload(&quot;/data/data/user.png&quot;)</span><br><span class="line">        fileInfo?.let &#123; dynamicController.post(Dynamic(0, &quot;ç¬¬ä¸€ä¸ªåŠ¨æ€&quot;, System.currentTimeMillis()), it) &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public fun getDynamicList() &#123;</span><br><span class="line">        Thread &#123;</span><br><span class="line">            val message = Message()</span><br><span class="line">            val dynamicList = dynamicController.getDynamicList()</span><br><span class="line">            message.what = 1</span><br><span class="line">            message.obj = dynamicList</span><br><span class="line">            mHandler.sendMessage(message)</span><br><span class="line">        &#125;.start()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    var mHandler = Handler &#123; msg -&gt;</span><br><span class="line">        if (msg.what == 1) &#123;</span><br><span class="line">            showTip(false)</span><br><span class="line">            //æ˜¾ç¤ºç½‘ç»œæ•°æ®</span><br><span class="line">            var dynamicList = mutableListOf&lt;Dynamic&gt;()</span><br><span class="line">            msg.obj?.let &#123; dynamicList = msg.obj as MutableList&lt;Dynamic&gt; &#125;</span><br><span class="line">            if (dynamicList.isEmpty()) &#123;</span><br><span class="line">                showTip(true)</span><br><span class="line">                //æ˜¾ç¤ºç©ºæ•°æ®</span><br><span class="line">                tvMessage.text = &quot;empty data&quot;</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                val fileListAdapter = activity?.let &#123; DynamicListAdapter(dynamicList, it) &#125;</span><br><span class="line">                dynamicListRecycleView.addItemDecoration(DividerItemDecoration(</span><br><span class="line">                        activity, DividerItemDecoration.VERTICAL))</span><br><span class="line">                //è®¾ç½®å¸ƒå±€æ˜¾ç¤ºæ ¼å¼</span><br><span class="line">                dynamicListRecycleView.layoutManager = LinearLayoutManager(activity)</span><br><span class="line">                dynamicListRecycleView.adapter = fileListAdapter</span><br><span class="line">                //ä»ç½‘ç»œä¸­æ›´æ–°åˆ°æ•°æ®ä¿æŒåˆ°ç¼“å­˜ä¹‹ä¸­</span><br><span class="line">                dynamicController.saveDynamicToCache(dynamicList)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else if (msg.what == 0) &#123;</span><br><span class="line">            //å°è¯•ä»ç¼“å­˜ä¸­è¯»å–æ•°æ®</span><br><span class="line">            val dynamicList = dynamicController.getDynamicListFromCache()</span><br><span class="line">            if (dynamicList.isEmpty()) &#123;</span><br><span class="line">                showTip(true)</span><br><span class="line">                //æ˜¾ç¤ºå¼‚å¸¸æé†’æ•°æ®</span><br><span class="line">                tvMessage.text = msg.obj.toString()</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                val fileListAdapter = activity?.let &#123; DynamicListAdapter(dynamicList, it) &#125;</span><br><span class="line">                dynamicListRecycleView.addItemDecoration(DividerItemDecoration(</span><br><span class="line">                        activity, DividerItemDecoration.VERTICAL))</span><br><span class="line">                //è®¾ç½®å¸ƒå±€æ˜¾ç¤ºæ ¼å¼</span><br><span class="line">                dynamicListRecycleView.layoutManager = LinearLayoutManager(activity)</span><br><span class="line">                dynamicListRecycleView.adapter = fileListAdapter</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        false</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun showTip(show: Boolean) &#123;</span><br><span class="line">        if (show) &#123;</span><br><span class="line">            tvMessage.visibility = View.VISIBLE</span><br><span class="line">            dynamicListRecycleView.visibility = View.GONE</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            tvMessage.visibility = View.GONE</span><br><span class="line">            dynamicListRecycleView.visibility = View.VISIBLE</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    companion object &#123;</span><br><span class="line">        fun newInstance(): DynamicFragment &#123;</span><br><span class="line">            val fragment = DynamicFragment()</span><br><span class="line">            val args = Bundle()</span><br><span class="line">            fragment.arguments = args</span><br><span class="line">            return fragment</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="4-ç®€å•è®¾è®¡"><a href="#4-ç®€å•è®¾è®¡" class="headerlink" title="4. ç®€å•è®¾è®¡"></a>4. ç®€å•è®¾è®¡</h2><h3 id="MVVMæ¶æ„"><a href="#MVVMæ¶æ„" class="headerlink" title="MVVMæ¶æ„"></a>MVVMæ¶æ„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">B(MVVM)--&gt;A(Model)</span><br><span class="line">B--&gt;|bingding|C(View)</span><br><span class="line">C--&gt;|bingding|B</span><br></pre></td></tr></table></figure>
<ol>
<li>ä¸šåŠ¡é€»è¾‘å’Œè§†å›¾åˆ†ç¦»</li>
<li>ViewModelå’ŒViewä¹‹é—´é€šè¿‡bindingç»‘å®šï¼Œä¸ç”¨å®šä¹‰å¤§é‡çš„æ¥å£</li>
<li>ä¸ºäº†æ›´é«˜æ•ˆç®¡ç†çº¿ç¨‹ï¼Œå›¢é˜Ÿå†³å®šä½¿ç”¨coroutineè¿›è¡Œçº¿ç¨‹ç»Ÿä¸€ç®¡ç†ã€‚æ¶æ„é£æ ¼å‚è€ƒ<a href="https://github.com/android/architecture-samples" target="_blank" rel="noopener">architecture-samples</a></li>
</ol>
<h3 id="LiveDataæ•°æ®è®¾è®¡"><a href="#LiveDataæ•°æ®è®¾è®¡" class="headerlink" title="LiveDataæ•°æ®è®¾è®¡"></a>LiveDataæ•°æ®è®¾è®¡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// æ•°æ®åˆ—è¡¨</span><br><span class="line"> val dynamicListLiveData: LiveData&lt;List&lt;Dynamic&gt;&gt;</span><br><span class="line">// å¼‚å¸¸ä¿¡æ¯</span><br><span class="line"> val errorMessageLiveData: LiveData&lt;String&gt;</span><br></pre></td></tr></table></figure>
<h3 id="ç›¸å…³çš„ç¬¬ä¸‰æ–¹åº“"><a href="#ç›¸å…³çš„ç¬¬ä¸‰æ–¹åº“" class="headerlink" title="ç›¸å…³çš„ç¬¬ä¸‰æ–¹åº“"></a>ç›¸å…³çš„ç¬¬ä¸‰æ–¹åº“</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">implementation &apos;androidx.core:core-ktx:1.3.2&apos;</span><br><span class="line">implementation &apos;androidx.lifecycle:lifecycle-livedata-ktx:2.3.0&apos;</span><br><span class="line">implementation &apos;androidx.lifecycle:lifecycle-viewmodel-ktx:2.3.0&apos;</span><br><span class="line">implementation &apos;org.jetbrains.kotlinx:kotlinx-coroutines-core:1.4.1&apos;</span><br><span class="line">implementation &apos;org.jetbrains.kotlinx:kotlinx-coroutines-android:1.4.1&apos;</span><br></pre></td></tr></table></figure>
<h2 id="5-å°æ­¥å®‰å…¨é‡æ„"><a href="#5-å°æ­¥å®‰å…¨é‡æ„" class="headerlink" title="5.å°æ­¥å®‰å…¨é‡æ„"></a>5.å°æ­¥å®‰å…¨é‡æ„</h2><ul>
<li>æŠ½å–DynamicFragmentçš„ä¸šåŠ¡é€»è¾‘åˆ°DynamicViewModel</li>
<li>å®šä¹‰LiveDataæ•°æ®åŠxmlçš„ç»‘å®š</li>
<li>æŠ½å–DymaicRepository</li>
<li>æŠ½å–DataSourceæ¥å£</li>
</ul>
<blockquote>
<p>é‡æ„æ‰‹æ³•åŒ…å«æå–æ¥å£ã€ç§»åŠ¨æ–¹æ³•ã€ç§»åŠ¨ç±»ã€æŠ½å–æ–¹æ³•ã€å†…è”ã€æå–å˜é‡ç­‰ç­‰ã€‚<strong>Kotlinç›®å‰IDEä¸æ”¯æŒç§»åŠ¨æ–¹æ³•åˆ°ç±»</strong></p>
</blockquote>
<p>è¯¦ç»†çš„æ¼”ç¤ºè§<a href="https://mp.weixin.qq.com/s/vex4Kn6Ts-dI3KX2Yiuq6w" target="_blank" rel="noopener">è§†é¢‘</a></p>
<p> è¯¦ç»†çš„ä»£ç è§<a href="https://github.com/junbin1011/CloudDisk/commit/911a15c493d01dceb8ee56a0bba48fee6ad9847f" target="_blank" rel="noopener">Github</a></p>
<h3 id="è¡¥å……æµ‹è¯•ç”¨ä¾‹"><a href="#è¡¥å……æµ‹è¯•ç”¨ä¾‹" class="headerlink" title="è¡¥å……æµ‹è¯•ç”¨ä¾‹"></a>è¡¥å……æµ‹è¯•ç”¨ä¾‹</h3><ol>
<li>è¡¥å……DateUtilè®¡ç®—æ—¥æœŸæµ‹è¯•</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@SmallTest</span><br><span class="line">class DateUtilTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `should return 2021-03-17 14 47 5 when input is 1615963675000L`() &#123;</span><br><span class="line">        val format = DateUtil.getDateToString(1615963675000L)</span><br><span class="line">        Assert.assertEquals(&quot;2021-03-17 14:47:55&quot;, format)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>è¡¥å……MVVMä¸šåŠ¡é€»è¾‘æµ‹è¯•</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">@ExperimentalCoroutinesApi</span><br><span class="line">@SmallTest</span><br><span class="line">class DynamicViewModelTest &#123;</span><br><span class="line">    private val testDispatcher = TestCoroutineDispatcher()</span><br><span class="line"></span><br><span class="line">    @get:Rule</span><br><span class="line">    val rule = InstantTaskExecutorRule()</span><br><span class="line"></span><br><span class="line">    @Before</span><br><span class="line">    fun setUp() &#123;</span><br><span class="line">        Dispatchers.setMain(testDispatcher)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @After</span><br><span class="line">    fun tearDown() &#123;</span><br><span class="line">        Dispatchers.resetMain()</span><br><span class="line">        testDispatcher.cleanupTestCoroutines()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `show show dynamic list when get success`() = runBlocking &#123;</span><br><span class="line">        //given</span><br><span class="line">        val mockTransferFile = mock(TransferFile::class.java)</span><br><span class="line">        val mockDynamicRepository = mock(DynamicRepository::class.java)</span><br><span class="line">        `when`(mockDynamicRepository.getDynamicList()).thenReturn(getMockData())</span><br><span class="line">        val dynamicViewModel = DynamicViewModel(mockTransferFile, mockDynamicRepository)</span><br><span class="line">        //when</span><br><span class="line">        dynamicViewModel.getDynamicList()</span><br><span class="line">        //then</span><br><span class="line">        val dynamicOne = LiveDataTestUtil.getValue(dynamicViewModel.dynamicListLiveData)[0]</span><br><span class="line">        assertThat(dynamicOne.id).isEqualTo(1)</span><br><span class="line">        assertThat(dynamicOne.content).isEqualTo(&quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼&quot;)</span><br><span class="line">        assertThat(dynamicOne.date).isEqualTo(1615963675000L)</span><br><span class="line">        val dynamicTwo = LiveDataTestUtil.getValue(dynamicViewModel.dynamicListLiveData)[1]</span><br><span class="line">        assertThat(dynamicTwo.id).isEqualTo(2)</span><br><span class="line">        assertThat(dynamicTwo.content).isEqualTo(&quot;è¿™ä¸ªè¿ç»­å‰§å€¼å¾—è¿½ï¼&quot;)</span><br><span class="line">        assertThat(dynamicTwo.date).isEqualTo(1615963688000L)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `show show dynamic list when net work exception but have cache`() = runBlocking &#123;</span><br><span class="line">        //given</span><br><span class="line">        val mockTransferFile = mock(TransferFile::class.java)</span><br><span class="line">        val mockDynamicRepository = mock(DynamicRepository::class.java)</span><br><span class="line">        `when`(mockDynamicRepository.getDynamicList()).thenThrow(NetWorkErrorException::class.java)</span><br><span class="line">        `when`(mockDynamicRepository.getDynamicListFromCache()).thenReturn(getMockData())</span><br><span class="line">        val dynamicViewModel = DynamicViewModel(mockTransferFile, mockDynamicRepository)</span><br><span class="line"></span><br><span class="line">        //when</span><br><span class="line">        dynamicViewModel.getDynamicList()</span><br><span class="line">        //then</span><br><span class="line">        val dynamicOne = LiveDataTestUtil.getValue(dynamicViewModel.dynamicListLiveData)[0]</span><br><span class="line">        assertThat(dynamicOne.id).isEqualTo(1)</span><br><span class="line">        assertThat(dynamicOne.content).isEqualTo(&quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼&quot;)</span><br><span class="line">        assertThat(dynamicOne.date).isEqualTo(1615963675000L)</span><br><span class="line">        val dynamicTwo = LiveDataTestUtil.getValue(dynamicViewModel.dynamicListLiveData)[1]</span><br><span class="line">        assertThat(dynamicTwo.id).isEqualTo(2)</span><br><span class="line">        assertThat(dynamicTwo.content).isEqualTo(&quot;è¿™ä¸ªè¿ç»­å‰§å€¼å¾—è¿½ï¼&quot;)</span><br><span class="line">        assertThat(dynamicTwo.date).isEqualTo(1615963688000L)</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `show show error tip when net work exception and not have cache`() = runBlocking &#123;</span><br><span class="line">        //given</span><br><span class="line">        val mockTransferFile = mock(TransferFile::class.java)</span><br><span class="line">        val mockDynamicRepository = mock(DynamicRepository::class.java)</span><br><span class="line">        `when`(mockDynamicRepository.getDynamicList()).thenThrow(NetWorkErrorException::class.java)</span><br><span class="line">        val dynamicViewModel = DynamicViewModel(mockTransferFile, mockDynamicRepository)</span><br><span class="line"></span><br><span class="line">        //when</span><br><span class="line">        dynamicViewModel.getDynamicList()</span><br><span class="line">        //then</span><br><span class="line">        val errorMessage = LiveDataTestUtil.getValue(dynamicViewModel.errorMessageLiveData)</span><br><span class="line">        assertThat(errorMessage).isEqualTo(&quot;NetWorkErrorException&quot;)</span><br><span class="line">        val dynamicList = LiveDataTestUtil.getValue(dynamicViewModel.dynamicListLiveData)</span><br><span class="line">        assertThat(dynamicList).isNull()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    fun `show show empty tip when not has data`() = runBlocking &#123;</span><br><span class="line">        //given</span><br><span class="line">        val mockTransferFile = mock(TransferFile::class.java)</span><br><span class="line">        val mockDynamicRepository = mock(DynamicRepository::class.java)</span><br><span class="line">        `when`(mockDynamicRepository.getDynamicList()).thenReturn(null)</span><br><span class="line">        val dynamicViewModel = DynamicViewModel(mockTransferFile, mockDynamicRepository)</span><br><span class="line"></span><br><span class="line">        //when</span><br><span class="line">        dynamicViewModel.getDynamicList()</span><br><span class="line">        //then</span><br><span class="line">        val dynamicList = LiveDataTestUtil.getValue(dynamicViewModel.dynamicListLiveData)</span><br><span class="line">        assertThat(dynamicList).isNull()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private fun getMockData(): ArrayList&lt;Dynamic&gt; &#123;</span><br><span class="line">        val dynamicList = ArrayList&lt;Dynamic&gt;()</span><br><span class="line">        dynamicList.add(Dynamic(1, &quot;ä»Šå¤©å¤©æ°”çœŸä¸é”™ï¼&quot;, 1615963675000L))</span><br><span class="line">        dynamicList.add(Dynamic(2, &quot;è¿™ä¸ªè¿ç»­å‰§å€¼å¾—è¿½ï¼&quot;, 1615963688000L))</span><br><span class="line">        return dynamicList</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>dynamic bundleæ‰€æœ‰çš„æµ‹è¯•ï¼ŒæŠ¥å‘Šå¦‚ä¸‹ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB180d3632972403daa54752a0b49271a7?method=download&amp;shareKey=f889bf81d584ac02a2e0328656739b02" alt=""></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBd486bf877d1d108f51ab98e8540f3ea1?method=download&amp;shareKey=578698ea32c537b4e9522147e36cccb5" alt=""></p>
<h3 id="DataBinging"><a href="#DataBinging" class="headerlink" title="DataBinging"></a>DataBinging</h3><p> Fragment æ”¹é€ å¦‚ä¸‹ï¼š<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"> @Route(path = &quot;/dynamicBundle/dynamic&quot;)</span><br><span class="line">@AndroidEntryPoint</span><br><span class="line">class DynamicFragment : Fragment() &#123;</span><br><span class="line"></span><br><span class="line">    private lateinit var binding: FragmentDynamicBinding</span><br><span class="line">    private val dynamicViewModel: DynamicViewModel by viewModels()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,</span><br><span class="line">                              savedInstanceState: Bundle?): View? &#123;</span><br><span class="line">        binding = FragmentDynamicBinding.inflate(inflater, container, false)</span><br><span class="line">        binding.btnUpload.setOnClickListener &#123; dynamicViewModel.uploadDynamic() &#125;</span><br><span class="line">        binding.tvMessage.setOnClickListener &#123; dynamicViewModel.getDynamicList() &#125;</span><br><span class="line">        dynamicViewModel.getDynamicList()</span><br><span class="line">        subscribeUi()</span><br><span class="line">        return binding.root</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private fun subscribeUi() &#123;</span><br><span class="line">        dynamicViewModel.dynamicListLiveData.observe(viewLifecycleOwner, &#123;</span><br><span class="line">            if (it.isNullOrEmpty()) &#123;</span><br><span class="line">                showEmptyData()</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                showDynamicList(it)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">        dynamicViewModel.errorMessageLiveData.observe(viewLifecycleOwner, &#123;</span><br><span class="line">            showErrorMessage(it)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private fun showErrorMessage(errorMessage: String) &#123;</span><br><span class="line">        binding.showTip = true</span><br><span class="line">        //æ˜¾ç¤ºå¼‚å¸¸æé†’æ•°æ®</span><br><span class="line">        binding.tvMessage.text = errorMessage</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private fun showDynamicList(dynamicList: List&lt;Dynamic&gt;) &#123;</span><br><span class="line">        binding.showTip = false</span><br><span class="line">        val dynamicListAdapter = DynamicListAdapter()</span><br><span class="line">        dynamicListAdapter.submitList(dynamicList)</span><br><span class="line">        binding.dynamicList.addItemDecoration(DividerItemDecoration(</span><br><span class="line">                activity, DividerItemDecoration.VERTICAL))</span><br><span class="line">        //è®¾ç½®å¸ƒå±€æ˜¾ç¤ºæ ¼å¼</span><br><span class="line">        binding.dynamicList.layoutManager = LinearLayoutManager(activity)</span><br><span class="line">        binding.dynamicList.adapter = dynamicListAdapter</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private fun showEmptyData() &#123;</span><br><span class="line">        binding.showTip = true</span><br><span class="line">        //æ˜¾ç¤ºç©ºæ•°æ®</span><br><span class="line">        binding.tvMessage.text = &quot;empty data&quot;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    companion object &#123;</span><br><span class="line">        fun newInstance(): DynamicFragment &#123;</span><br><span class="line">            val fragment = DynamicFragment()</span><br><span class="line">            val args = Bundle()</span><br><span class="line">            fragment.arguments = args</span><br><span class="line">            return fragment</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;layout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;data&gt;</span><br><span class="line"></span><br><span class="line">        &lt;import type=&quot;android.view.View&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;variable</span><br><span class="line">            name=&quot;showTip&quot;</span><br><span class="line">            type=&quot;boolean&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/data&gt;</span><br><span class="line"></span><br><span class="line">    &lt;FrameLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/tv_message&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:gravity=&quot;center&quot;</span><br><span class="line">            android:text=&quot;&quot;</span><br><span class="line">            android:visibility=&quot;@&#123;showTip ? View.VISIBLE:View.GONE&#125;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;androidx.recyclerview.widget.RecyclerView</span><br><span class="line">            android:id=&quot;@+id/dynamicList&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:visibility=&quot;@&#123;showTip ? View.GONE:View.VISIBLE&#125;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/btn_upload&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_gravity=&quot;right|bottom&quot;</span><br><span class="line">            android:layout_margin=&quot;10dp&quot;</span><br><span class="line">            android:text=&quot;upload&quot; /&gt;</span><br><span class="line">    &lt;/FrameLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure></p>
<p> Adapter æ”¹é€ å¦‚ä¸‹ï¼š<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"> class DynamicListAdapter() : ListAdapter&lt;Dynamic, DynamicListAdapter.DynamicVH&gt;(DynamicDiffCallback()) &#123;</span><br><span class="line"></span><br><span class="line">    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): DynamicVH &#123;</span><br><span class="line">        return DynamicVH(DataBindingUtil.inflate(LayoutInflater.from(parent.context), R.layout.dynamic_list_item, parent, false))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    override fun onBindViewHolder(holder: DynamicVH, position: Int) &#123;</span><br><span class="line">        holder.binding.dynamic = getItem(position)</span><br><span class="line">        holder.binding.executePendingBindings()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    class DynamicVH(val binding: DynamicListItemBinding) : RecyclerView.ViewHolder(binding.root)</span><br><span class="line"></span><br><span class="line">    private class DynamicDiffCallback : DiffUtil.ItemCallback&lt;Dynamic&gt;() &#123;</span><br><span class="line">        override fun areItemsTheSame(oldItem: Dynamic, newItem: Dynamic): Boolean &#123;</span><br><span class="line">            return oldItem.id == newItem.id</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        override fun areContentsTheSame(oldItem: Dynamic, newItem: Dynamic): Boolean &#123;</span><br><span class="line">            return oldItem == newItem</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;layout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;data&gt;</span><br><span class="line"></span><br><span class="line">        &lt;import type=&quot;android.view.View&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;variable</span><br><span class="line">            name=&quot;dynamic&quot;</span><br><span class="line">            type=&quot;com.cloud.disk.bundle.dynamic.Dynamic&quot; /&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line"></span><br><span class="line">    &lt;FrameLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">        android:orientation=&quot;horizontal&quot;</span><br><span class="line">        android:padding=&quot;10dp&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/tv_content&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_gravity=&quot;left&quot;</span><br><span class="line">            android:text=&quot;@&#123;dynamic.content&#125;&quot; /&gt;</span><br><span class="line"></span><br><span class="line">        &lt;TextView</span><br><span class="line">            android:id=&quot;@+id/tv_date&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_gravity=&quot;right&quot;</span><br><span class="line">            android:text=&quot;@&#123;dynamic.formatDate&#125;&quot; /&gt;</span><br><span class="line">    &lt;/FrameLayout&gt;</span><br><span class="line"></span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure></p>
<p> è¯¦ç»†çš„ä»£ç è§<a href="https://github.com/junbin1011/CloudDisk/commit/0497fd86cf4efbfa4a195c92b65051817d2d4cae" target="_blank" rel="noopener">Github</a></p>
<h2 id="6-é›†æˆéªŒæ”¶æµ‹è¯•"><a href="#6-é›†æˆéªŒæ”¶æµ‹è¯•" class="headerlink" title="6.é›†æˆéªŒæ”¶æµ‹è¯•"></a>6.é›†æˆéªŒæ”¶æµ‹è¯•</h2><ol>
<li>dynamic bundleæ¨¡å—å‘å¸ƒ1.0.1ç‰ˆæœ¬</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &apos;com.cloud.disk.bundle:dynamic:1.0.1&apos;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>å…¶ä»–æ¨¡å—åŒæ­¥å‘å¸ƒä¿®æ”¹æ³¨å…¥é—®é¢˜</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation &apos;com.cloud.disk.bundle:file:1.0.2&apos;</span><br><span class="line">implementation &apos;com.cloud.disk.bundle:user:1.0.1&apos;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>æ‰§è¡Œå®ˆæŠ¤æµ‹è¯•</li>
</ol>
<p>æˆ‘ä»¬å‘ç°å› ä¸ºbindingç”Ÿæˆçš„æ–‡ä»¶æœ‰å¼‚å¸¸</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Field &lt;com.cloud.dynamicbundle.databinding.DynamicListItemBinding.mDynamic&gt; has type &lt;com.cloud.disk.bundle.dynamic.Dynamic&gt; in (DynamicListItemBinding.java:0)</span><br><span class="line">Method &lt;com.cloud.dynamicbundle.databinding.DynamicListItemBinding.getDynamic()&gt; has return type &lt;com.cloud.disk.bundle.dynamic.Dynamic&gt; in (DynamicListItemBinding.java:0)</span><br><span class="line">Method &lt;com.cloud.dynamicbundle.databinding.DynamicListItemBinding.setDynamic(com.cloud.disk.bundle.dynamic.Dynamic)&gt; has parameter of type &lt;com.cloud.disk.bundle.dynamic.Dynamic&gt; in (DynamicListItemBinding.java:0)</span><br></pre></td></tr></table></figure>
<p>å¢åŠ è¿‡æ»¤è§„åˆ™<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.*com.cloud.*.databinding.*ItemBinding.*</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li>è¿è¡Œæ£€æŸ¥</li>
</ol>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB4cd749f21a707eab239a6ea5f1ee729c?method=download&amp;shareKey=954910ce097ab724ef647e3bc1d0c92b" alt=""></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬ç¯‡ä»‹ç»äº†åŠ¨æ€æ¨¡å—å›¢é˜Ÿå°†åŠ¨æ€ä»¶ä¸»é¡µåˆ‡æ¢è‡³Kotlinä»£ç ã€é‡æ„ä¸ºMVVMæ¶æ„ï¼Œå¹¶ä¸”è¡¥å……äº†è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ç»è¿‡é‡æ„åï¼Œå›¢é˜Ÿçš„å¼€å‘æ•ˆç‡å’Œç‰ˆæœ¬è´¨é‡æœ‰äº†æ˜æ˜¾çš„æå‡ã€‚ä½†æœ¬åœ°æ•°æ®åº“çš„ç®¡ç†ä¾æ—§è¿˜æ˜¯å¤§é‡çš„sql è¯­å¥æ‹¼å†™ï¼Œéå¸¸ä¸åˆ©äºæ‰©å±•åŠç»´æŠ¤ï¼Œç¼–å†™è‡ªåŠ¨åŒ–æµ‹è¯•ä¹Ÿéå¸¸éº»çƒ¦ã€‚</p>
<p>ä¸‹ä¸€ç¯‡ï¼Œç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ15ï¼‰- æ•°æ®åº“é‡æ„ç¤ºä¾‹ç¯‡ã€‚æˆ‘ä»¬å°†ç»§ç»­å¯¹æ•°æ®åº“è¿›è¡Œé‡æ„æ”¹é€ ã€‚</p>
<h1 id="CloudDiskç¤ºä¾‹ä»£ç "><a href="#CloudDiskç¤ºä¾‹ä»£ç " class="headerlink" title="CloudDiskç¤ºä¾‹ä»£ç "></a>CloudDiskç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/junbin1011/CloudDisk" target="_blank" rel="noopener">CloudDisk</a></p>
<h1 id="ç³»åˆ—é“¾æ¥"><a href="#ç³»åˆ—é“¾æ¥" class="headerlink" title="ç³»åˆ—é“¾æ¥"></a>ç³»åˆ—é“¾æ¥</h1><p><a href="https://juejin.cn/post/6943470229905211422" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ1ï¼‰- å¼€ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6945313969556946980" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ2ï¼‰-æ¶æ„ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6947855094272491556" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ3ï¼‰-ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6950077521790500894" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ4ï¼‰-åˆ†æç¯‡</a></p>
<p><a href="https://juejin.cn/post/6952298178095874055" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ5ï¼‰- é‡æ„æ–¹æ³•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6954635678982340622" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ6ï¼‰- æµ‹è¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º</a></p>
<p><a href="https://juejin.cn/post/6963214120178941983" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6966166367821103117" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6970870458660945934" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰</a></p>
<p><a href="https://juejin.cn/post/6973836199655899149" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰- åˆ¶å“ç®¡ç†ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6974634615537401886" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6975877150314332168" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a></p>
<h1 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h1><p><img src="https://note.youdao.com/yws/api/personal/file/WEBf483992c4f5299577eeb0c039992c8d6?method=download&amp;shareKey=fd4babce2b0d344869bb1b2f7042417d" alt=""></p>
<h1 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h1><ul>
<li>ä½œè€…ï¼šé»„ä¿Šå½¬ </li>
<li><a href="https://junbin.tech/" target="_blank" rel="noopener">åšå®¢ï¼šjunbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="noopener">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="noopener">çŸ¥ä¹: @JunBin</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2021/06/20/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰-MVPé‡æ„ç¤ºä¾‹ç¯‡/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é»„ä¿Šå½¬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JunBin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/06/20/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰-MVPé‡æ„ç¤ºä¾‹ç¯‡/" itemprop="url">
                  ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰- MVPé‡æ„ç¤ºä¾‹ç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-20T21:47:56+08:00">
                2021-06-20
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/06/20/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰-MVPé‡æ„ç¤ºä¾‹ç¯‡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2021/06/20/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰-MVPé‡æ„ç¤ºä¾‹ç¯‡/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡<a href="https://juejin.cn/post/6974634615537401886" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a><br>ä»‹ç»ï¼Œç»è¿‡äº†è§£è€¦ã€åˆ†åº“åŠç¼–è¯‘è°ƒè¯•çš„ä¼˜åŒ–ï¼Œä¸€æ®µæ—¶é—´å†…ï¼ŒCloudDiskçš„å¼€å‘æ•ˆç‡å¾—åˆ°äº†å¾ˆå¤§çš„æå‡ã€‚</p>
<p>ä½†éšç€ä¸šåŠ¡çš„æ¼”è¿›ï¼Œç”±äºå†å²çš„åŸå› ï¼Œä»£ç ä¸­å­˜åœ¨å¾ˆå¤šActivityåŠControllerçš„ä¸Šå¸ç±»ã€‚ä»Šå¤©æˆ‘ä»¬å°†æ‹¿File Bundleä½œä¸ºä¾‹å­ï¼Œä¸ºå¤§å®¶æ€»ç»“é‡æ„çš„æµç¨‹ï¼Œæ¼”ç¤ºå¦‚ä½•ä¸€æ­¥ä¸€æ­¥å°†ä¸Šå¸ç±»é‡æ„æ¼”åŒ–ä¸ºMVPæ¶æ„ã€‚</p>
<p><strong>è§†é¢‘æ¼”ç¤ºåœ°å€:</strong> <a href="https://mp.weixin.qq.com/s/zjeln_eqAN45CDbSrWjLaA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/zjeln_eqAN45CDbSrWjLaA</a></p>
<h1 id="é‡æ„æµç¨‹"><a href="#é‡æ„æµç¨‹" class="headerlink" title="é‡æ„æµç¨‹"></a>é‡æ„æµç¨‹</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">A(1.æ¢³ç†ä¸šåŠ¡é€»è¾‘)--&gt;B(2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡)</span><br><span class="line">B--&gt;C(3.è¡¥å……å®ˆæŠ¤æµ‹è¯•)</span><br><span class="line">C--&gt;D(4.ç®€å•è®¾è®¡)</span><br><span class="line">D--&gt;E(5.å°æ­¥å®‰å…¨é‡æ„)</span><br><span class="line">E--&gt;F(6.é›†æˆéªŒæ”¶æµ‹è¯•)</span><br></pre></td></tr></table></figure>
<h2 id="1-æ¢³ç†ä¸šåŠ¡é€»è¾‘"><a href="#1-æ¢³ç†ä¸šåŠ¡é€»è¾‘" class="headerlink" title="1. æ¢³ç†ä¸šåŠ¡é€»è¾‘"></a>1. æ¢³ç†ä¸šåŠ¡é€»è¾‘</h2><p>é€šè¿‡å¾€å¾€è¿™ä¸€æ­¥æ˜¯æœ€éš¾çš„ã€‚ç”±äºäººå‘˜æ›´è¿­ã€äº§å“çš„è¿­ä»£ï¼Œç»™è¿™ä¸€æ­¥å¸¦æ¥å¾ˆå¤§çš„æŒ‘æˆ˜ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•ä»ä¸€ä¸‹å‡ æ–¹é¢æ¥è¡¥å…¨ä¿¡æ¯ã€‚</p>
<ol>
<li>æ‰¾äººï¼šäº§å“ç»ç†ã€è®¾è®¡äººå‘˜ã€æµ‹è¯•äººå‘˜è¿›è¡Œç¡®è®¤å’Œç­”ç–‘</li>
<li>æ‰¾æ–‡æ¡£ï¼šæŸ¥çœ‹åŸæœ‰çš„éœ€æ±‚æ–‡æ¡£ã€è®¾è®¡æ–‡æ¡£ã€æµ‹è¯•ç”¨ä¾‹ã€è®¾è®¡ç¨¿</li>
<li>çœ‹ä»£ç ï¼šä»åŸæœ‰çš„ä»£ç è®¾è®¡ä¸­å»æ¢³ç†ä¸šåŠ¡</li>
</ol>
<p>ç»è¿‡æ¢³ç†ç¡®è®¤ï¼ŒFile Bundleçš„ç°æœ‰çš„ä¸šåŠ¡å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">A(è¿›å…¥æ–‡ä»¶é¡µé¢)--&gt;B(ä»ç½‘ç»œåŠ è½½æ–‡ä»¶åˆ—è¡¨æ•°æ®)</span><br><span class="line">B --&gt; C&#123;æ•°æ®æ˜¯å¦åŠ è½½æˆåŠŸ&#125;</span><br><span class="line">C --&gt;|åŠ è½½æˆåŠŸ| D(æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨-æ–‡ä»¶åå’Œæ–‡ä»¶å¤§å°)</span><br><span class="line">C --&gt;|ç½‘ç»œå¼‚å¸¸| E(æ˜¾ç¤ºNetworkErrorException)</span><br><span class="line">C --&gt;|æ•°æ®ä¸ºç©º| F(æ˜¾ç¤ºempty data)</span><br><span class="line">E --&gt;|ç‚¹å‡»è§¦å‘åˆ·æ–°|B</span><br><span class="line">F --&gt;|ç‚¹å‡»è§¦å‘åˆ·æ–°|B</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ–‡ä»¶å¤§å°è½¬æ¢ä¸ºä»¥Bã€Kã€Mã€Gå•ä½æ˜¾ç¤º</p>
</blockquote>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB35e7a645210febdfcdd0128513e7e99a?method=download&amp;shareKey=d85ce28627621acfbf824411296471cb" alt=""></p>
<h2 id="2-åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡"><a href="#2-åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡" class="headerlink" title="2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡"></a>2.åˆ†æåŸæœ‰çš„ä»£ç è®¾è®¡</h2><p>æˆ‘ä»¬ä»¥ä¸»è¦ä¸Šå¸ç±»FileFragmentä¸ºä¾‹ï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">@AndroidEntryPoint</span><br><span class="line">public class FileFragment extends Fragment &#123;</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    FileController fileController;</span><br><span class="line"></span><br><span class="line">    private RecyclerView fileListRecycleView;</span><br><span class="line">    private TextView tvMessage;</span><br><span class="line"></span><br><span class="line">    public static FileFragment newInstance() &#123;</span><br><span class="line">        FileFragment fragment = new FileFragment();</span><br><span class="line">        Bundle args = new Bundle();</span><br><span class="line">        fragment.setArguments(args);</span><br><span class="line">        return fragment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public View onCreateView(LayoutInflater inflater, ViewGroup container,</span><br><span class="line">                             Bundle savedInstanceState) &#123;</span><br><span class="line"></span><br><span class="line">        View view = inflater.inflate(R.layout.fragment_file, container, false);</span><br><span class="line">        fileListRecycleView = view.findViewById(R.id.file_list);</span><br><span class="line">        tvMessage = view.findViewById(R.id.tv_message);</span><br><span class="line">        tvMessage.setOnClickListener(v -&gt; getFileList());</span><br><span class="line">        return view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        getFileList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void getFileList() &#123;</span><br><span class="line">        new Thread(() -&gt; &#123;</span><br><span class="line">            Message message = new Message();</span><br><span class="line">            try &#123;</span><br><span class="line">                List&lt;FileInfo&gt; infoList = fileController.getFileList();</span><br><span class="line">                message.what = 1;</span><br><span class="line">                message.obj = infoList;</span><br><span class="line">            &#125; catch (NetworkErrorException e) &#123;</span><br><span class="line">                message.what = 0;</span><br><span class="line">                message.obj = &quot;NetworkErrorException&quot;;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            mHandler.sendMessage(message);</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Handler mHandler = new Handler(new Handler.Callback() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public boolean handleMessage(@NonNull Message msg) &#123;</span><br><span class="line">            if (msg.what == 1) &#123;</span><br><span class="line">                showTip(false);</span><br><span class="line">                //æ˜¾ç¤ºç½‘ç»œæ•°æ®</span><br><span class="line">                List&lt;FileInfo&gt; infoList = (List&lt;FileInfo&gt;) msg.obj;</span><br><span class="line">                FileListAdapter fileListAdapter = new FileListAdapter(infoList, getActivity());</span><br><span class="line">                fileListRecycleView.addItemDecoration(new DividerItemDecoration(</span><br><span class="line">                        getActivity(), DividerItemDecoration.VERTICAL));</span><br><span class="line">                //è®¾ç½®å¸ƒå±€æ˜¾ç¤ºæ ¼å¼</span><br><span class="line">                fileListRecycleView.setLayoutManager(new LinearLayoutManager(getActivity()));</span><br><span class="line">                fileListRecycleView.setAdapter(fileListAdapter);</span><br><span class="line">            &#125; else if (msg.what == 0) &#123;</span><br><span class="line">                showTip(true);</span><br><span class="line">                //æ˜¾ç¤ºå¼‚å¸¸æé†’æ•°æ®</span><br><span class="line">                tvMessage.setText(msg.obj.toString());</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                showTip(true);</span><br><span class="line">                //æ˜¾ç¤ºç©ºæ•°æ®</span><br><span class="line">                tvMessage.setText(&quot;empty data&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    public void showTip(boolean show) &#123;</span><br><span class="line">        if (show) &#123;</span><br><span class="line">            tvMessage.setVisibility(View.VISIBLE);</span><br><span class="line">            fileListRecycleView.setVisibility(View.GONE);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            tvMessage.setVisibility(View.GONE);</span><br><span class="line">            fileListRecycleView.setVisibility(View.VISIBLE);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>ä»ä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸»è¦çš„ä¸€äº›è®¾è®¡é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š</p>
<ol>
<li>ä¸»è¦çš„è·å–æ–‡ä»¶ã€å¼‚å¸¸é€»è¾‘åˆ¤æ–­ã€ç•Œé¢åˆ·æ–°æ§åˆ¶éƒ½æ˜¯åœ¨ä¸€ä¸ªç±»é‡Œé¢ï¼Œä¸åˆ©äºåç»­çš„æ‰©å¼ åŠä¿®æ”¹ç»´æŠ¤ã€‚æˆ‘ä»¬å¸Œæœ›ç±»çš„èŒè´£æ›´åŠ å•ä¸€ï¼Œé€»è¾‘å’Œè§†å›¾èƒ½å¤Ÿè¿›è¡Œåˆ†ç¦»ã€‚</li>
<li>å­˜åœ¨ç²—æš´çš„new Threadè¿›è¡Œç®¡ç†</li>
<li>Handler å­˜åœ¨å†…å­˜æ³„éœ²é£é™©</li>
<li>å­˜åœ¨è§„èŒƒé—®é¢˜ï¼Œä¾‹å¦‚empty dataå­—ç¬¦ä¸²æ²¡æœ‰ä½¿ç”¨xmlè¿›è¡Œç®¡ç†ã€ä»£ç ä¸­ç”±æ— æ•ˆçš„å¯¼åŒ…ç­‰</li>
<li>ä»£ç ä¸­æ²¡æœ‰ä»»ä½•å®ˆæŠ¤æµ‹è¯•</li>
</ol>
<p>å®Œæ•´çš„æ‰€æœ‰ä»£ç è§<a href="https://github.com/junbin1011/CloudDisk/commit/3c4c4d98bcef46357f4c653431dc53e6d691e397" target="_blank" rel="noopener">Github</a></p>
<h2 id="3-è¡¥å……å®ˆæŠ¤æµ‹è¯•"><a href="#3-è¡¥å……å®ˆæŠ¤æµ‹è¯•" class="headerlink" title="3. è¡¥å……å®ˆæŠ¤æµ‹è¯•"></a>3. è¡¥å……å®ˆæŠ¤æµ‹è¯•</h2><p>å‚è€ƒé‡æ„ç¯‡ä¸­ï¼Œæˆ‘ä»¬åˆ¶å®šçš„ç­–ç•¥ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåšå¤§å‹çš„æµ‹è¯•ï¼Œåšä¸ºå®ˆæŠ¤æµ‹è¯•ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(AndroidJUnit4.class)</span><br><span class="line">@LargeTest</span><br><span class="line">@HiltAndroidTest</span><br><span class="line">@Config(application = HiltTestApplication.class)</span><br><span class="line">public class FileFragmentTest &#123;</span><br><span class="line"></span><br><span class="line">    @Rule</span><br><span class="line">    public HiltAndroidRule hiltRule = new HiltAndroidRule(this);</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void show_show_file_list_when_get_success() &#123;</span><br><span class="line">        //given</span><br><span class="line">        ActivityScenario&lt;DebugActivity&gt; scenario = ActivityScenario.launch(DebugActivity.class);</span><br><span class="line">        scenario.onActivity(activity -&gt; &#123;</span><br><span class="line">            //then</span><br><span class="line">            onView(withText(&quot;é—ç•™ä»£ç é‡æ„.pdf&quot;)).check(matches(isDisplayed()));</span><br><span class="line">            onView(withText(&quot;100.00K&quot;)).check(matches(isDisplayed()));</span><br><span class="line">            onView(withText(&quot;ç³»ç»Ÿç»„ä»¶åŒ–.pdf&quot;)).check(matches(isDisplayed()));</span><br><span class="line">            onView(withText(&quot;9.67K&quot;)).check(matches(isDisplayed()));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>æˆ‘ä»¬å‘ç°è¿™ä¸ªç”¨ä¸ä¼šé€šè¿‡ï¼Œæˆ‘ä»¬ä¸»è¦é¢ä¸´ä¸€ä¸‹2ä¸ªé—®é¢˜ã€‚</strong></p>
<ol>
<li>ç½‘ç»œè¯·æ±‚æ˜¯å¼‚æ­¥çš„ï¼Œå¼‚æ­¥é€»è¾‘å¯èƒ½åœ¨æµ‹è¯•æ‰§è¡Œå®Œè¿˜æ²¡æœ‰è§¦å‘åˆ°</li>
<li>ç½‘ç»œæ•°æ®æ˜¯åŠ¨æ€çš„ï¼Œæˆ‘ä»¬æ–­è¨€çš„æ•°æ®æ²¡åŠæ³•ç¡®å®š</li>
</ol>
<p>æ‰€ä»¥æˆ‘ä»¬é‡‡ç”¨çš„åšæ³•å°±æ˜¯Mockï¼Œæˆ‘ä¸ç¨³å®šçš„ä¾èµ–Mockæ‰ã€‚æˆ‘ä»¬åŒæ ·ä½¿ç”¨Shadowæ¥è¿›è¡Œå¤šè·å–ç½‘ç»œæ•°æ®æ–¹æ³•è¿›è¡ŒMockï¼Œä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@Implements(FileFragment.class)</span><br><span class="line">public class ShadowFileFragment &#123;</span><br><span class="line"></span><br><span class="line">    @RealObject</span><br><span class="line">    public FileFragment fileFragment;</span><br><span class="line"></span><br><span class="line">    enum State &#123;</span><br><span class="line">        SUCCESS,</span><br><span class="line">        ERROR,</span><br><span class="line">        EMPTY</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static State state = State.SUCCESS;</span><br><span class="line"></span><br><span class="line">    @Implementation</span><br><span class="line">    protected void getFileList() &#123;</span><br><span class="line">        System.out.println(&quot;shadow .... .....&quot;);</span><br><span class="line">        Message message = new Message();</span><br><span class="line">        if (state == State.SUCCESS) &#123;</span><br><span class="line">            ArrayList&lt;FileInfo&gt; infoList = new ArrayList&lt;&gt;();</span><br><span class="line">            infoList.add(new FileInfo(&quot;é—ç•™ä»£ç é‡æ„.pdf&quot;, 102400));</span><br><span class="line">            infoList.add(new FileInfo(&quot;ç³»ç»Ÿç»„ä»¶åŒ–.pdf&quot;, 9900));</span><br><span class="line">            message.what = 1;</span><br><span class="line">            message.obj = infoList;</span><br><span class="line">        &#125; else if (state == State.ERROR) &#123;</span><br><span class="line">            message.what = 0;</span><br><span class="line">            message.obj = &quot;NetworkErrorException&quot;;</span><br><span class="line">        &#125; else if (state == State.EMPTY) &#123;</span><br><span class="line">            message.what = 1;</span><br><span class="line">            message.obj = null;</span><br><span class="line">        &#125;</span><br><span class="line">        fileFragment.mHandler.sendMessage(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è°ƒæ•´åçš„æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">   public void show_show_file_list_when_get_success() &#123;</span><br><span class="line">       //given</span><br><span class="line">       ShadowFileFragment.state = ShadowFileFragment.State.SUCCESS;</span><br><span class="line">       //when</span><br><span class="line">       ActivityScenario&lt;DebugActivity&gt; scenario = ActivityScenario.launch(DebugActivity.class);</span><br><span class="line">       scenario.onActivity(activity -&gt; &#123;</span><br><span class="line">           //then</span><br><span class="line">           onView(withText(&quot;é—ç•™ä»£ç é‡æ„.pdf&quot;)).check(matches(isDisplayed()));</span><br><span class="line">           onView(withText(&quot;100.00K&quot;)).check(matches(isDisplayed()));</span><br><span class="line">           onView(withText(&quot;ç³»ç»Ÿç»„ä»¶åŒ–.pdf&quot;)).check(matches(isDisplayed()));</span><br><span class="line">           onView(withText(&quot;9.67K&quot;)).check(matches(isDisplayed()));</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   public void show_show_error_tip_when_net_work_exception() &#123;</span><br><span class="line">       //given</span><br><span class="line">       ShadowFileFragment.state = ShadowFileFragment.State.ERROR;</span><br><span class="line">       //when</span><br><span class="line">       ActivityScenario&lt;DebugActivity&gt; scenario = ActivityScenario.launch(DebugActivity.class);</span><br><span class="line">       scenario.onActivity(activity -&gt; &#123;</span><br><span class="line">           //then</span><br><span class="line">           onView(withText(&quot;NetworkErrorException&quot;)).check(matches(isDisplayed()));</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Test</span><br><span class="line">   public void show_show_empty_tip_when_not_has_data() &#123;</span><br><span class="line">       //given</span><br><span class="line">       ShadowFileFragment.state = ShadowFileFragment.State.EMPTY;</span><br><span class="line">       //when</span><br><span class="line">       ActivityScenario&lt;DebugActivity&gt; scenario = ActivityScenario.launch(DebugActivity.class);</span><br><span class="line">       scenario.onActivity(activity -&gt; &#123;</span><br><span class="line">           //then</span><br><span class="line">           onView(withText(&quot;empty data&quot;)).check(matches(isDisplayed()));</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></p>
<p>ä¸­é—´æˆ‘ä»¬ç”¨å…è®¸æµ‹è¯•è„šæ­¥æ—¶å‘ç°ï¼Œä¹‹å‰çš„æ—§ä»£ç è¿˜æœ‰ä¸€å¤„é€»è¾‘çš„é”™è¯¯ã€‚æ•°æ®ä¸ºç©ºçš„åˆ¤æ–­åº”è¯¥åŠ åœ¨ç½‘ç»œæ•°æ®å›è°ƒä¸­ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.NullPointerException</span><br><span class="line">	at com.cloud.disk.bundle.file.FileFragment$1.handleMessage(FileFragment.java:96)</span><br><span class="line">	at android.os.Handler.dispatchMessage(Handler.java:102)</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬åŒæ­¥å°†å¼‚å¸¸é€»è¾‘è¿›è¡Œä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB3ed18d4895f56ea4bd63edb07bad1ebb?method=download&amp;shareKey=9866d947d7c8cc33cf4c0f281ecb594c" alt=""></p>
<p>æœ€åæˆ‘ä»¬å®Œæˆäº†åŸºæœ¬çš„å®ˆæŠ¤æµ‹è¯•ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB2b366b7e072c92fb0690c2566ddf10a4?method=download&amp;shareKey=92b33d82fb51a71726529c783b9c736c" alt=""></p>
<p>å®Œæ•´çš„æ‰€æœ‰ä»£ç è§<a href="https://github.com/junbin1011/CloudDisk/commit/3c4c4d98bcef46357f4c653431dc53e6d691e397" target="_blank" rel="noopener">Github</a></p>
<h2 id="4-ç®€å•è®¾è®¡"><a href="#4-ç®€å•è®¾è®¡" class="headerlink" title="4. ç®€å•è®¾è®¡"></a>4. ç®€å•è®¾è®¡</h2><h3 id="MVPæ¶æ„"><a href="#MVPæ¶æ„" class="headerlink" title="MVPæ¶æ„"></a>MVPæ¶æ„</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">B(Presenter)--&gt;A(Model)</span><br><span class="line">B--&gt;|interface|C(View)</span><br><span class="line">C--&gt;|interface|B</span><br></pre></td></tr></table></figure>
<ol>
<li>ä¸šåŠ¡é€»è¾‘å’Œè§†å›¾åˆ†ç¦»</li>
<li>Presenterå’ŒViewä¹‹é—´é€šè¿‡æ¥å£äº¤äº’</li>
<li>ä¸ºäº†æ›´é«˜æ•ˆç®¡ç†çº¿ç¨‹ï¼Œå›¢é˜Ÿå†³å®šä½¿ç”¨Rxjavaè¿›è¡Œçº¿ç¨‹ç»Ÿä¸€ç®¡ç†ã€‚æ¶æ„é£æ ¼å‚è€ƒ<a href="https://github.com/android/architecture-samples" target="_blank" rel="noopener">architecture-samples</a></li>
</ol>
<h3 id="æ¥å£è®¾è®¡"><a href="#æ¥å£è®¾è®¡" class="headerlink" title="æ¥å£è®¾è®¡"></a>æ¥å£è®¾è®¡</h3><ol>
<li>Contractæ¥å£è®¾è®¡</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public interface FileListContract &#123;</span><br><span class="line"></span><br><span class="line">    interface View  &#123;</span><br><span class="line">        showFileList(List&lt;FileInfo&gt; fileList);</span><br><span class="line">        showNetWorkException(String errorMessage);</span><br><span class="line">        showEmptyData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    interface Presenter &#123;</span><br><span class="line"></span><br><span class="line">        void getFileList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æ•°æ®æ¥å£è®¾è®¡</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">public interface FileDataSource &#123;</span><br><span class="line">     Flowable&lt;List&lt;FileInfo&gt;&gt; getFileList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="5-å°æ­¥å®‰å…¨é‡æ„"><a href="#5-å°æ­¥å®‰å…¨é‡æ„" class="headerlink" title="5.å°æ­¥å®‰å…¨é‡æ„"></a>5.å°æ­¥å®‰å…¨é‡æ„</h2><ul>
<li>æŠ½å–FileFragmentçš„ä¸šåŠ¡é€»è¾‘åˆ°FilePresenter</li>
<li>FileFragment æå–UIæ¥å£</li>
<li>æŠ½å–FileDataSource</li>
</ul>
<blockquote>
<p>é‡æ„æ‰‹æ³•åŒ…å«æå–æ¥å£ã€ç§»åŠ¨æ–¹æ³•ã€ç§»åŠ¨ç±»ã€æŠ½å–æ–¹æ³•ã€å†…è”ã€æå–å˜é‡ç­‰ç­‰ã€‚<strong>è¿‡ç¨‹è¿˜éœ€è¦æ ¹æ®é‡æ„é€‚å½“è°ƒæ•´æµ‹è¯•ç”¨ä¾‹ã€‚</strong></p>
</blockquote>
<p>è¯¦ç»†çš„æ¼”ç¤ºè§<a href="https://mp.weixin.qq.com/s/zjeln_eqAN45CDbSrWjLaA" target="_blank" rel="noopener">è§†é¢‘</a></p>
<ul>
<li>è¡¥å……æµ‹è¯•ç”¨ä¾‹</li>
</ul>
<ol>
<li>è¡¥å……FileUtilsè®¡ç®—æ–‡ä»¶å¤§å°æµ‹è¯•</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(JUnit4.class)</span><br><span class="line">@SmallTest</span><br><span class="line">public class FileUtilsTest &#123;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void should_return_B_unit_when_file_size_in_its_range() &#123;</span><br><span class="line">        //given</span><br><span class="line">        long fileSize = 100;</span><br><span class="line">        //when</span><br><span class="line">        String format = FileUtils.formatFileSize(fileSize);</span><br><span class="line">        //then</span><br><span class="line">        assertEquals(&quot;100.00B&quot;, format);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void should_return_K_unit_when_file_size_in_its_range() &#123;</span><br><span class="line">        //given</span><br><span class="line">        long fileSize = 1034;</span><br><span class="line">        //when</span><br><span class="line">        String format = FileUtils.formatFileSize(fileSize);</span><br><span class="line">        //then</span><br><span class="line">        assertEquals(&quot;1.01K&quot;, format);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void should_return_M_unit_when_file_size_in_its_range() &#123;</span><br><span class="line">        //given</span><br><span class="line">        long fileSize = 1084000;</span><br><span class="line">        //when</span><br><span class="line">        String format = FileUtils.formatFileSize(fileSize);</span><br><span class="line">        //then</span><br><span class="line">        assertEquals(&quot;1.03M&quot;, format);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void should_return_G_unit_when_file_size_in_its_range() &#123;</span><br><span class="line">        //given</span><br><span class="line">        long fileSize = 1114000000;</span><br><span class="line">        //when</span><br><span class="line">        String format = FileUtils.formatFileSize(fileSize);</span><br><span class="line">        //then</span><br><span class="line">        assertEquals(&quot;1.04G&quot;, format);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>è¡¥å……Presenterä¸šåŠ¡é€»è¾‘æµ‹è¯•</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(JUnit4.class)</span><br><span class="line">@MediumTest</span><br><span class="line">public class FilePresenterImplTest &#123;</span><br><span class="line"></span><br><span class="line">    @Rule</span><br><span class="line">    public RxSchedulerRule rule = new RxSchedulerRule();</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void should_return_file_list_when_call_data_source_success() throws NetworkErrorException &#123;</span><br><span class="line">        //given</span><br><span class="line">        FileListContract.View mockView = mock(FileListContract.View.class);</span><br><span class="line">        FileDataSource mockFileDataSource = mock(FileDataSource.class);</span><br><span class="line">        List&lt;FileInfo&gt; fileList = new ArrayList&lt;&gt;();</span><br><span class="line">        fileList.add(new FileInfo(&quot;é—ç•™ä»£ç é‡æ„.pdf&quot;, 102400));</span><br><span class="line">        fileList.add(new FileInfo(&quot;ç³»ç»Ÿç»„ä»¶åŒ–.pdf&quot;, 9900));</span><br><span class="line">        when(mockFileDataSource.getFileList()).thenReturn(Flowable.fromArray(fileList));</span><br><span class="line">        FileListContract.FilePresenter filePresenter = new FilePresenterImpl(mockFileDataSource, mockView);</span><br><span class="line">        //when</span><br><span class="line">        filePresenter.getFileList();</span><br><span class="line">        //then</span><br><span class="line">        verify(mockView).showFileList(anyList());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void should_show_empty_data_when_call_data_source_return_empty() throws NetworkErrorException &#123;</span><br><span class="line">        //given</span><br><span class="line">        FileListContract.View mockView = mock(FileListContract.View.class);</span><br><span class="line">        FileDataSource mockFileDataSource = mock(FileDataSource.class);</span><br><span class="line">        when(mockFileDataSource.getFileList()).thenReturn(Flowable.fromArray(new ArrayList&lt;&gt;()));</span><br><span class="line">        FileListContract.FilePresenter filePresenter = new FilePresenterImpl(mockFileDataSource, mockView);</span><br><span class="line">        //when</span><br><span class="line">        filePresenter.getFileList();</span><br><span class="line">        //then</span><br><span class="line">        verify(mockView).showEmptyData();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void should_show_network_exception_when_call_data_source_return_net_error() throws NetworkErrorException &#123;</span><br><span class="line">        //given</span><br><span class="line">        FileListContract.View mockView = mock(FileListContract.View.class);</span><br><span class="line">        FileDataSource mockFileDataSource = mock(FileDataSource.class);</span><br><span class="line">        when(mockFileDataSource.getFileList()).thenThrow(new NetworkErrorException());</span><br><span class="line">        FileListContract.FilePresenter filePresenter = new FilePresenterImpl(mockFileDataSource, mockView);</span><br><span class="line">        //when</span><br><span class="line">        filePresenter.getFileList();</span><br><span class="line">        //then</span><br><span class="line">        verify(mockView).showNetWorkException(&quot;NetworkErrorException&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æŸ¥çœ‹CoverageæŸ¥çœ‹é€»è¾‘çš„è¦†ç›–æƒ…å†µï¼Œåˆ¤æ–­æ˜¯å¦æœ‰é‡è¦çš„é€»è¾‘é—æ¼ã€‚</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB063f4dc76efadbe40d7237dee658789c?method=download&amp;shareKey=13d6cb5293d2a24ae4baf68faf451f4a" alt=""></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB86d045ecd69b94b80d506b5650f654da?method=download&amp;shareKey=94a3c10d2650745ed2a43cac6b9b4844" alt=""></p>
<p>æœ€åæˆ‘ä»¬è¿è¡Œfile bundleæ‰€æœ‰çš„æµ‹è¯•ï¼ŒæŠ¥å‘Šå¦‚ä¸‹ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB3302856f2173afb539302fd0984d486c?method=download&amp;shareKey=a629e50540002ea88b95a7e22b8dba05" alt=""></p>
<h2 id="6-é›†æˆéªŒæ”¶æµ‹è¯•"><a href="#6-é›†æˆéªŒæ”¶æµ‹è¯•" class="headerlink" title="6.é›†æˆéªŒæ”¶æµ‹è¯•"></a>6.é›†æˆéªŒæ”¶æµ‹è¯•</h2><ol>
<li>file bundleæ¨¡å—å‘å¸ƒ1.0.1ç‰ˆæœ¬</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation &apos;com.cloud.disk.bundle:file:1.0.1&apos;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>æ‰§è¡Œå®ˆæŠ¤æµ‹è¯•</li>
</ol>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBb009be62841a634f0ff0d53a8ff079ad?method=download&amp;shareKey=ac5814fe21a5edc573a553b26019e40a" alt=""></p>
<ol start="3">
<li>è¿è¡Œæ£€æŸ¥</li>
</ol>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBa09296d62bd00f5198a775dbccba6842?method=download&amp;shareKey=732250036f72eb8c663f5950617d8b72" alt=""></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬ç¯‡ä»‹ç»äº†æ–‡ä»¶æ¨¡å—å›¢é˜Ÿå°†æ–‡ä»¶ä¸»é¡µé‡æ„ä¸ºMVPæ¶æ„ï¼Œå¹¶ä¸”è¡¥å……äº†è‡ªåŠ¨åŒ–æµ‹è¯•ã€‚ç»è¿‡é‡æ„åï¼Œå›¢é˜Ÿçš„å¼€å‘æ•ˆç‡å’Œç‰ˆæœ¬è´¨é‡æœ‰äº†æ˜æ˜¾çš„æå‡ã€‚æœ‰äº†æ–‡ä»¶æ¨¡å—çš„æ‰“æ ·ï¼Œç»™å…¶ä»–å›¢é˜Ÿå¸¦æ¥äº†å¾ˆå¤§çš„ä¿¡å¿ƒã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ç»§ç»­åˆ†äº«åŠ¨æ€æ¨¡å—çš„é‡æ„ä¹‹æ—…ã€‚ä¸æ–‡ä»¶æ¨¡å—ä¸ä¸€æ ·çš„æ˜¯åŠ¨æ€æ¨¡å—å†³å®šé‡‡ç”¨Kotlin+MVVMæ¶æ„ã€‚</p>
<p>ä¸‹ä¸€ç¯‡ï¼Œå•ä½“ç§»åŠ¨åº”ç”¨â€œæ¨¡å—åŒ–â€æ¼”è¿›ä¹‹æ—…ï¼ˆ14ï¼‰- Kotlin+MVVMé‡æ„ç¤ºä¾‹ç¯‡</p>
<h1 id="CloudDiskç¤ºä¾‹ä»£ç "><a href="#CloudDiskç¤ºä¾‹ä»£ç " class="headerlink" title="CloudDiskç¤ºä¾‹ä»£ç "></a>CloudDiskç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/junbin1011/CloudDisk" target="_blank" rel="noopener">CloudDisk</a></p>
<h1 id="ç³»åˆ—é“¾æ¥"><a href="#ç³»åˆ—é“¾æ¥" class="headerlink" title="ç³»åˆ—é“¾æ¥"></a>ç³»åˆ—é“¾æ¥</h1><p><a href="https://juejin.cn/post/6943470229905211422" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ1ï¼‰- å¼€ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6945313969556946980" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ2ï¼‰-æ¶æ„ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6947855094272491556" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ3ï¼‰-ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6950077521790500894" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ4ï¼‰-åˆ†æç¯‡</a></p>
<p><a href="https://juejin.cn/post/6952298178095874055" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ5ï¼‰- é‡æ„æ–¹æ³•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6954635678982340622" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ6ï¼‰- æµ‹è¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º</a></p>
<p><a href="https://juejin.cn/post/6963214120178941983" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6966166367821103117" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6970870458660945934" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰</a></p>
<p><a href="https://juejin.cn/post/6973836199655899149" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰- åˆ¶å“ç®¡ç†ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6974634615537401886" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡</a></p>
<h1 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h1><p><img src="https://note.youdao.com/yws/api/personal/file/WEBf483992c4f5299577eeb0c039992c8d6?method=download&amp;shareKey=fd4babce2b0d344869bb1b2f7042417d" alt=""></p>
<h1 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h1><ul>
<li>ä½œè€…ï¼šé»„ä¿Šå½¬ </li>
<li><a href="https://junbin.tech/" target="_blank" rel="noopener">åšå®¢ï¼šjunbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="noopener">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="noopener">çŸ¥ä¹: @JunBin</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2021/06/17/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰-ç¼–è¯‘è°ƒè¯•ç¯‡/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é»„ä¿Šå½¬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JunBin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/06/17/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰-ç¼–è¯‘è°ƒè¯•ç¯‡/" itemprop="url">
                  ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-17T13:34:23+08:00">
                2021-06-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/06/17/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰-ç¼–è¯‘è°ƒè¯•ç¯‡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2021/06/17/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰-ç¼–è¯‘è°ƒè¯•ç¯‡/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡<a href="https://juejin.cn/post/6973836199655899149" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰- åˆ¶å“ç®¡ç†ç¯‡</a>æˆ‘ä»¬å®Œæˆé€šè¿‡æœ¬åœ°mavenè¿›è¡ŒäºŒè¿›åˆ¶ç®¡ç†æ”¹é€ ã€‚åœ¨æ¶æ„è®¾è®¡ä¸­Appæ¨¡å—æ˜¯æ•´ä½“å·¥ç¨‹çš„é›†æˆï¼Œç”¨äºè¿›è¡Œæœ€åçš„å‘å¸ƒã€‚ä¸šåŠ¡Bundleåœ¨ç‹¬ç«‹çš„ä»“åº“ä¸­ç»´æŠ¤ï¼Œå¹¶ä¸”Bundleéƒ½æ˜¯ä»¥Libçš„å½¢å¼å­˜åœ¨ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿå¯¹å„ä¸ªä¸šåŠ¡Bundleè¿›è¡Œç‹¬ç«‹çš„è°ƒè¯•å¼€å‘ã€‚</p>
<p>æœ¬ç¯‡æˆ‘ä»¬å°†ç»§ç»­å¯¹CloudDiskè¿›è¡Œæ”¹é€ ï¼Œæ”¯æŒBundleè¿›è¡Œç‹¬ç«‹çš„è°ƒè¯•ã€‚</p>
<h1 id="è°ƒè¯•æ–¹å¼"><a href="#è°ƒè¯•æ–¹å¼" class="headerlink" title="è°ƒè¯•æ–¹å¼"></a>è°ƒè¯•æ–¹å¼</h1><h2 id="1-æ”¯æŒLibåŠApplicationåˆ‡æ¢"><a href="#1-æ”¯æŒLibåŠApplicationåˆ‡æ¢" class="headerlink" title="1. æ”¯æŒLibåŠApplicationåˆ‡æ¢"></a>1. æ”¯æŒLibåŠApplicationåˆ‡æ¢</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡é…ç½®Gradleçš„å½¢å¼ï¼Œè®©Moduleæ”¯æŒLibåŠApplicationçš„è°ƒè¯•ï¼Œè¿™æ ·æ—¢å¯ä»¥æ»¡è¶³è¿è¡Œè°ƒè¯•ï¼Œä¹Ÿå¯ä»¥æ»¡è¶³å‘å¸ƒaarã€‚ä½†æ˜¯ç¼ºç‚¹æ˜¯Gradleè¦è¿›è¡Œé…ç½®ï¼Œå¹¶ä¸”è°ƒè¯•ä»£ç å’Œæ­£å¼ä»£ç éƒ½åœ¨ä¸€ä¸ªå·¥ç¨‹ä¸­ã€‚</p>
<p>æˆ‘ä»¬ä»¥FileBundleä¸ºä¾‹ï¼ŒGradleé…ç½®æƒ…å†µå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//gradle æ–‡ä»¶ä¿®æ”¹å¦‚ä¸‹</span><br><span class="line"></span><br><span class="line">def isApp = false</span><br><span class="line">if (isApp) &#123;</span><br><span class="line">    //å¯è¿è¡Œ</span><br><span class="line">    apply plugin: &apos;com.android.application&apos;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    //ä½œä¸ºåº“</span><br><span class="line">    apply plugin: &apos;com.android.library&apos;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">defaultConfig &#123;</span><br><span class="line">    if (isApp) &#123;</span><br><span class="line">        applicationId &apos;com.cloud.filebundle&apos;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨srcä¸‹æ–°å¢debugç›®å½•ï¼Œè¿™æ ·å½“æ‰“debugåŒ…æ—¶ï¼Œè¯¥ç›®å½•ä¸‹çš„ä»£ç ä¹Ÿä¼šä¸€èµ·æ‰“åŒ…ï¼Œå½“æ‰“releaseåŒ…æ—¶ï¼Œåˆ™ä¸ä¼šå¸¦ä¸Šã€‚è¿™æ ·ä¹Ÿå¯æ–¹ä¾¿æŠŠæµ‹è¯•ä»£ç åŒºåˆ†å¼€ã€‚</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBad903ad0ddc75d48b758b2d0664b3d43?method=download&amp;shareKey=e7087a218e722efbc5e1b84016fb82af" alt=""></p>
<p>æˆ‘ä»¬ç›´æ¥æŠŠFileFragmentåœ¨DebugActivityä¸­æ˜¾ç¤ºå‡ºæ¥ï¼Œè¿è¡Œæƒ…å†µå¦‚ä¸‹ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB34c9bae2106ecb62a82ced05df862b59?method=download&amp;shareKey=259472e0c054c2d511a507096a228f69" alt=""></p>
<p>å®Œæ•´ä»£ç ç¤ºä¾‹è§<a href="https://github.com/junbin1011/CloudDisk/commit/7ed0b1e3eff0d40708bcd60e5d0a34cd2b8f1f00" target="_blank" rel="noopener">Github</a></p>
<h2 id="2-æ–°å¢Debugå·¥ç¨‹ç”¨äºè°ƒè¯•"><a href="#2-æ–°å¢Debugå·¥ç¨‹ç”¨äºè°ƒè¯•" class="headerlink" title="2. æ–°å¢Debugå·¥ç¨‹ç”¨äºè°ƒè¯•"></a>2. æ–°å¢Debugå·¥ç¨‹ç”¨äºè°ƒè¯•</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬é€šè¿‡DynamicBundleè¿›è¡Œæ¼”ç¤ºï¼Œæ–°å¢ä¸€ä¸ªmoduleç”¨äºä¸“é—¨è°ƒè¯•,è¿™ç§åšæ³•çš„å¥½å¤„æ˜¯æµ‹è¯•ä»£ç å®Œå…¨éš”ç¦»ã€‚</p>
<p>æ–°å»ºåä¸ºDynamicDebugçš„Moduleï¼ŒåŠ ä¸Šå¯¹äºçš„ä¾èµ–ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation &apos;com.cloud.disk:api:1.0.0&apos;</span><br><span class="line">implementation project(&apos;:dynamicBundle&apos;)</span><br></pre></td></tr></table></figure></p>
<p>åŒæ ·æ–°å¢DebugActivityç”¨äºè°ƒè¯•DynamicFragmentã€‚</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBcc3ffadbe426a373939a81c16c388aae?method=download&amp;shareKey=2807899d9d699d2274bfce60e387e70e" alt=""></p>
<p>ä½†è¿è¡Œè°ƒè¯•å‘ç°ç¼–è¯‘å‡ºé”™ï¼Œå…·ä½“çš„æ—¥å¿—å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">error: [Dagger/MissingBinding] com.cloud.disk.api.file.TransferFile cannot be provided without an @Provides-annotated method.</span><br><span class="line"> public abstract static class ApplicationC implements DebugApplication_GeneratedInjector,</span><br><span class="line">                        ^</span><br><span class="line">     com.cloud.disk.api.file.TransferFile is injected at</span><br><span class="line">         com.cloud.disk.bundle.dynamic.DynamicFragment.transferFile</span><br><span class="line">     com.cloud.disk.bundle.dynamic.DynamicFragment is injected at</span><br><span class="line">         com.cloud.disk.bundle.dynamic.DynamicFragment_GeneratedInjector.injectDynamicFragment(com.cloud.disk.bundle.dynamic.DynamicFragment) [com.cloud.dynamicdebug.DebugApplication_HiltComponents.ApplicationC â†’ com.cloud.dynamicdebug.DebugApplication_HiltComponents.ActivityRetainedC â†’ com.cloud.dynamicdebug.DebugApplication_HiltComponents.ActivityC â†’ com.cloud.dynamicdebug.DebugApplication_HiltComponents.FragmentC]</span><br><span class="line"> It is also requested at:</span><br><span class="line">     com.cloud.disk.bundle.dynamic.DynamicController.transferFile</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºDynamicBundleè¿è¡Œéœ€è¦ä¾èµ–TransferFileåŠUseStateæ¥å£çš„å®ç°ï¼Œè¿™ä¸ªæ—¶å€™DynamicBundleæˆ‘ä»¬ç‹¬ç«‹è°ƒè¯•ï¼Œå¹¶æ²¡æœ‰å°†æ¥å£çš„å®ç°åŠ è½½è¿›æ¥ã€‚<strong>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å»ºè®®çš„åšæ³•æ˜¯é‡‡ç”¨Mockï¼Œä¸å†æŠŠå…·ä½“çš„å®ç°åŠ è½½è¿›æ¥ã€‚</strong></p>
<p>æ–°å¢TransferFileåŠUseStateçš„æ¥å£Mockå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@Module</span><br><span class="line">@InstallIn(ActivityComponent.class)</span><br><span class="line">public abstract class MockFileModule &#123;</span><br><span class="line">    @Binds</span><br><span class="line">    public abstract TransferFile bindTransferFile(</span><br><span class="line">            MockTransferFileImpl transferFileImpl</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class MockTransferFileImpl implements TransferFile &#123;</span><br><span class="line">    @Inject</span><br><span class="line">    public MockTransferFileImpl() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public FileInfo upload(String s) &#123;</span><br><span class="line">        return new FileInfo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public FileInfo download(String s) &#123;</span><br><span class="line">        return new FileInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">@Module</span><br><span class="line">@InstallIn(ActivityComponent.class)</span><br><span class="line">public abstract class MockUserModule &#123;</span><br><span class="line">    @Binds</span><br><span class="line">    public abstract UserState bindUserState(</span><br><span class="line">            MockUserStateImpl userStateImpl</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class MockUserStateImpl implements UserState &#123;</span><br><span class="line">    @Inject</span><br><span class="line">    public MockUserStateImpl() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getUserId() &#123;</span><br><span class="line">        return &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public boolean isLogin() &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¢åŠ mockåï¼Œç¼–è¯‘æ­£å¸¸ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB907c6fd5efd1d47e1a418063ce4762d1?method=download&amp;shareKey=b3cdc5d2689eacc93193c4be84e18a74" alt=""></p>
<p>å®Œæ•´ä»£ç ç¤ºä¾‹è§<a href="https://github.com/junbin1011/CloudDisk/commit/b868d2514aed69f1b6fab79e3a047ce8c5c63b2d" target="_blank" rel="noopener">Github</a></p>
<h2 id="3-è‡ªåŠ¨åŒ–æµ‹è¯•"><a href="#3-è‡ªåŠ¨åŒ–æµ‹è¯•" class="headerlink" title="3. è‡ªåŠ¨åŒ–æµ‹è¯•"></a>3. è‡ªåŠ¨åŒ–æµ‹è¯•</h2><p>è¿™æ˜¯éå¸¸æ¨èçš„ä¸€ç§æ–¹å¼ï¼Œå¯é‡å¤æ‰§è¡Œä¸”åé¦ˆé€Ÿåº¦å¿«ã€‚å‰é¢æˆ‘ä»¬å·²ç»æœ‰ä¸€ç»„å†’çƒŸæµ‹è¯•çš„ç¤ºä¾‹ã€‚æ¥ä¸‹æ¥ä»‹ç»å¯¹userBundleçš„UserCenterFragmentè¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬åŒæ ·ä½¿ç”¨Robolectricæé«˜åé¦ˆçš„é€Ÿåº¦ã€‚</p>
<p>Gradleå¢åŠ ä¾èµ–é…ç½®ï¼Œå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">testImplementation &apos;junit:junit:4.13.2&apos;</span><br><span class="line">testImplementation &quot;com.google.truth:truth:1.0.1&quot;</span><br><span class="line">testImplementation &apos;com.tngtech.archunit:archunit-junit4:0.15.0&apos;</span><br><span class="line">testImplementation &apos;org.robolectric:robolectric:4.5.1&apos;</span><br><span class="line">testImplementation &apos;androidx.test:core:1.3.0&apos;</span><br><span class="line">testImplementation &apos;androidx.test.ext:junit:1.1.2&apos;</span><br><span class="line">testImplementation &apos;androidx.test.espresso:espresso-core:3.3.0&apos;</span><br><span class="line">testImplementation &apos;androidx.test.espresso:espresso-intents:3.3.0&apos;</span><br><span class="line">debugImplementation &quot;androidx.fragment:fragment-testing:1.3.0&quot;</span><br></pre></td></tr></table></figure></p>
<p>ç¼–å†™æµ‹è¯•ç”¨ä¾‹å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(AndroidJUnit4.class)</span><br><span class="line">@LargeTest</span><br><span class="line">public class UserCenterFragmentTest &#123;</span><br><span class="line">    @Test</span><br><span class="line">    public void show_show_user_center_ui_when_click_tab_dynamic() &#123;</span><br><span class="line">        //given</span><br><span class="line">        FragmentScenario&lt;UserCenterFragment&gt; scenario = FragmentScenario.launchInContainer(UserCenterFragment.class);</span><br><span class="line">        scenario.onFragment(activity -&gt; &#123;</span><br><span class="line">            //then</span><br><span class="line">            onView(withText(&quot;Hello user center fragment&quot;)).check(matches(isDisplayed()));</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æ‰§è¡Œæµ‹è¯•å‘½ä»¤ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew userBundle:testDebug</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBa90da1e952cae1f1f8a41a55936666c6?method=download&amp;shareKey=88839dde7bd30caf97515f567a1ef4a6" alt=""></p>
<p>å®Œæ•´ä»£ç ç¤ºä¾‹è§<a href="https://github.com/junbin1011/CloudDisk/commit/e8439d74c113e6ef73ee12bd8c9893a853525e2a" target="_blank" rel="noopener">Github</a></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç»è¿‡äº†è§£è€¦ã€åˆ†åº“åŠç¼–è¯‘è°ƒè¯•çš„ä¼˜åŒ–ï¼Œä¸€æ®µæ—¶é—´å†…ï¼ŒCloudDiskçš„å¼€å‘æ•ˆç‡å¾—åˆ°äº†å¾ˆå¤§çš„æå‡ã€‚</p>
<p>ä½†éšç€ä¸šåŠ¡çš„æ¼”è¿›ï¼Œç”±äºå†å²çš„åŸå› ï¼Œä»£ç ä¸­å­˜åœ¨å¾ˆå¤šActivityåŠControllerçš„ä¸Šå¸ç±»ã€‚å›¢é˜Ÿå‘ç°ç‹¬ç«‹çš„ä¸šåŠ¡Bundleè´¨é‡è¿˜æ˜¯æ¯”è¾ƒå·®ï¼ŒBugä¹Ÿæ¯”è¾ƒå¤šã€‚å›¢é˜Ÿå†³å®šå†æ¬¡å¯¹æ¨¡å—ç±»çš„ä»£ç è¿›è¡Œä¼˜åŒ–é‡æ„ï¼Œé‡‡ç”¨æ–°çš„MVPã€MVVMæ¶æ„å°†æ•°æ®åŠè§†å›¾åˆ†ç¦»ã€‚</p>
<p>ä¸‹ä¸€ç¯‡ï¼Œç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ13ï¼‰- MVPé‡æ„ç¤ºä¾‹ç¯‡ï¼Œä¸€é•œåˆ°åº•ï¼Œæˆ‘ä»¬å°†é€šè¿‡è§†é¢‘åŠæ–‡ç« çš„æ–¹å¼è¿›è¡Œæ¼”ç¤ºã€‚</p>
<h1 id="CloudDiskç¤ºä¾‹ä»£ç "><a href="#CloudDiskç¤ºä¾‹ä»£ç " class="headerlink" title="CloudDiskç¤ºä¾‹ä»£ç "></a>CloudDiskç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/junbin1011/CloudDisk" target="_blank" rel="noopener">CloudDisk</a></p>
<h1 id="ç³»åˆ—é“¾æ¥"><a href="#ç³»åˆ—é“¾æ¥" class="headerlink" title="ç³»åˆ—é“¾æ¥"></a>ç³»åˆ—é“¾æ¥</h1><p><a href="https://juejin.cn/post/6943470229905211422" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ1ï¼‰- å¼€ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6945313969556946980" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ2ï¼‰-æ¶æ„ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6947855094272491556" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ3ï¼‰-ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6950077521790500894" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ4ï¼‰-åˆ†æç¯‡</a></p>
<p><a href="https://juejin.cn/post/6952298178095874055" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ5ï¼‰- é‡æ„æ–¹æ³•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6954635678982340622" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ6ï¼‰- æµ‹è¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º</a></p>
<p><a href="https://juejin.cn/post/6963214120178941983" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6966166367821103117" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6970870458660945934" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰</a></p>
<p><a href="https://juejin.cn/post/6973836199655899149" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰- åˆ¶å“ç®¡ç†ç¯‡</a></p>
<h1 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h1><p><img src="https://note.youdao.com/yws/api/personal/file/WEBf483992c4f5299577eeb0c039992c8d6?method=download&amp;shareKey=fd4babce2b0d344869bb1b2f7042417d" alt=""></p>
<h1 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h1><ul>
<li>ä½œè€…ï¼šé»„ä¿Šå½¬ </li>
<li><a href="https://junbin.tech/" target="_blank" rel="noopener">åšå®¢ï¼šjunbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="noopener">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="noopener">çŸ¥ä¹: @JunBin</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2021/06/15/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰-åˆ¶å“ç®¡ç†ç¯‡/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é»„ä¿Šå½¬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JunBin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/06/15/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰-åˆ¶å“ç®¡ç†ç¯‡/" itemprop="url">
                  ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰- åˆ¶å“ç®¡ç†ç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-15T09:58:47+08:00">
                2021-06-15
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/06/15/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰-åˆ¶å“ç®¡ç†ç¯‡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2021/06/15/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰-åˆ¶å“ç®¡ç†ç¯‡/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡æˆ‘ä»¬æåˆ°CloudDiskå›¢é˜Ÿå†³å®šå°†å›¢é˜Ÿåˆ’åˆ†ä¸º5ä¸ªå›¢é˜Ÿï¼Œåˆ†åˆ«ç®¡ç†æ–‡ä»¶ã€åŠ¨æ€ã€ç”¨æˆ·ä¸­å¿ƒã€å¹³å°åŠå…¬å…±åº“ã€‚æ•´ä¸ªé¡¹ç›®ä¸å†ç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªGitå¤§ä»“è¿›è¡Œä»£ç ç®¡ç†ï¼Œæ¯ä¸ªå›¢é˜Ÿèƒ½ç‹¬ç«‹ç»´æŠ¤è‡ªå·±çš„ä»£ç ä»“åº“ã€‚</p>
<p>ä½†ç›®å‰è™½ç„¶å„ä¸ªæ¨¡å—å·²ç»è§£è€¦å®Œæˆï¼Œä½†è¿˜æ˜¯ä»¥æºç çš„ä¾èµ–çš„å½¢å¼è¿›è¡Œç¼–è¯‘ã€‚æˆ‘ä»¬è¦å°†ä¸šåŠ¡æ‹†åˆ†ç‹¬ç«‹çš„ä»“åº“ï¼Œéœ€è¦æŠŠæºç çš„ä¾èµ–éƒ½è°ƒæ•´ä¸ºäºŒè¿›åˆ¶çš„ä¾èµ–æ‰è¡Œã€‚æœ¬ç¯‡æˆ‘ä»¬å°±å¯¹CloudDiskè¿›è¡Œæ”¹é€ ï¼Œè§£å¼€æºç çš„ç¼–è¯‘ä¾èµ–ã€‚</p>
<h1 id="äºŒè¿›åˆ¶å‘å¸ƒé…ç½®"><a href="#äºŒè¿›åˆ¶å‘å¸ƒé…ç½®" class="headerlink" title="äºŒè¿›åˆ¶å‘å¸ƒé…ç½®"></a>äºŒè¿›åˆ¶å‘å¸ƒé…ç½®</h1><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©å¸¸ç”¨çš„mavenè¿›è¡Œç®¡ç†ã€‚ä¸ºäº†æ–¹ä¾¿æ¼”ç¤ºï¼Œæˆ‘ä»¬ä½¿ç”¨æœ¬åœ°mavenè¿›è¡Œé…ç½®ã€‚å®é™…é¡¹ç›®ä¸­æˆ‘ä»¬åªè¦æŠŠåœ°å€è®¾ç½®ä¸ºæœåŠ¡å™¨çš„mavenåœ°å€åˆ™å¯ï¼Œåœ¨æ¨¡å—çš„build.gradleæ·»åŠ ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &apos;maven&apos;</span><br><span class="line"></span><br><span class="line">group = &apos;com.cloud.disk&apos;</span><br><span class="line">archivesBaseName = &apos;library&apos;</span><br><span class="line">version = &apos;1.0.0&apos;</span><br><span class="line"></span><br><span class="line">repositories.mavenCentral()</span><br><span class="line"></span><br><span class="line">uploadArchives &#123;</span><br><span class="line">    repositories.mavenDeployer &#123;</span><br><span class="line">        repository(url: &apos;file:&apos;+ rootDir.getPath()+&apos;/lib&apos;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æ ¹ç›®å½•çš„build.gradleæ·»åŠ ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">allprojects &#123;</span><br><span class="line">    repositories &#123;</span><br><span class="line">        maven&#123;</span><br><span class="line">            url &apos;file:&apos;+ rootDir.getPath()+&apos;/lib&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å·¥ç¨‹ä¸­å°±å¯ä»¥å¼•ç”¨æœ¬åœ°mavenå‘å¸ƒçš„jaråŒ…äº†ã€‚</p>
<p>è§¦å‘ç‰ˆæœ¬å‘å¸ƒ,æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew :library:uploadArchives</span><br></pre></td></tr></table></figure>
<h1 id="CloudDiské‡æ„ç¤ºä¾‹"><a href="#CloudDiské‡æ„ç¤ºä¾‹" class="headerlink" title="CloudDiské‡æ„ç¤ºä¾‹"></a>CloudDiské‡æ„ç¤ºä¾‹</h1><p>å…·ä½“Libraryæ”¹é€ ç¤ºä¾‹ä»£ç è§<a href="https://github.com/junbin1011/CloudDisk/commit/0d3a6a51bee60c479a43e013259ff2e08b1d04cb" target="_blank" rel="noopener">Github</a></p>
<p>è¿™é‡Œæˆ‘ä»¬çœ‹çœ‹æ”¹é€ åçš„App Gradleæ–‡ä»¶dependencyå¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">implementation &apos;com.cloud.disk:library:1.0.0&apos;</span><br><span class="line">implementation &apos;com.cloud.disk:api:1.0.0&apos;</span><br><span class="line">implementation &apos;com.cloud.disk:platform:1.0.0&apos;</span><br><span class="line"></span><br><span class="line">implementation &apos;com.cloud.disk.bundle:file:1.0.0&apos;</span><br><span class="line">implementation &apos;com.cloud.disk.bundle:dynamic:1.0.0&apos;</span><br><span class="line">implementation &apos;com.cloud.disk.bundle:user:1.0.0&apos;</span><br></pre></td></tr></table></figure></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>åŸºäºå‰é¢æˆ‘ä»¬åšäº†å¤§é‡çš„è§£è€¦å·¥ä½œï¼Œæœ¬ç¯‡æˆ‘ä»¬é€šè¿‡æœ¬åœ°mavenè¿›è¡ŒäºŒè¿›åˆ¶ç®¡ç†ï¼Œå®é™…é¡¹ç›®ä¸­è¿™äº›aaréƒ½åœ¨è¿œç¨‹çš„mavenä¸­ç®¡ç†ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†å„ä¸ªä¸šåŠ¡ç‰¹æ€§åœ¨ç‹¬ç«‹çš„ä»“åº“ä¸­ç®¡ç†ã€‚</p>
<p>åœ¨æ¶æ„è®¾è®¡ä¸­Appæ˜¯æ•´ä½“å·¥ç¨‹çš„é›†æˆï¼Œç”¨äºé›†æˆåŠæœ€åçš„å‘å¸ƒã€‚åˆ†ä»“åæ‰€æœ‰çš„ä¸šåŠ¡Bundleåœ¨ç‹¬ç«‹çš„ä»“åº“ä¸­ç»´æŠ¤ï¼Œæˆ‘ä»¬å¸Œæœ›Bundleèƒ½å¤Ÿè¿›è¡Œç‹¬ç«‹çš„ç¼–è¯‘è°ƒè¯•ï¼Œä¸‹ä¸€ç¯‡ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ12ï¼‰- ç¼–è¯‘è°ƒè¯•ç¯‡ï¼Œæˆ‘ä»¬å°†ç»§ç»­å¯¹CloudDiskè¿›è¡Œæ”¹é€ ï¼Œè®©ä¸šåŠ¡Bundleæ”¯æŒç‹¬ç«‹çš„ç¼–è¯‘è°ƒè¯•ã€‚</p>
<h1 id="CloudDiskç¤ºä¾‹ä»£ç "><a href="#CloudDiskç¤ºä¾‹ä»£ç " class="headerlink" title="CloudDiskç¤ºä¾‹ä»£ç "></a>CloudDiskç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/junbin1011/CloudDisk" target="_blank" rel="noopener">CloudDisk</a></p>
<h1 id="ç³»åˆ—é“¾æ¥"><a href="#ç³»åˆ—é“¾æ¥" class="headerlink" title="ç³»åˆ—é“¾æ¥"></a>ç³»åˆ—é“¾æ¥</h1><p><a href="https://juejin.cn/post/6943470229905211422" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ1ï¼‰- å¼€ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6945313969556946980" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ2ï¼‰-æ¶æ„ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6947855094272491556" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ3ï¼‰-ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6950077521790500894" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ4ï¼‰-åˆ†æç¯‡</a></p>
<p><a href="https://juejin.cn/post/6952298178095874055" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ5ï¼‰- é‡æ„æ–¹æ³•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6954635678982340622" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ6ï¼‰- æµ‹è¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º</a></p>
<p><a href="https://juejin.cn/post/6963214120178941983" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6966166367821103117" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6970870458660945934" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰</a></p>
<h1 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h1><p><img src="https://note.youdao.com/yws/api/personal/file/WEBf483992c4f5299577eeb0c039992c8d6?method=download&amp;shareKey=fd4babce2b0d344869bb1b2f7042417d" alt=""></p>
<h1 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h1><ul>
<li>ä½œè€…ï¼šé»„ä¿Šå½¬ </li>
<li><a href="https://junbin.tech/" target="_blank" rel="noopener">åšå®¢ï¼šjunbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="noopener">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="noopener">çŸ¥ä¹: @JunBin</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2021/06/07/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰-è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é»„ä¿Šå½¬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JunBin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/06/07/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰-è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰/" itemprop="url">
                  ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-06-07T10:09:38+08:00">
                2021-06-07
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/06/07/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰-è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2021/06/07/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ10ï¼‰-è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>åœ¨<a href="https://juejin.cn/post/6963214120178941983" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡
</a>ã€<a href="https://juejin.cn/post/6966166367821103117" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡</a>ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†åŸºç¡€çš„æ³¨å…¥å’Œè·¯ç”±æ¡†æ¶æ­å»ºã€‚æ¥ç€<a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º
</a>,æœ¬ç¯‡æˆ‘ä»¬ä¼šæŠŠAppä¸­å‰©ä½™çš„ platform åŒ…ã€dynamic åŒ…è¿›è¡Œé‡æ„ã€‚æ–‡ä¸­ä¼šä¸»è¦åˆ—å‡ºåˆ†æåŠè§£è€¦çš„æ€è·¯åŠè¿‡ç¨‹,å¹¶ä¸”ä¼šæœ‰è¯¦ç»†çš„å®Œæ•´æ¼”ç¤ºè§†é¢‘ã€‚</p>
<p><strong>platformåŒ…é‡æ„ä»£ç æ¼”ç¤ºï¼š</strong><br><a href="https://mp.weixin.qq.com/s/YJLBFBD9T6F0zW7hWINoZA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/YJLBFBD9T6F0zW7hWINoZA</a></p>
<p><strong>dynamic åŒ…é‡æ„ä»£ç æ¼”ç¤ºï¼š</strong><br><a href="https://mp.weixin.qq.com/s/ZcDDIrJwUbz5JCgrzjfteg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/ZcDDIrJwUbz5JCgrzjfteg</a></p>
<h1 id="å®‰å…¨é‡æ„æ¼”ç¤º"><a href="#å®‰å…¨é‡æ„æ¼”ç¤º" class="headerlink" title="å®‰å…¨é‡æ„æ¼”ç¤º"></a>å®‰å…¨é‡æ„æ¼”ç¤º</h1><h2 id="platform-åŒ…é‡æ„"><a href="#platform-åŒ…é‡æ„" class="headerlink" title="platform åŒ…é‡æ„"></a>platform åŒ…é‡æ„</h2><ol>
<li>ä¾èµ–åˆ†æ</li>
</ol>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB20315a1c7461f5d6380f78c80437cb41?method=download&amp;shareKey=9f1d6c906815b5da19486d59973f36f2" alt=""></p>
<p>platform ä¸­å­˜åœ¨å¯¹ä¸Šå±‚bundleä¸­çš„åå‘ä¾èµ–ï¼Œè¯¥ä¾èµ–éœ€è¦è§£é™¤åï¼Œä¾¿å¯å°†è¯¥åŒ…ä¸‹æ²‰åˆ°platformçš„æ¨¡å—ä¸­ã€‚</p>
<ol start="2">
<li>å®‰å…¨é‡æ„</li>
</ol>
<p>é‡æ„å‰ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"> public class LoginActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    UserController userController = new UserController();</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_login);</span><br><span class="line">        userController.login(&quot;&quot;, &quot;&quot;, new CallBack() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void success(String message) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void filed(String message) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‡æ„æ‰‹æ³•ï¼š<strong>æå–ä»£ç†ç±»ã€å†…è”ã€ç§»åŠ¨</strong></p>
<ul>
<li>ç”±äºUserControlerä¸­å­˜åœ¨loginåŠgetUserInfoæ–¹æ³•ï¼Œæˆ‘ä»¬ä¸èƒ½ç®€å•å°†ç±»ä¸€èµ·ä¸‹æ²‰ï¼Œéœ€è¦æŠ½å–ç‹¬ç«‹ç±»å°†loginæ–¹æ³•å’ŒLoginActivityä¸€èµ·å†…èšä¸‹æ²‰</li>
</ul>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB1fc4d93cb70aaca6d30404ed75410df9?method=download&amp;shareKey=2da6020618d2aa890e986e35aaeac13a" alt=""></p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBdb54a5fa8f02d579973b4fab6a276be3?method=download&amp;shareKey=73ba5452e0e6dbe93572efe950ed4dd8" alt=""></p>
<p>é‡æ„åä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class UserController &#123;</span><br><span class="line">    public static boolean isLogin = false;</span><br><span class="line">    public final LoginController loginController = new LoginController();</span><br><span class="line"></span><br><span class="line">    public boolean login(String id, String password, CallBack callBack) &#123;</span><br><span class="line">        //ç”¨æˆ·ç™»å½•</span><br><span class="line">        return loginController.login(id, password, callBack);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public UserInfo getUserInfo() &#123;</span><br><span class="line">        //è·å–ç”¨æˆ·ä¿¡æ¯</span><br><span class="line">        return loginController.getUserInfo();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>å°†LoginActivityå¯¹UserControllerçš„è°ƒç”¨å†…è”ä¸ºå¯¹LoginControllerçš„è°ƒç”¨</li>
</ul>
<p>å†…è”loginæ–¹æ³•ï¼š<br><img src="https://note.youdao.com/yws/api/personal/file/WEB14d05f484fc749eea26036e37a9bc3f1?method=download&amp;shareKey=f76b810c0b921711dcfeb5c871f62f14" alt=""></p>
<p>å†…è”loginControllerï¼š<br><img src="https://note.youdao.com/yws/api/personal/file/WEB3a89a9dbf9508e7633e8bed85407cbeb?method=download&amp;shareKey=1b6b4df87beb989e019da0b9c5b5b134" alt=""></p>
<p>æŠ½å–æˆå‘˜å˜é‡ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBbd785820b2fe08b4841580eeb75b1577?method=download&amp;shareKey=a58dc6494a68a6e7a60f2280f54b0dc9" alt=""></p>
<p>é‡æ„åä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public class LoginActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    private LoginController loginController = new LoginController();</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_login);</span><br><span class="line">        //ç”¨æˆ·ç™»å½•</span><br><span class="line">        loginController.login(&quot;&quot;, &quot;&quot;, new CallBack() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void success(String message) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void filed(String message) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>ä»£ç ç§»åŠ¨</li>
</ol>
<p>ä»£ç ç§»åŠ¨è‡³ç‹¬ç«‹çš„platformï¼ŒåŠ ä¸Šå¯¹åº”çš„Gradleä¾èµ–ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBe6ed4d585e0976fdef47480c7b8e40d0?method=download&amp;shareKey=8532a1692a88ff1e04d4fcfe7d544567" alt=""></p>
<ol start="4">
<li>åŠŸèƒ½éªŒè¯<br>æ‰§è¡Œå†’çƒŸæµ‹è¯•ï¼ŒéªŒè¯åŠŸèƒ½</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./gradlew app:testDeb</span><br><span class="line">ug --tests SmokeTesting</span><br></pre></td></tr></table></figure>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBbaff5f043f366f8ce6c213cabba8b661?method=download&amp;shareKey=15c44bc893cac332e00e02e598375771" alt=""><br><strong>ä»£ç æ¼”ç¤ºï¼š <a href="https://mp.weixin.qq.com/s/YJLBFBD9T6F0zW7hWINoZA" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/YJLBFBD9T6F0zW7hWINoZA</a></strong></p>
<p>å…·ä½“çš„ä»£ç ï¼š<a href="https://github.com/junbin1011/CloudDisk/commit/0adcc7d7b8fac54ede058420b5be56fc9e0629dc" target="_blank" rel="noopener">githubé“¾æ¥</a></p>
<h2 id="dynamic-åŒ…é‡æ„"><a href="#dynamic-åŒ…é‡æ„" class="headerlink" title="dynamic åŒ…é‡æ„"></a>dynamic åŒ…é‡æ„</h2><ol>
<li>ä¾èµ–åˆ†æ</li>
</ol>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBa209e00bd30a6bf03e390086c0963dc9?method=download&amp;shareKey=436f6d8516546d1dbf13f90be8b752fd" alt=""></p>
<p>dynamicåŒ…å­˜åœ¨å¯¹fileBundleå’ŒuserBundleä¹‹é—´çš„æ¨ªå‘ä¾èµ–ã€‚ä¸»è¦æ˜¯å› ä¸ºåŠ¨æ€ä¸­éœ€è¦ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ï¼Œæ‰€ä»¥ä¾èµ–äº†fileBundleï¼Œå¦å¤–éœ€è¦åˆ¤æ–­æ˜¯å¦ç™»å½•ï¼Œæ‰€ä»¥ä¹Ÿä¾èµ–äº†userBundle</p>
<ol start="2">
<li>å®‰å…¨é‡æ„</li>
</ol>
<p>é‡æ„å‰ä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">public class DynamicFragment extends Fragment &#123;</span><br><span class="line"></span><br><span class="line">    DynamicController dynamicController = new DynamicController();</span><br><span class="line">    FileController fileController = new FileController(new UserStateImpl());</span><br><span class="line">    Button btnShare;</span><br><span class="line">    public static DynamicFragment newInstance() &#123;</span><br><span class="line">        DynamicFragment fragment = new DynamicFragment();</span><br><span class="line">        Bundle args = new Bundle();</span><br><span class="line">        fragment.setArguments(args);</span><br><span class="line">        return fragment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        dynamicController.getDynamicList();</span><br><span class="line">        FileInfo fileInfo = fileController.upload(&quot;/data/data/user.png&quot;);</span><br><span class="line">        dynamicController.post(new Dynamic(), fileInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class DynamicController &#123;</span><br><span class="line"></span><br><span class="line">    FileController fileController=new FileController(new UserStateImpl());</span><br><span class="line"></span><br><span class="line">    public boolean post(Dynamic dynamic, FileInfo fileInfo) &#123;</span><br><span class="line">        //å‘é€ä¸€æ¡åŠ¨æ€æ¶ˆæ¯</span><br><span class="line">        if (!UserController.isLogin) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        HttpUtils.post(&quot;http://dynamic&quot;, LoginController.userId);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;Dynamic&gt; getDynamicList() &#123;</span><br><span class="line">        //é€šè¿‡ç½‘ç»œè·å–åŠ¨æ€ä¿¡æ¯,æœ‰äº›åŠ¨æ€å¸¦æœ‰é™„ä»¶éœ€è¦ä¸‹è½½</span><br><span class="line">        fileController.download(&quot;&quot;);</span><br><span class="line">        return new ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é‡æ„æ‰‹æ³•ï¼š<strong>æå‰ä»£ç†ç±»ã€æŠ½å–æ¥å£ã€ç§»åŠ¨ã€å†…è”ã€æå–å˜é‡ç­‰</strong></p>
<p>ç”±äºFileControllerä¸­é™¤äº†ä¸Šä¼ å’Œä¸‹è½½è¿˜æœ‰è·å–æ–‡ä»¶çš„æ–¹æ¡ˆï¼Œæˆ‘ä»¬ä¸èƒ½ç®€å•ç²—æš´å°±æŠŠæ•´ä¸ªFileControlleræå‰æ¥å£ï¼Œå¸Œæœ›æŠ½å–é™¤äº†çš„æ¥å£èŒè´£æ›´åŠ å•ä¸€ã€‚</p>
<ul>
<li>æŠ½å–FileTransferç±»ï¼Œæå–æ¥å£</li>
<li>å°†å¯¹FileControllerçš„ä¾èµ–å†…è”ä¸ºFileTransfer</li>
<li>å¯¹UserBundleçš„ä¾èµ–ä½¿ç”¨å·²ç»æŠ½å–çš„UserStateæ¥å£</li>
<li>ä½¿ç”¨æ³¨å…¥çš„æ–¹å¼è¿›è¡Œä¾èµ–ç®¡ç†</li>
</ul>
<blockquote>
<p>ç”±äºæ­¥éª¤æ¯”è¾ƒå¤šï¼Œå¤§å®¶å¯ä»¥ç›´æ¥çœ‹è§†é¢‘çš„æ¼”ç¤ºï¼Œè¿™é‡Œå°±ä¸ä¸€ä¸€æˆªå›¾è¯´æ˜ã€‚</p>
</blockquote>
<p>é‡æ„åä»£ç ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">@AndroidEntryPoint</span><br><span class="line">public class DynamicFragment extends Fragment &#123;</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    DynamicController dynamicController;</span><br><span class="line">    Button btnShare;</span><br><span class="line">    @Inject</span><br><span class="line">    TransferFile transferFile;</span><br><span class="line"></span><br><span class="line">    public static DynamicFragment newInstance() &#123;</span><br><span class="line">        DynamicFragment fragment = new DynamicFragment();</span><br><span class="line">        Bundle args = new Bundle();</span><br><span class="line">        fragment.setArguments(args);</span><br><span class="line">        return fragment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        dynamicController.getDynamicList();</span><br><span class="line">        //ä¸Šä¼ æ–‡ä»¶</span><br><span class="line">        FileInfo fileInfo = transferFile.upload(&quot;/data/data/user.png&quot;);</span><br><span class="line">        dynamicController.post(new Dynamic(), fileInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class DynamicController &#123;</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    TransferFile transferFile;</span><br><span class="line">    @Inject</span><br><span class="line">    UserState userState;</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    public DynamicController() &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public boolean post(Dynamic dynamic, FileInfo fileInfo) &#123;</span><br><span class="line">        //å‘é€ä¸€æ¡åŠ¨æ€æ¶ˆæ¯</span><br><span class="line">        if (!userState.isLogin()) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        HttpUtils.post(&quot;http://dynamic&quot;, LoginController.userId);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public List&lt;Dynamic&gt; getDynamicList() &#123;</span><br><span class="line">        //é€šè¿‡ç½‘ç»œè·å–åŠ¨æ€ä¿¡æ¯,æœ‰äº›åŠ¨æ€å¸¦æœ‰é™„ä»¶éœ€è¦ä¸‹è½½</span><br><span class="line">        //ä¸‹è½½æ–‡ä»¶</span><br><span class="line">        transferFile.download(&quot;&quot;);</span><br><span class="line">        return new ArrayList&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol start="3">
<li>ä»£ç ç§»åŠ¨</li>
</ol>
<p>ä»£ç ç§»åŠ¨è‡³ç‹¬ç«‹çš„dynamic Bundleï¼ŒåŠ ä¸Šå¯¹åº”çš„Gradleä¾èµ–ï¼š</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB6eb57e6392a74c38536c69e94ce2a7f6?method=download&amp;shareKey=f15e163af24acd151e4fd612e9168f94" alt=""></p>
<ol start="4">
<li>åŠŸèƒ½éªŒè¯<br>æ‰§è¡Œå†’çƒŸæµ‹è¯•ï¼ŒéªŒè¯åŠŸèƒ½</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./gradlew app:testDeb</span><br><span class="line">ug --tests SmokeTesting</span><br></pre></td></tr></table></figure>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBbaff5f043f366f8ce6c213cabba8b661?method=download&amp;shareKey=15c44bc893cac332e00e02e598375771" alt=""></p>
<p><strong>ä»£ç æ¼”ç¤ºï¼š<a href="https://mp.weixin.qq.com/s/ZcDDIrJwUbz5JCgrzjfteg" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/ZcDDIrJwUbz5JCgrzjfteg</a></strong></p>
<p>å…·ä½“çš„ä»£ç ï¼š<a href="https://github.com/junbin1011/CloudDisk/commit/a1067bfca48e2f2e5a59e1bda94a2c56e7b55f5c" target="_blank" rel="noopener">githubé“¾æ¥</a></p>
<h1 id="ArchUnit"><a href="#ArchUnit" class="headerlink" title="ArchUnit"></a>ArchUnit</h1><p>åœ¨é‡æ„çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¡¥å……äº†apiçš„æ¨¡å—ï¼Œæˆ‘ä»¬éœ€è¦è°ƒæ•´ArchUnitçš„ç”¨ä¾‹ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(ArchUnitRunner.class)</span><br><span class="line">@AnalyzeClasses(packages = &quot;com.cloud.disk&quot;)</span><br><span class="line">public class ArchRuleTest &#123;</span><br><span class="line"></span><br><span class="line">    @ArchTest</span><br><span class="line">    public static final ArchRule architecture_layer_should_has_right_dependency =layeredArchitecture()</span><br><span class="line">            .layer(&quot;Library&quot;).definedBy(&quot;..cloud.disk.library..&quot;)</span><br><span class="line">            .layer(&quot;Api&quot;).definedBy(&quot;..cloud.disk.api..&quot;)</span><br><span class="line">            .layer(&quot;PlatForm&quot;).definedBy(&quot;..cloud.disk.platform..&quot;)</span><br><span class="line">            .layer(&quot;FileBundle&quot;).definedBy(&quot;..cloud.disk.bundle.file..&quot;)</span><br><span class="line">            .layer(&quot;DynamicBundle&quot;).definedBy(&quot;..cloud.disk.bundle.dynamic..&quot;)</span><br><span class="line">            .layer(&quot;UserBundle&quot;).definedBy(&quot;..cloud.disk.bundle.user..&quot;)</span><br><span class="line">            .layer(&quot;AllBundle&quot;).definedBy(&quot;..cloud.disk.bundle..&quot;)</span><br><span class="line">            .layer(&quot;App&quot;).definedBy(&quot;..cloud.disk.app..&quot;)</span><br><span class="line">            .whereLayer(&quot;App&quot;).mayOnlyBeAccessedByLayers()</span><br><span class="line">            .whereLayer(&quot;FileBundle&quot;).mayOnlyBeAccessedByLayers(&quot;App&quot;)</span><br><span class="line">            .whereLayer(&quot;DynamicBundle&quot;).mayOnlyBeAccessedByLayers(&quot;App&quot;)</span><br><span class="line">            .whereLayer(&quot;UserBundle&quot;).mayOnlyBeAccessedByLayers(&quot;App&quot;)</span><br><span class="line">            .whereLayer(&quot;PlatForm&quot;).mayOnlyBeAccessedByLayers(&quot;App&quot;,&quot;AllBundle&quot;)</span><br><span class="line">            .whereLayer(&quot;Api&quot;).mayOnlyBeAccessedByLayers(&quot;App&quot;,&quot;AllBundle&quot;,&quot;PlatForm&quot;)</span><br><span class="line">            .whereLayer(&quot;Library&quot;).mayOnlyBeAccessedByLayers(&quot;App&quot;,&quot;AllBundle&quot;,&quot;PlatForm&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›®å‰æ‰€æœ‰ä¹‹å‰çš„æ¶æ„è®¾è®¡çº¦æŸå·²ç»å®Œæ•´è§£è€¦å¼€ï¼Œä½†ç”±äºæµ‹è¯•æ–‡ä»¶å’ŒHiltä¼šç”Ÿæˆä¸€äº›ç¼–è¯‘çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¾—æ–°å¢é…ç½®æ–‡ä»¶è¿›è¡Œè¿‡æ»¤ã€‚</p>
<p>åœ¨resourceæ–‡ä»¶å¤¹ä¸­æ–°å¢æ–‡ä»¶archunit_ignore_patterns.txtï¼Œæ–°å¢è¿‡æ»¤è§„åˆ™å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">.*com.cloud.disk.SmokeTesting.*</span><br><span class="line">.*com.cloud.disk.DaggerSmokeTesting_*.*</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œæ¶æ„å®ˆæŠ¤æµ‹è¯•å‘½ä»¤å¦‚ä¸‹ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew app:testDebug --tests ArchRuleTest</span><br></pre></td></tr></table></figure></p>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å·²æ­£å¸¸è¿è¡Œé€šè¿‡ã€‚</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBd57e058ace18b246cf22d3ceb2eadabd?method=download&amp;shareKey=b0695709714c7c693fd01a3ae0d66179" alt=""></p>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ç»è¿‡ä¸æ–­çš„<strong>æ¼”è¿›é‡æ„</strong>ï¼Œç›®å‰æˆ‘ä»¬ç»ˆäºæŠŠè®¾è®¡çš„æ¶æ„å®ˆæŠ¤æµ‹è¯•é€šè¿‡ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€å¼ å›¾æ¥å¯¹æ¯”ä¸€ä¸‹å‰é¢çš„åŒºåˆ«ã€‚</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB9e99a1df9b882c8486f637a4d4e56dee?method=download&amp;shareKey=a8dd390088541d8e40e02f8583fc0b72" alt=""></p>
<p>éšç€ç¬¬ä¸€é˜¶æ®µçš„è§£è€¦é‡æ„å®Œæˆï¼ŒCloudDiskå›¢é˜Ÿå†³å®šå°†å›¢é˜Ÿåˆ’åˆ†ä¸º5ä¸ªå›¢é˜Ÿï¼Œåˆ†åˆ«ç®¡ç†æ–‡ä»¶ã€åŠ¨æ€ã€ç”¨æˆ·ä¸­å¿ƒã€å¹³å°åŠå…¬å…±åº“ã€‚æ•´ä¸ªé¡¹ç›®ä¸å†ç»Ÿä¸€ä½¿ç”¨ä¸€ä¸ªGitå¤§ä»“è¿›è¡Œä»£ç ç®¡ç†ï¼Œæ¯ä¸ªå›¢é˜Ÿèƒ½ç‹¬ç«‹ç»´æŠ¤è‡ªå·±çš„ä»£ç ä»“åº“ã€‚</p>
<p>ä¸‹ä¸€ç¯‡ï¼Œç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ11ï¼‰- åˆ¶å“ç®¡ç†ç¯‡å°†åˆ†äº«å¦‚ä½•å°†è§£è€¦çš„æ¨¡å—è¿›è¡ŒäºŒè¿›åˆ¶å‘å¸ƒï¼Œæ¨¡å—é—´ä¸å†ä½¿ç”¨æºç ä¾èµ–ç¼–è¯‘ï¼Œèƒ½æŒ‰è®¾è®¡åœ¨ç‹¬ç«‹çš„gitä»“åº“ä¸­è¿›è¡Œç®¡ç†ã€‚</p>
<h1 id="CloudDiskç¤ºä¾‹ä»£ç "><a href="#CloudDiskç¤ºä¾‹ä»£ç " class="headerlink" title="CloudDiskç¤ºä¾‹ä»£ç "></a>CloudDiskç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/junbin1011/CloudDisk" target="_blank" rel="noopener">CloudDisk</a></p>
<h1 id="ç³»åˆ—é“¾æ¥"><a href="#ç³»åˆ—é“¾æ¥" class="headerlink" title="ç³»åˆ—é“¾æ¥"></a>ç³»åˆ—é“¾æ¥</h1><p><a href="https://juejin.cn/post/6943470229905211422" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ1ï¼‰- å¼€ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6945313969556946980" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ2ï¼‰-æ¶æ„ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6947855094272491556" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ3ï¼‰-ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6950077521790500894" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ4ï¼‰-åˆ†æç¯‡</a></p>
<p><a href="https://juejin.cn/post/6952298178095874055" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ5ï¼‰- é‡æ„æ–¹æ³•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6954635678982340622" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ6ï¼‰- æµ‹è¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º</a></p>
<p><a href="https://juejin.cn/post/6963214120178941983" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6966166367821103117" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡</a></p>
<h1 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h1><p><img src="https://note.youdao.com/yws/api/personal/file/WEBf483992c4f5299577eeb0c039992c8d6?method=download&amp;shareKey=fd4babce2b0d344869bb1b2f7042417d" alt=""></p>
<h1 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h1><p><strong>æ¬¢è¿å…³æ³¨CACæ•æ·æ•™ç»ƒå…¬ä¼—å·</strong>ã€‚å¾®ä¿¡æœç´¢ï¼š<strong>CACæ•æ·æ•™ç»ƒ</strong>ã€‚</p>
<ul>
<li>ä½œè€…ï¼šé»„ä¿Šå½¬ </li>
<li><a href="https://junbin.tech/" target="_blank" rel="noopener">åšå®¢ï¼šjunbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="noopener">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="noopener">çŸ¥ä¹: @JunBin</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2021/05/25/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰-è·¯ç”±ç¯‡/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é»„ä¿Šå½¬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JunBin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/05/25/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰-è·¯ç”±ç¯‡/" itemprop="url">
                  ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-05-25T21:09:17+08:00">
                2021-05-25
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/05/25/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰-è·¯ç”±ç¯‡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2021/05/25/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰-è·¯ç”±ç¯‡/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡<a href="https://juejin.cn/post/6963214120178941983" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡
</a>æœ€åæˆ‘ä»¬é€šè¿‡IDEçš„ä¾èµ–åˆ†æå‘ç°ï¼ŒAppæ¨¡å—ä¸»ç•Œé¢ç›´æ¥ä¾èµ–äº†file Bundleçš„FileFragmentï¼Œå­˜åœ¨ç›´æ¥çš„ç¼–è¯‘ä¾èµ–ã€‚ </p>
<p>è·¨æ¨¡å—å¯¹Activityæˆ–Fragmentçš„ä¾èµ–æ˜¯åº”ç”¨å†…æœ€å¸¸è§çš„ã€‚ä½†æ˜¯å¦‚æœæœ‰ç›´æ¥ä»£ç ä¸Šçš„ä¾èµ–ï¼Œæˆ‘ä»¬å°±æ— æ³•åšåˆ°ä¸šåŠ¡æ¨¡å—ç‹¬ç«‹ç¼–è¯‘è°ƒè¯•ï¼Œåç»­åšåŠ¨æ€åŒ–ä¹Ÿæ²¡åŠæ³•ç»Ÿä¸€ç®¡ç†ã€‚æœ¬ç¯‡æˆ‘ä»¬ä¸»è¦åˆ†ä¸º3ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯è·¯ç”±çš„åŸç†ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ä¸šå†…ä¼˜ç§€çš„è·¯ç”±æ¡†æ¶å®è·µï¼Œæœ€åæˆ‘ä»¬å°†ç»§ç»­å¯¹CloudDiskä¸­UIè·³è½¬è¿›è¡Œé‡æ„ã€‚</p>
<h1 id="è·¯ç”±åŸç†"><a href="#è·¯ç”±åŸç†" class="headerlink" title="è·¯ç”±åŸç†"></a>è·¯ç”±åŸç†</h1><p>Androidä¸­å¸¸ç”¨çš„é¡µé¢è·³è½¬å°±æ˜¯é€šè¿‡ç›´æ¥çš„ä¾èµ–æ–¹å¼ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent(MainActivity.this, LoginActivity.class);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
<p>ä½†å…¶å®Intentè¿˜æœ‰å¦å¤–ä¸€ä¸ªAPIæ”¯æŒä½¿ç”¨ç±»åè¿›è¡Œéšå¼è·³è½¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Intent intent = new Intent();</span><br><span class="line">intent.setClassName(this,&quot;com.cloud.disk.platform.login.LoginActivity&quot;);</span><br><span class="line">startActivity(intent);</span><br></pre></td></tr></table></figure>
<p>è¿™ç§æ–¹å¼å°±ä¸ä¼šå­˜åœ¨ç¼–è¯‘çš„é—®é¢˜ã€‚ä½†å½“æ•´ä¸ªåº”ç”¨å†…çš„é¡µé¢è·³è½¬é‡å¾ˆå¤§æ—¶ï¼Œæˆ‘ä»¬å°±å¾ˆéš¾å…¨å±€è¿›è¡Œç»Ÿä¸€ç»´æŠ¤ã€‚å¹¶ä¸”å¾ˆå¤šåœºæ™¯éœ€è¦åŠ¨æ€æ¨é€é¡µé¢è·³è½¬ï¼Œæˆ‘ä»¬éœ€è¦ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é¡µé¢çš„åœ°å€ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦æœ‰ç»Ÿä¸€çš„æ–¹æ¡ˆè¿›è¡Œè·¯ç”±ç®¡ç†ã€‚</p>
<p>é‚£ä¹ˆå¦‚ä½•è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†å‘¢ï¼Ÿå…¶å®ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æ€è·¯å°±æ˜¯å»ºç«‹ä¸€ä¸ªç»Ÿä¸€çš„æ˜ å°„ï¼Œä¾‹å¦‚ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uri://user/login -&gt; com.cloud.disk.platform.login.LoginActivity</span><br></pre></td></tr></table></figure></p>
<p>ç„¶åé€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„æ–¹å¼è¿›è¡Œç®¡ç†ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„è·¯ç”±è¡¨ã€‚å½“åº”ç”¨è¿›è¡Œè·³è½¬æ—¶ï¼Œè¾“å…¥è™šæ‹Ÿçš„åœ°å€ï¼Œç»è¿‡è·¯ç”±è¡¨è¿›è¡ŒæŸ¥è¯¢å¾—åˆ°å®é™…çš„åœ°å€ï¼Œç„¶åå°±å¯è¿›è¡Œè·³è½¬ã€‚å¹¶ä¸”æœ‰äº†è¿™ä¸€å±‚è½¬æ¢ï¼Œæˆ‘ä»¬å°±å¯ä»¥åšå¾ˆå¤šæ‰©å±•ï¼Œä¾‹å¦‚é™çº§ã€æ‹¦æˆªç­‰ç­‰</p>
<p>ä¸‹é¢å°±è®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ä¸€äº›ä¸šå†…çš„ä¼˜ç§€å®è·µã€‚</p>
<h1 id="ä¸šå†…ä¼˜ç§€å®è·µ"><a href="#ä¸šå†…ä¼˜ç§€å®è·µ" class="headerlink" title="ä¸šå†…ä¼˜ç§€å®è·µ"></a>ä¸šå†…ä¼˜ç§€å®è·µ</h1><h2 id="ARouter"><a href="#ARouter" class="headerlink" title="ARouter"></a><a href="https://github.com/alibaba/ARouter" target="_blank" rel="noopener">ARouter</a></h2><p>ARouterä¸»è¦é‡‡ç”¨çš„ä¹Ÿæ˜¯è·¯ç”±è¡¨çš„æ–¹å¼ï¼Œå…·ä½“çš„ä½¿ç”¨å’ŒåŸç†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šèµ„æ–™ã€‚è¿™é‡Œä¸»è¦åˆ—å‡ºå®˜ç½‘ä¸Šä»‹ç»çš„ä¸€äº›ä¸»è¦çš„åŠŸèƒ½ã€‚</p>
<ul>
<li>æ”¯æŒç›´æ¥è§£ææ ‡å‡†URLè¿›è¡Œè·³è½¬ï¼Œå¹¶è‡ªåŠ¨æ³¨å…¥å‚æ•°åˆ°ç›®æ ‡é¡µé¢ä¸­</li>
<li>æ”¯æŒå¤šæ¨¡å—å·¥ç¨‹ä½¿ç”¨</li>
<li>æ”¯æŒæ·»åŠ å¤šä¸ªæ‹¦æˆªå™¨ï¼Œè‡ªå®šä¹‰æ‹¦æˆªé¡ºåº</li>
<li>æ”¯æŒä¾èµ–æ³¨å…¥ï¼Œå¯å•ç‹¬ä½œä¸ºä¾èµ–æ³¨å…¥æ¡†æ¶ä½¿ç”¨</li>
<li>æ˜ å°„å…³ç³»æŒ‰ç»„åˆ†ç±»ã€å¤šçº§ç®¡ç†ï¼ŒæŒ‰éœ€åˆå§‹åŒ–<br>æ”¯æŒç”¨æˆ·æŒ‡å®šå…¨å±€é™çº§ä¸å±€éƒ¨é™çº§ç­–ç•¥<br>é¡µé¢ã€æ‹¦æˆªå™¨ã€æœåŠ¡ç­‰ç»„ä»¶å‡è‡ªåŠ¨æ³¨å†Œåˆ°æ¡†æ¶<br>æ”¯æŒå¤šç§æ–¹å¼é…ç½®è½¬åœºåŠ¨ç”»</li>
<li>æ”¯æŒè·å–Fragment</li>
<li>å®Œå…¨æ”¯æŒKotlinä»¥åŠæ··ç¼–</li>
<li>æ”¯æŒç¬¬ä¸‰æ–¹ App åŠ å›º(ä½¿ç”¨ arouter-register å®ç°è‡ªåŠ¨æ³¨å†Œ)</li>
<li>æ”¯æŒç”Ÿæˆè·¯ç”±æ–‡æ¡£</li>
<li>æä¾› IDE æ’ä»¶ä¾¿æ·çš„å…³è”è·¯å¾„å’Œç›®æ ‡ç±»</li>
</ul>
<p>æ›´å¤šè¯¦ç»†çš„ä»‹ç»å’Œä½¿ç”¨è¯´æ˜ï¼Œå¯ä»¥å‚è€ƒ<a href="https://github.com/alibaba/ARouter/blob/master/README_CN.md" target="_blank" rel="noopener">Githubä¸Šçš„ä»‹ç»</a></p>
<blockquote>
<p>è¿™é‡Œæˆ‘ä»¬ä»Githubä¸Šçš„ä»‹ç»å‘ç°ï¼ŒåŒæ ·é‡‡ç”¨äº†æ³¨è§£å’ŒGradleæ’ä»¶åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆæ–‡ä»¶ï¼Œä½†ARouterå¹¶æ²¡æœ‰åƒHilté‚£æ ·æœ‰å®Œå–„çš„æµ‹è¯•å¥—ä»¶æ”¯æŒï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨Robolectricåœ¨JVMä¸Šè¿›è¡Œæµ‹è¯•ä¼šæœ‰å½±å“ã€‚</p>
</blockquote>
<h2 id="DeepLinkDispatch"><a href="#DeepLinkDispatch" class="headerlink" title="DeepLinkDispatch"></a><a href="https://github.com/airbnb/DeepLinkDispatch/" target="_blank" rel="noopener">DeepLinkDispatch</a></h2><p>DeepLinkDispatchæ˜¯airbnbå¼€æºçš„ä¸€ä¸ªè·¯ç”±æ¡†æ¶ï¼ŒåŸç†ä¹Ÿæ˜¯é‡‡ç”¨è·¯ç”±è¡¨çš„æ–¹å¼ã€‚</p>
<p>æä¾›å£°æ˜æ€§çš„ã€åŸºäºæ³¨é‡Šçš„APIæ¥å®šä¹‰åº”ç”¨ç¨‹åºæ·±åº¦é“¾æ¥ã€‚<br>å¯ä»¥æ³¨å†Œä¸€ä¸ªActivityæ¥å¤„ç†ç‰¹å®šçš„æ·±åº¦é“¾æ¥ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨@DeepLinkå’ŒURIå¯¹å…¶è¿›è¡Œæ³¨é‡Šã€‚DeepLinkDispatchå°†è§£æURIå¹¶å°†æ·±åº¦é“¾æ¥ä¸URIä¸­æŒ‡å®šçš„ä»»ä½•å‚æ•°ä¸€èµ·å‘é€åˆ°é€‚å½“çš„Activityã€‚</p>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒåŠŸèƒ½æ²¡æœ‰ARouterå¼ºå¤§ï¼Œä¸”å›½å†…çš„ç¤¾åŒºæ´»è·ƒåº¦æ²¡æœ‰ARouteré«˜ï¼Œå…·ä½“çš„ä½¿ç”¨æ–¹å¼å¯ä»¥å‚è€ƒ<a href="https://github.com/airbnb/DeepLinkDispatch" target="_blank" rel="noopener">å®˜æ–¹çš„ä»‹ç»</a></p>
<h1 id="CloudDiskè·¯ç”±é‡æ„ç¤ºä¾‹"><a href="#CloudDiskè·¯ç”±é‡æ„ç¤ºä¾‹" class="headerlink" title="CloudDiskè·¯ç”±é‡æ„ç¤ºä¾‹"></a>CloudDiskè·¯ç”±é‡æ„ç¤ºä¾‹</h1><p>ç»è¿‡å¯¹æ¯”ï¼Œæˆ‘ä»¬å†³å®šä½¿ç”¨åŠŸèƒ½ç›¸å¯¹å¼ºå¤§ä¸”ç¤¾åŒºæ´»è·ƒåº¦é«˜çš„ARouterï¼Œå¯¹CloudDiskè¿›è¡Œæ”¹é€ ã€‚å…·ä½“çš„å®Œæ•´ä»£ç ç¤ºä¾‹<a href="https://github.com/junbin1011/CloudDisk/commit/ab0bbc0785faf41817683e0b509e9c1b122ce7db" target="_blank" rel="noopener">Github</a>ã€‚è¿™é‡Œæˆ‘ä»¬è´´å‡ºå‰åä»£ç ä½¿ç”¨çš„æ¯”è¾ƒã€‚</p>
<p>æ”¹é€ å‰ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fragments.add(FileFragment.newInstance());</span><br></pre></td></tr></table></figure></p>
<p>æ”¹é€ åï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//å£°æ˜</span><br><span class="line">@Route(path = &quot;/bundle/file&quot;)</span><br><span class="line">public class FileFragment extends Fragment </span><br><span class="line"></span><br><span class="line">//è°ƒç”¨</span><br><span class="line">fragments.add((Fragment) ARouter.getInstance().build(&quot;/bundle/file&quot;).navigation()ï¼‰;</span><br></pre></td></tr></table></figure></p>
<p>ä½†å½“æˆ‘ä»¬è¿è¡Œå†’çƒŸæµ‹è¯•çš„æ—¶å€™å‘ç°å‡ºç°ç©ºå¼‚å¸¸ï¼Œå¦‚ä¸‹</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB1b1b29a47f7f137cca1fc06976373f9d?method=download&amp;shareKey=6cc14ab80015ab5eebff8a0f6cab39be" alt=""></p>
<p>ARouterçš„navigationå¹¶ä¸èƒ½æ‰¾åˆ°å®ä¾‹ï¼Œä¸Šé¢æˆ‘ä»¬æœ‰æåˆ°ARouteråŒæ ·é‡‡ç”¨äº†æ³¨è§£å’ŒGradleæ’ä»¶åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆæ–‡ä»¶ï¼Œä½†ARouterå¹¶æ²¡æœ‰åƒHilté‚£æ ·æœ‰å®Œå–„çš„æµ‹è¯•å¥—ä»¶æ”¯æŒï¼Œåœ¨JVMä¸Šè¿›è¡Œæµ‹è¯•ä¼šæœ‰å½±å“ã€‚è¿™é‡Œæˆ‘ä»¬é‡‡ç”¨çš„æ–¹æ¡ˆæ˜¯Shadowï¼Œå°†å®é™…ARouterçš„è·³è½¬Mockæ‰ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Implements(Postcard.class)</span><br><span class="line">public class ShadowPostCard &#123;</span><br><span class="line"></span><br><span class="line">    @RealObject</span><br><span class="line">    public Postcard postcard;</span><br><span class="line"></span><br><span class="line">    @Implementation</span><br><span class="line">    public Object navigation() &#123;</span><br><span class="line">        if (&quot;/bundle/file&quot;.equals(postcard.getPath())) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                return Class.forName(&quot;com.cloud.disk.bundle.file.FileFragment&quot;).newInstance();</span><br><span class="line">            &#125; catch (ClassNotFoundException | IllegalAccessException | InstantiationException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEBd3b7b5287020064ea859cf6f2de97dff?method=download&amp;shareKey=c3f320eaf380ab13fe6ff4b51bacaa2c" alt=""></p>
<blockquote>
<p>æˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘æŠŠæµ‹è¯•ç”¨ä¾‹æ”¾å…¥androidTestï¼Œä½¿ç”¨çœŸæœºè¿è¡Œæµ‹è¯•ã€‚ä½†ä¸ºäº†å¾—åˆ°æ›´å¿«çš„åé¦ˆé€Ÿåº¦ï¼Œæˆ‘ä»¬å†³å®šå…ˆæ²¿ç”¨shadowçš„æ–¹æ¡ˆã€‚</p>
</blockquote>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>ä½¿ç”¨è·¯ç”±é™¤äº†èƒ½è§£è€¦å¼€ç¼–è¯‘æ—¶çš„ä¾èµ–ï¼Œç»Ÿä¸€äº†è·¯ç”±åœ°å€ä¹Ÿèƒ½æ›´å¥½çš„æ»¡è¶³åº”ç”¨çš„è·³è½¬åœºæ™¯ã€‚ç›®å‰CloudDiskå·²ç»è§£è€¦äº†libå’Œfile bundle 2ä¸ªæ¨¡å—ï¼Œå¹¶ä¸”åŸºç¡€çš„æ³¨å…¥å’Œè·¯ç”±ä¹Ÿå·²ç»æœ‰äº†ï¼Œä¸‹ä¸€ç¯‡å•ä½“ç§»åŠ¨åº”ç”¨â€œæ¨¡å—åŒ–â€æ¼”è¿›ä¹‹æ—…ï¼ˆ10ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡ï¼ˆäºŒï¼‰æˆ‘ä»¬å°†ç»§ç»­åˆ†äº«å¯¹platformã€userã€dynamicè¿›è¡Œä¾èµ–è§£é™¤é‡æ„ï¼Œå°†ä¼šåˆ†äº«æ›´å¤šçš„å®æˆ˜è§£è€¦æ‰‹æ³•ã€‚</p>
<h1 id="CloudDiskç¤ºä¾‹ä»£ç "><a href="#CloudDiskç¤ºä¾‹ä»£ç " class="headerlink" title="CloudDiskç¤ºä¾‹ä»£ç "></a>CloudDiskç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/junbin1011/CloudDisk" target="_blank" rel="noopener">CloudDisk</a></p>
<h1 id="ç³»åˆ—é“¾æ¥"><a href="#ç³»åˆ—é“¾æ¥" class="headerlink" title="ç³»åˆ—é“¾æ¥"></a>ç³»åˆ—é“¾æ¥</h1><p><a href="https://juejin.cn/post/6943470229905211422" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ1ï¼‰- å¼€ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6945313969556946980" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ2ï¼‰-æ¶æ„ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6947855094272491556" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ3ï¼‰-ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6950077521790500894" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ4ï¼‰-åˆ†æç¯‡</a></p>
<p><a href="https://juejin.cn/post/6952298178095874055" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ5ï¼‰- é‡æ„æ–¹æ³•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6954635678982340622" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ6ï¼‰- æµ‹è¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º</a></p>
<p><a href="https://juejin.cn/post/6963214120178941983" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡</a></p>
<h1 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h1><p><img src="https://note.youdao.com/yws/api/personal/file/WEBf483992c4f5299577eeb0c039992c8d6?method=download&amp;shareKey=fd4babce2b0d344869bb1b2f7042417d" alt=""></p>
<h1 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h1><p><strong>æ¬¢è¿å…³æ³¨CACæ•æ·æ•™ç»ƒå…¬ä¼—å·</strong>ã€‚å¾®ä¿¡æœç´¢ï¼š<strong>CACæ•æ·æ•™ç»ƒ</strong>ã€‚</p>
<ul>
<li>ä½œè€…ï¼šé»„ä¿Šå½¬ </li>
<li><a href="https://junbin.tech/" target="_blank" rel="noopener">åšå®¢ï¼šjunbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="noopener">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="noopener">çŸ¥ä¹: @JunBin</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope="" itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://junbin1011.github.io/2021/05/17/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰-ä¾èµ–æ³¨å…¥ç¯‡/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="é»„ä¿Šå½¬">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="JunBin">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2021/05/17/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰-ä¾èµ–æ³¨å…¥ç¯‡/" itemprop="url">
                  ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰- ä¾èµ–æ³¨å…¥ç¯‡
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2021-05-17T20:43:08+08:00">
                2021-05-17
              </time>
            

            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2021/05/17/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰-ä¾èµ–æ³¨å…¥ç¯‡/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2021/05/17/ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ8ï¼‰-ä¾èµ–æ³¨å…¥ç¯‡/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¸Šä¸€ç¯‡<a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)</a>æˆ‘ä»¬å¯¹fileåŒ…è¿›è¡Œäº†é‡æ„ï¼ŒæŠ½å–äº†å¯¹åº”çš„UserStateæ¥å£ï¼Œä½†æˆ‘ä»¬å‘ç°UserStateæ¥å£çš„å±‚å±‚ä¼ é€’ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹å·¥ç»´æŠ¤å¥½å¤šçš„æ„é€ æ–¹æ³•åŠå¯¹åº”çš„æ³¨å…¥ï¼Œè¿™æ ·éå¸¸ä¸ä¾¿äºè¿›è¡Œä»£ç çš„ç®¡ç†åŠç»´æŠ¤ã€‚åŒæ—¶éšç€è§£è€¦çš„æ¥å£è¶Šæ¥è¶Šå¤šï¼Œå°±ä¼šäº§ç”Ÿæ›´å¤šçš„æ ·æ¿ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æ›´å¥½çš„æ–¹å¼è¿›è¡Œç»Ÿä¸€çš„ç®¡ç†ã€‚</p>
<p>è¿™ç¯‡æˆ‘ä»¬ä¸»è¦åˆ†ä¸º3ä¸ªéƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯å¸¸è§ä¾èµ–æ³¨å…¥æ–¹å¼ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ä¸šå†…ä¼˜ç§€çš„ä¾èµ–æ³¨å…¥å®è·µï¼Œæœ€åæˆ‘ä»¬å°†ç»§ç»­å¯¹CloudDiskè¿›è¡Œä¾èµ–æ³¨å…¥çš„é‡æ„ã€‚</p>
<h1 id="ä¾èµ–æ³¨å…¥æ–¹å¼"><a href="#ä¾èµ–æ³¨å…¥æ–¹å¼" class="headerlink" title="ä¾èµ–æ³¨å…¥æ–¹å¼"></a>ä¾èµ–æ³¨å…¥æ–¹å¼</h1><h2 id="é™æ€æ³¨å…¥ï¼ˆåœ¨ç¼–è¯‘æ—¶è¿æ¥ä¾èµ–é¡¹çš„ä»£ç ï¼‰"><a href="#é™æ€æ³¨å…¥ï¼ˆåœ¨ç¼–è¯‘æ—¶è¿æ¥ä¾èµ–é¡¹çš„ä»£ç ï¼‰" class="headerlink" title="é™æ€æ³¨å…¥ï¼ˆåœ¨ç¼–è¯‘æ—¶è¿æ¥ä¾èµ–é¡¹çš„ä»£ç ï¼‰"></a>é™æ€æ³¨å…¥ï¼ˆåœ¨ç¼–è¯‘æ—¶è¿æ¥ä¾èµ–é¡¹çš„ä»£ç ï¼‰</h2><p>é™æ€æ³¨å…¥æ˜¯æœ€å¸¸ç”¨çš„æ–¹å¼ï¼Œåœ¨ç±»ä¸­ä¾èµ–æŠ½è±¡ï¼Œæš´éœ²æ¥ç¼ï¼Œåœ¨è°ƒç”¨çš„åœ°æ–¹è¿›è¡Œå®ç°çš„æ³¨å…¥ã€‚å¸¸ç”¨çš„æ³¨å…¥æ–¹å¼æœ‰2ç§ã€‚</p>
<ol>
<li><p>æ„é€ å‡½æ•°æ³¨å…¥ã€‚æ‚¨å°†æŸä¸ªç±»çš„ä¾èµ–é¡¹ä¼ å…¥å…¶æ„é€ å‡½æ•°ï¼ˆä¸Šä¸€ç¯‡çš„CloudDiskå°±æ˜¯é‡‡ç”¨è¿™ç§æ–¹å¼ï¼‰ã€‚</p>
</li>
<li><p>å­—æ®µæ³¨å…¥ï¼ˆæˆ– setter æ³¨å…¥ï¼‰ã€‚æŸäº› Android æ¡†æ¶ç±»ï¼ˆå¦‚ Activity å’Œ Fragmentï¼‰ç”±ç³»ç»Ÿå®ä¾‹åŒ–ï¼Œå› æ­¤æ— æ³•è¿›è¡Œæ„é€ å‡½æ•°æ³¨å…¥ã€‚ä½¿ç”¨å­—æ®µæ³¨å…¥æ—¶ï¼Œä¾èµ–é¡¹å°†åœ¨åˆ›å»ºç±»åå®ä¾‹åŒ–</p>
</li>
</ol>
<p>ç”±äºæ˜¯ç¼–è¯‘æ—¶è¿æ¥ä¾èµ–é¡¹ï¼Œæ‰€ä»¥ç¼–è¾‘é˜¶æ®µä¼šè¿›è¡Œç±»å‹çš„æ£€æŸ¥ã€‚</p>
<h2 id="åŠ¨æ€æ³¨å…¥-ï¼ˆåœ¨è¿è¡Œæ—¶è¿æ¥ä¾èµ–é¡¹ï¼‰"><a href="#åŠ¨æ€æ³¨å…¥-ï¼ˆåœ¨è¿è¡Œæ—¶è¿æ¥ä¾èµ–é¡¹ï¼‰" class="headerlink" title="åŠ¨æ€æ³¨å…¥ ï¼ˆåœ¨è¿è¡Œæ—¶è¿æ¥ä¾èµ–é¡¹ï¼‰"></a>åŠ¨æ€æ³¨å…¥ ï¼ˆåœ¨è¿è¡Œæ—¶è¿æ¥ä¾èµ–é¡¹ï¼‰</h2><p>åŠ¨æ€æ³¨å…¥æœ€å¸¸è§çš„æ–¹å¼å°±æ˜¯é€šè¿‡åå°„çš„æœºåˆ¶ï¼Œåœ¨è¿è¡Œæ—¶è¿›è¡Œæ³¨å…¥ã€‚</p>
<p>ç”±äºæ˜¯è¿è¡Œæ—¶è¿æ¥ä¾èµ–é¡¹ï¼Œæ‰€ä»¥ç¼–è¯‘é˜¶æ®µæ²¡æœ‰æ£€æŸ¥ï¼Œä¸”æœ‰åå°„å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚ä½†å¥½å¤„æ˜¯çµæ´»ï¼Œå¦‚æœæœ‰æ¨¡å—æ˜¯åŠ¨æ€åŠ è½½çš„ï¼Œåˆ©ç”¨è¿™ç§æ–¹å¼å¤„ç†èµ·æ¥æ›´ç®€å•ã€‚</p>
<h2 id="å¯¹æ¯”"><a href="#å¯¹æ¯”" class="headerlink" title="å¯¹æ¯”"></a>å¯¹æ¯”</h2><table>
<thead>
<tr>
<th>é™æ€æ³¨å…¥</th>
<th>åŠ¨æ€æ³¨å…¥</th>
</tr>
</thead>
<tbody>
<tr>
<td>ç±»å‹å®‰å…¨ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥</td>
<td>è¿è¡Œæ—¶ç»‘å®šï¼Œç¼–è¯‘æ—¶æ²¡æœ‰ä¾èµ–</td>
</tr>
<tr>
<td>æ€§èƒ½æ— æŸå¤±</td>
<td>æœ‰åå°„å¸¦æ¥çš„æ€§èƒ½æŸå¤±</td>
</tr>
<tr>
<td>è¾ƒé€‚åˆæ•´åŒ…ç¼–è¯‘</td>
<td>è¾ƒé€‚åˆæ¨¡å—åŠ¨æ€åŠ è½½åœºæ™¯</td>
</tr>
<tr>
<td>å¼€æºå®ç°å¤š</td>
<td>å¼€æºå®ç°è¾ƒå°‘</td>
</tr>
</tbody>
</table>
<h1 id="ä¸šå†…ä¼˜ç§€å®è·µ"><a href="#ä¸šå†…ä¼˜ç§€å®è·µ" class="headerlink" title="ä¸šå†…ä¼˜ç§€å®è·µ"></a>ä¸šå†…ä¼˜ç§€å®è·µ</h1><p>å‰é¢æåˆ°é€‚ç”¨æ‰‹å·¥çš„æ–¹å¼è¿›è¡Œä¾èµ–æ³¨å…¥çš„ç®¡ç†ï¼Œæ˜¯ä¸€é¡¹éå¸¸å›°éš¾å’Œæœ‰æŒ‘æˆ˜çš„äº‹æƒ…ã€‚æ‰€å¹¸ï¼Œä¸šå†…å·²ç»æœ‰æˆç†Ÿçš„è§£å†³æ–¹æ¡ˆã€‚è¿™ä¸€ç« æˆ‘ä»¬æ¥çœ‹ä¸‹ä¸šå†…ä¼˜ç§€çš„å®è·µã€‚</p>
<h2 id="hilt"><a href="#hilt" class="headerlink" title="hilt"></a><a href="https://developer.android.com/training/dependency-injection" target="_blank" rel="noopener">hilt</a></h2><p>Hilt é‡‡ç”¨çš„æ˜¯é™æ€æ³¨å…¥çš„æ–¹å¼ï¼Œåœ¨ä¾èµ–é¡¹æ³¨å…¥åº“<a href="https://dagger.dev/" target="_blank" rel="noopener">Dagger</a> çš„åŸºç¡€ä¸Šæ„å»ºè€Œæˆï¼Œæä¾›äº†ä¸€ç§å°† Dagger çº³å…¥ Android åº”ç”¨çš„æ ‡å‡†æ–¹æ³•ã€‚</p>
<p>è¯¦ç»†çš„ä»‹ç»åŠä½¿ç”¨å¤§å®¶å¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„ä»‹ç»è¯´æ˜</p>
<p><a href="https://developer.android.com/training/dependency-injection/hilt-android" target="_blank" rel="noopener">https://developer.android.com/training/dependency-injection/hilt-android</a></p>
<p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹åˆ†äº«å‡ ç‚¹è¿™ä¸ªåº“çš„ä¸€äº›ä¼˜ç‚¹ã€‚</p>
<ol>
<li>ç›¸æ¯”Draggerï¼Œä½¿ç”¨å…¶å®æ›´ç®€å•</li>
<li>IDEæ”¯æŒé“¾æ¥è·³è½¬ï¼Œå¼€å‘ä½“éªŒå¥½</li>
<li>å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼Œæ–¹ä¾¿è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ç¼–å†™</li>
<li>Jetpackç”Ÿæ€ç»„ä»¶ï¼Œç”Ÿæ€é“¾å®Œæ•´ï¼Œç¤¾åŒºæ´»è·ƒåº¦æ</li>
</ol>
<h2 id="koin"><a href="#koin" class="headerlink" title="koin"></a><a href="https://insert-koin.io/" target="_blank" rel="noopener">koin</a></h2><p>Koin æ˜¯ä¸€ä¸ªç”¨äº Kotlin çš„å®ç”¨å‹è½»é‡çº§ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œé‡‡ç”¨çº¯ Kotlin ç¼–å†™è€Œæˆï¼Œä»…ä½¿ç”¨åŠŸèƒ½è§£æï¼Œæ— ä»£ç†ã€æ— ä»£ç ç”Ÿæˆã€æ— åå°„ã€‚</p>
<p>è¯¦ç»†çš„ä»‹ç»åŠä½¿ç”¨åŒæ ·å¤§å®¶å¯ä»¥æŸ¥çœ‹å®˜æ–¹çš„ä»‹ç»è¯´æ˜</p>
<p><a href="https://insert-koin.io/docs/quickstart/kotlin" target="_blank" rel="noopener">https://insert-koin.io/docs/quickstart/kotlin</a></p>
<p>è¿™é‡Œæˆ‘ä»¬åŒæ ·åˆ†äº«å‡ ç‚¹è¿™ä¸ªåº“çš„ä¸€äº›ä¼˜ç‚¹ã€‚</p>
<ol>
<li>ä½¿ç”¨ç®€å•ï¼Œæ²¡æœ‰å¤æ‚çš„æ³¨è§£</li>
<li>æ›´è½»é‡ï¼Œç›¸æ¯”hiltç¼–è¯‘æ—¶é—´æ›´å¿«ã€ç”Ÿæˆä»£ç æ›´å°‘</li>
</ol>
<p>å½“ç„¶ï¼Œç”±äºkoinæœ¬èº«æ˜¯ç”¨kotlinè¯­è¨€ç¼–å†™çš„ï¼Œæ‰€ä»¥æœ€å¥½é¡¹ç›®ä¹Ÿæ˜¯ä½¿ç”¨kotlinç¼–å†™ã€‚ç›¸æ¯”hiltï¼Œæ²¡æœ‰é‚£ä¹ˆç»†çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ä»¥åŠIDEçš„æ”¯æŒï¼Œå¹¶ä¸”ä¹Ÿæ²¡æœ‰Jetpackçš„ç”Ÿæ€ä¸°å¯Œã€‚</p>
<h1 id="CloudDiskä¾èµ–æ³¨å…¥é‡æ„ç¤ºä¾‹"><a href="#CloudDiskä¾èµ–æ³¨å…¥é‡æ„ç¤ºä¾‹" class="headerlink" title="CloudDiskä¾èµ–æ³¨å…¥é‡æ„ç¤ºä¾‹"></a>CloudDiskä¾èµ–æ³¨å…¥é‡æ„ç¤ºä¾‹</h1><p>å‰é¢æˆ‘ä»¬åˆ†äº«äº†ä¸šå†…ä¸€äº›ä¼˜ç§€çš„ä¾èµ–æ³¨å…¥å®è·µï¼Œç”±äºCloudDiskæ˜¯é‡‡ç”¨javaè¯­è¨€å¼€å‘ï¼Œä¸”è€ƒè™‘åç»­ä¼šå¾€JetPackç”Ÿæ€è¿ç§»ï¼Œæ‰€ä»¥å†³å®šé‡‡ç”¨Hiltçš„æ–¹æ¡ˆã€‚</p>
<p>å…·ä½“çš„Hiltæ”¹é€ è¿‡ç¨‹æˆ‘ä»¬å°±ä¸æ¼”ç¤ºï¼Œ<a href="https://developer.android.com/training/dependency-injection/hilt-android" target="_blank" rel="noopener">å‚è€ƒå®˜ç½‘çš„æ–‡æ¡£</a>è¿›è¡Œæ“ä½œåˆ™å¯ã€‚è¿™é‡Œæˆ‘ä»¬å¯¹æ¯”ä¸€ä¸‹æ”¹é€ å‰åçš„ä»£ç ç‰‡æ®µã€‚</p>
<p>å…·ä½“çš„ä»£ç ï¼š<a href="https://github.com/junbin1011/CloudDisk/commit/5a0cbec49216c7ab43e88a2ebbed51f549f90cfd" target="_blank" rel="noopener">githubé“¾æ¥</a></p>
<p>ä½¿ç”¨æ‰‹å·¥æ³¨å…¥ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class FileFragment extends Fragment &#123;</span><br><span class="line"></span><br><span class="line">    FileController fileController;</span><br><span class="line"></span><br><span class="line">    public FileFragment(UserState userState) &#123;</span><br><span class="line">        fileController = new FileController(userState);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static FileFragment newInstance(UserState userState) &#123;</span><br><span class="line">        FileFragment fragment = new FileFragment(userState);</span><br><span class="line">        Bundle args = new Bundle();</span><br><span class="line">        fragment.setArguments(args);</span><br><span class="line">        return fragment;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨Hiltæ³¨å…¥ï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@AndroidEntryPoint</span><br><span class="line">public class FileFragment extends Fragment &#123;</span><br><span class="line"></span><br><span class="line">    @Inject</span><br><span class="line">    FileController fileController;</span><br><span class="line"></span><br><span class="line">    public static FileFragment newInstance() &#123;</span><br><span class="line">        FileFragment fragment = new FileFragment();</span><br><span class="line">        Bundle args = new Bundle();</span><br><span class="line">        fragment.setArguments(args);</span><br><span class="line">        return fragment;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>Hiltæœ¬è´¨ä¸Šé€šè¿‡æ³¨è§£åŠgradleæ’ä»¶ï¼Œåœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç åŠæ³¨å…¥åˆ°æˆ‘ä»¬çš„ç±»ä¸­ã€‚ä½¿ç”¨æ¡†æ¶å¸®æˆ‘ä»¬å‡å°‘äº†å¾ˆå¤šæ¨¡æ¿ä»£ç ï¼Œç»Ÿä¸€é…ç½®ç®¡ç†ã€‚</p>
</blockquote>
<p>è¿™é‡Œæ³¨æ„ï¼Œæµ‹è¯•ä»£ç ä¹Ÿéœ€è¦åšç›¸åº”çš„é…ç½®ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(AndroidJUnit4.class)</span><br><span class="line">@LargeTest</span><br><span class="line">@HiltAndroidTest</span><br><span class="line">@Config(application = HiltTestApplication.class)</span><br><span class="line">public class SmokeTesting &#123;</span><br><span class="line">    @Rule</span><br><span class="line">    public HiltAndroidRule hiltRule = new HiltAndroidRule(this);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h1><p>æœ¬ç« æˆ‘ä»¬ä»‹ç»äº†å¸¸è§çš„ä¾èµ–æ³¨å…¥æ–¹å¼åŠä¸šå†…ä¼˜ç§€çš„å®è·µï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå°†CloudDiskè¿›è¡Œäº†æ”¹é€ ï¼Œä½¿ç”¨Hiltç»Ÿä¸€ç®¡ç†æ³¨å…¥ã€‚é€šè¿‡IDEçš„ä¾èµ–åˆ†ææˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒAppä¾èµ–äº†fileBundleçš„Fragmentï¼ŒUIä¸Šå­˜åœ¨ç¼–è¯‘çš„ä¾èµ–ã€‚</p>
<p><img src="https://note.youdao.com/yws/api/personal/file/WEB2edad8a59550acde5eea949d50cf8473?method=download&amp;shareKey=1b45b7b5c8e0a566f5f419d70654a673" alt=""></p>
<p>ä¸‹ä¸€ç¯‡ï¼Œç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ9ï¼‰- è·¯ç”±ç¯‡ï¼Œæˆ‘ä»¬å°†åˆ†äº«å¸¸è§çš„é¡µé¢è·¯ç”±æ–¹å¼åŠä¸šå†…ä¼˜ç§€çš„å®è·µï¼Œå¹¶å¯¹DiskCloudç»§ç»­è¿›è¡Œæ”¹é€ ä¼˜åŒ–ã€‚</p>
<h1 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h1><p><a href="https://developer.android.com/training/dependency-injection" target="_blank" rel="noopener">Android ä¸­çš„ä¾èµ–é¡¹æ³¨å…¥</a></p>
<h1 id="CloudDiskç¤ºä¾‹ä»£ç "><a href="#CloudDiskç¤ºä¾‹ä»£ç " class="headerlink" title="CloudDiskç¤ºä¾‹ä»£ç "></a>CloudDiskç¤ºä¾‹ä»£ç </h1><p><a href="https://github.com/junbin1011/CloudDisk" target="_blank" rel="noopener">CloudDisk</a></p>
<h1 id="ç³»åˆ—é“¾æ¥"><a href="#ç³»åˆ—é“¾æ¥" class="headerlink" title="ç³»åˆ—é“¾æ¥"></a>ç³»åˆ—é“¾æ¥</h1><p><a href="https://juejin.cn/post/6943470229905211422" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ1ï¼‰- å¼€ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6945313969556946980" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ2ï¼‰-æ¶æ„ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6947855094272491556" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ3ï¼‰-ç¤ºä¾‹ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6950077521790500894" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ4ï¼‰-åˆ†æç¯‡</a></p>
<p><a href="https://juejin.cn/post/6952298178095874055" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ5ï¼‰- é‡æ„æ–¹æ³•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6954635678982340622" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ6ï¼‰- æµ‹è¯•ç¯‡</a></p>
<p><a href="https://juejin.cn/post/6959504791642832909" target="_blank" rel="noopener">ç§»åŠ¨åº”ç”¨é—ç•™ç³»ç»Ÿé‡æ„ï¼ˆ7ï¼‰- è§£è€¦é‡æ„æ¼”ç¤ºç¯‡(ä¸€)+è§†é¢‘æ¼”ç¤º</a></p>
<h1 id="å¤§çº²"><a href="#å¤§çº²" class="headerlink" title="å¤§çº²"></a>å¤§çº²</h1><p><img src="https://note.youdao.com/yws/api/personal/file/WEBf483992c4f5299577eeb0c039992c8d6?method=download&amp;shareKey=fd4babce2b0d344869bb1b2f7042417d" alt=""></p>
<h1 id="å…³äº"><a href="#å…³äº" class="headerlink" title="å…³äº"></a>å…³äº</h1><p><strong>æ¬¢è¿å…³æ³¨CACæ•æ·æ•™ç»ƒå…¬ä¼—å·</strong>ã€‚å¾®ä¿¡æœç´¢ï¼š<strong>CACæ•æ·æ•™ç»ƒ</strong>ã€‚</p>
<ul>
<li>ä½œè€…ï¼šé»„ä¿Šå½¬ </li>
<li><a href="https://junbin.tech/" target="_blank" rel="noopener">åšå®¢ï¼šjunbin.tech</a></li>
<li><a href="https://github.com/junbin1011" target="_blank" rel="noopener">GitHub: junbin1011 </a></li>
<li><a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" rel="noopener">çŸ¥ä¹: @JunBin</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="https://note.youdao.com/yws/api/personal/file/WEB917b08143504a6f8c96228312fcb5245?method=download&shareKey=03cb5c302c83b56bbb91668c5008444f" alt="é»„ä¿Šå½¬">
          <p class="site-author-name" itemprop="name">é»„ä¿Šå½¬</p>
           
              <p class="site-description motion-element" itemprop="description">ä¸€èŠ±ä¸€ä¸–ç•Œï¼Œä¸€ç ä¸€æµ®ç”Ÿ</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">99</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/junbin1011" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/junbin-9-77" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">é»„ä¿Šå½¬</span>
</div>


<div class="powered-by">
  ç”± <a class="theme-link" href="https://hexo.io">Hexo</a> å¼ºåŠ›é©±åŠ¨
</div>

<div class="theme-info">
  ä¸»é¢˜ -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.0"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"junbin"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  













  
  

  

  

  

  


  

</body>
</html>
